[
    {
        "id": "11c15729dad50c39",
        "type": "tab",
        "label": "HomeBatt",
        "disabled": false,
        "info": "",
        "env": []
    },
    {
        "id": "ddb33f2863df98a5",
        "type": "tab",
        "label": "Watt/kWh/Log/Monitor",
        "disabled": false,
        "info": "",
        "env": []
    },
    {
        "id": "9aa76971e5aacbd8",
        "type": "tab",
        "label": "Other (Virtuals)",
        "disabled": false,
        "info": "",
        "env": []
    },
    {
        "id": "edf9f455029eeb7f",
        "type": "tab",
        "label": "Tibber-New",
        "disabled": false,
        "info": ""
    },
    {
        "id": "13fd8d3e42908a31",
        "type": "tab",
        "label": "domo_log",
        "disabled": false,
        "info": "",
        "env": []
    },
    {
        "id": "6132d4bf54f21e8d",
        "type": "tab",
        "label": "Test",
        "disabled": false,
        "info": "",
        "env": []
    },
    {
        "id": "481b42546729112e",
        "type": "subflow",
        "name": "Solar forecast",
        "info": "This subflow uses the http request node to fetch solar forecasts for geographical positions, using the API from https://forecast.solar/. Please check their website and consider getting a paid account.\n\nDo note that, on a free account, you are limited in the number of requests to do. Also note that the data only gets updated once every 15 minutes, so there is no reason to query more often. There is rate limiting built in the subflow not to perform requests more than once every 15 minutes.\n\n# Configuration\n\nIt uses the parameters as described on: http://doc.forecast.solar/doku.php\n\n - `:apikey` - personal API key for registered users\n - `:lat` - latitude of location, -90 (south) … 90 (north); Internal precission is 0.0001 or abt. 10 m\n - `:lon` - longitude of location, -180 (west) … 180 (east); Internal precission is 0.0001 or abt. 10 m\n - `:dec` - plane declination, 0 (horizontal) … 90 (vertical); Internal precission is integer\n - `:az` - plane azimuth, -180 … 180 (-180 = north, -90 = east, 0 = south, 90 = west, 180 = north); Internal precission is integer\n - `:kwp` - installed modules power in kilo watt peak (kWp)\n\nYou can choose between 3 different type of requests. Note that only `estimate` is available on the free plan.\n\n- `estimate` - this is the forecasted estimate that your panels should produce (given the right parameter settings)\n- `history` - historycal data\n- `clear sky` - estimate given if there would be a clear sky tomorrow\n\nIn case of estimates, one of the following options can be selected:\n- `watts` - Watts (power) average for the period\n- `watthours/period` - Watt hours (energy) for the period\n- `watthours` - Watt hours (energy) summarized over the day\n- `watthours/day` - Watt hours (energy) summarized for each day\n\nFor the graph output there are some extra settings available:\n\n- _Output in kWh_ - when checked output can be set to kWh instead of Wh\n- _Show todays forecast_ - whether or not to include todays forecast\n- _Days to forecast_ - the number of days to forecast (excluding today). Note that you can not get more days forecasted than your API key allows.\n- _Widen graph_ - widen the graph to only show non-zero values\n- _Show day instead of date_ - Show the day instead of the date in the series and labels\n\nThe optional _horizon_ field can be filled out in case an object blocks\nyour solar panels from the sun. See the description [here](https://doc.forecast.solar/horizon)\non what numbers to fill out.\nLeave it empty if you have no objects blocking your panels.\n\n# Input \n\nThe input is for triggering the solar forecast request. \nIt triggers when injecting a message into the node.\n\n# Output\n\nThere are two outputs. The first output is an object with the result and a status message stored into the `msg.payload`.\n\nMost important is the `msg.payload.result`, which contains the estimated production of the panels. E.g.:\n\n```\npayload: object\n  result: object\n    2022-11-28: 23\n    2022-11-29: 35\n```\n\nThe `msg.payload.message` gives information on how successful the query was, the exitcode of the query and the status of the rate limit (how many queries you have left).\n\nThe **second** output can be directly linked to a line or a bar chart, quickly giving a once-glance overview for the predicted forecast.\n\n# Status\n\nInitially the status of the note will be a blue dot, showing \"_Unknown limit_\", as it is unaware of the set ratelmits. After the first request, the returned ratelimit will be put in the text in the form of `remaining/limit`. If more than half the limit is remaining, the dot will be green. If less then half the limit is remaining, the dot will be yellow. If no limit is left, the dot will turn red.\nPlease keep in mind that the ratelimit will be reset after one hour, so you can send a new request after that hour.\n\nIf something is wrong in the API request, the dot will turn red\nand the message will contain the msg.payload with the error. This\nhappens typically when the API is temporally down for maintenance.",
        "category": "",
        "in": [
            {
                "x": 240,
                "y": 100,
                "wires": [
                    {
                        "id": "096ac1e73d64ec13"
                    }
                ]
            }
        ],
        "out": [
            {
                "x": 760,
                "y": 260,
                "wires": [
                    {
                        "id": "1f9426b7b979cee1",
                        "port": 0
                    },
                    {
                        "id": "1ddc734f3070afa0",
                        "port": 0
                    }
                ]
            }
        ],
        "env": [
            {
                "name": "latitude",
                "type": "num",
                "value": "51.3",
                "ui": {
                    "icon": "font-awesome/fa-location-arrow",
                    "label": {
                        "en-US": "Latitude"
                    },
                    "type": "input",
                    "opts": {
                        "types": [
                            "num"
                        ]
                    }
                }
            },
            {
                "name": "longitude",
                "type": "num",
                "value": "5.6",
                "ui": {
                    "icon": "font-awesome/fa-location-arrow",
                    "label": {
                        "en-US": "Longitude"
                    },
                    "type": "input",
                    "opts": {
                        "types": [
                            "num"
                        ]
                    }
                }
            },
            {
                "name": "declination",
                "type": "num",
                "value": "37",
                "ui": {
                    "icon": "font-awesome/fa-chevron-up",
                    "label": {
                        "en-US": "Declination"
                    },
                    "type": "input",
                    "opts": {
                        "types": [
                            "num"
                        ]
                    }
                }
            },
            {
                "name": "azimuth",
                "type": "num",
                "value": "0",
                "ui": {
                    "icon": "font-awesome/fa-compass",
                    "label": {
                        "en-US": "Azimuth"
                    },
                    "type": "spinner",
                    "opts": {
                        "min": -180,
                        "max": 180
                    }
                }
            },
            {
                "name": "modules power",
                "type": "num",
                "value": "1",
                "ui": {
                    "icon": "font-awesome/fa-power-off",
                    "label": {
                        "en-US": "Modules power (kWp)"
                    },
                    "type": "input",
                    "opts": {
                        "types": [
                            "num"
                        ]
                    }
                }
            },
            {
                "name": "apikey",
                "type": "cred",
                "ui": {
                    "icon": "font-awesome/fa-key",
                    "label": {
                        "en-US": "API key"
                    },
                    "type": "input",
                    "opts": {
                        "types": [
                            "cred"
                        ]
                    }
                }
            },
            {
                "name": "type",
                "type": "str",
                "value": "estimate",
                "ui": {
                    "label": {
                        "en-US": "Type"
                    },
                    "type": "select",
                    "opts": {
                        "opts": [
                            {
                                "l": {
                                    "en-US": "Estimate"
                                },
                                "v": "estimate"
                            },
                            {
                                "l": {
                                    "en-US": "History"
                                },
                                "v": "history"
                            },
                            {
                                "l": {
                                    "en-US": "Clear sky"
                                },
                                "v": "clearsky"
                            }
                        ]
                    }
                }
            },
            {
                "name": "watt",
                "type": "str",
                "value": "watts",
                "ui": {
                    "icon": "font-awesome/fa-question-circle-o",
                    "label": {
                        "en-US": "Watt"
                    },
                    "type": "select",
                    "opts": {
                        "opts": [
                            {
                                "l": {
                                    "en-US": "Watts (power) average for the period"
                                },
                                "v": "watts"
                            },
                            {
                                "l": {
                                    "en-US": "Watt hours (energy) for the period"
                                },
                                "v": "watthours/period"
                            },
                            {
                                "l": {
                                    "en-US": "Watt hours (energy) summarized over the day"
                                },
                                "v": "watthours"
                            },
                            {
                                "l": {
                                    "en-US": "Watt hours (energy) summarized for each day"
                                },
                                "v": "watthours/day"
                            }
                        ]
                    }
                }
            },
            {
                "name": "kwhoutput",
                "type": "bool",
                "value": "false",
                "ui": {
                    "label": {
                        "en-US": "Output in kWh (in the graph)"
                    },
                    "type": "checkbox"
                }
            },
            {
                "name": "showtoday",
                "type": "bool",
                "value": "true",
                "ui": {
                    "label": {
                        "en-US": "Show todays forecast"
                    },
                    "type": "checkbox"
                }
            },
            {
                "name": "daystoforecast",
                "type": "str",
                "value": "-1",
                "ui": {
                    "label": {
                        "en-US": "Days to forecast"
                    },
                    "type": "select",
                    "opts": {
                        "opts": [
                            {
                                "l": {
                                    "en-US": "Max"
                                },
                                "v": "-1"
                            },
                            {
                                "l": {
                                    "en-US": "0"
                                },
                                "v": "0"
                            },
                            {
                                "l": {
                                    "en-US": "1"
                                },
                                "v": "1"
                            },
                            {
                                "l": {
                                    "en-US": "2"
                                },
                                "v": "2"
                            },
                            {
                                "l": {
                                    "en-US": "3"
                                },
                                "v": "3"
                            },
                            {
                                "l": {
                                    "en-US": "4"
                                },
                                "v": "4"
                            },
                            {
                                "l": {
                                    "en-US": "5"
                                },
                                "v": "5"
                            },
                            {
                                "l": {
                                    "en-US": "6"
                                },
                                "v": "6"
                            }
                        ]
                    }
                }
            },
            {
                "name": "widengraph",
                "type": "bool",
                "value": "true",
                "ui": {
                    "label": {
                        "en-US": "Widen graph"
                    },
                    "type": "checkbox"
                }
            },
            {
                "name": "showday",
                "type": "bool",
                "value": "false",
                "ui": {
                    "label": {
                        "en-US": "Show day instead of date"
                    },
                    "type": "checkbox"
                }
            },
            {
                "name": "horizon",
                "type": "str",
                "value": "",
                "ui": {
                    "icon": "font-awesome/fa-tree",
                    "label": {
                        "en-US": "(optional) horizon"
                    },
                    "type": "input",
                    "opts": {
                        "types": [
                            "str"
                        ]
                    }
                }
            }
        ],
        "meta": {
            "module": "Solar Forecast",
            "version": "0.0.14",
            "author": "dfaber@victronenergy.com",
            "desc": "Get solar forecasting per location",
            "keywords": "solar,forecast,api",
            "license": "GPL-3.0"
        },
        "color": "#FFCC66",
        "inputLabels": [
            "trigger"
        ],
        "outputLabels": [
            "output",
            "graph",
            ""
        ],
        "icon": "font-awesome/fa-sun-o",
        "status": {
            "x": 700,
            "y": 460,
            "wires": [
                {
                    "id": "07149d8d71dff11e",
                    "port": 0
                },
                {
                    "id": "8a583c51d336775e",
                    "port": 0
                }
            ]
        }
    },
    {
        "id": "538434f8ada5abb4",
        "type": "group",
        "z": "11c15729dad50c39",
        "name": "Report Status on change",
        "style": {
            "stroke": "#ffbfbf",
            "fill": "#ffbfbf",
            "label": true,
            "color": "#000000"
        },
        "nodes": [
            "ee7542bcad3b216c",
            "2db89dacc5a82bb4",
            "8da1b120b4eec60b",
            "b233b5bf79af5971",
            "be72015e9017285b",
            "fb7455af236ed55f",
            "20a5c72168cccf7e",
            "598958ec9a9c8de0",
            "d5014f155871290e",
            "70ef6c4140c82cf3",
            "21fefc9488202f42",
            "57b85b918dc8b58a",
            "45921ca6fe73540e",
            "00e033553ab89f04",
            "cda41a95cbfa126b",
            "9a3ed4a17cfdf232",
            "fbf67a6f4252ba21",
            "49c367a2ee0ccd43",
            "73c8292b08ced613",
            "e697e78dd2476445",
            "f684634197238553",
            "0ad09ce64e47abdc",
            "0cc4ffd6af2c92ed",
            "45117e09372083fa",
            "9afa29835011a413",
            "57447ed22f5a3c27",
            "c375d87f6ea3bb74",
            "f6bbde458a85b6c6",
            "0e11460ee019f369",
            "404abbe7e621dc1f",
            "60ddd275525b3f49",
            "c08db8232c5fd37d",
            "e0aa73f0d9258546",
            "7d54a1b3cffc67b4",
            "175c74606259bb38",
            "426454ccf5f41ce9",
            "44af7ae1d270db90",
            "b56ef4d4767031c5",
            "37ea20bd42d9fef6",
            "379778cec535f398",
            "7b96f665eb122495",
            "615522e20c187a0e",
            "07067fa9860f9e2f",
            "2fde97888a47cbe5",
            "7e6bb5e97122dcb5",
            "29bf06e828834f98",
            "ef39bdefab74d1dd",
            "6cde60b4c7585891",
            "5747688d3b58b44f",
            "f23d66c23430238c",
            "6f28f251feaec99c",
            "840c6a167c2978d4",
            "a8359c3bb7176b44",
            "3ba65bd50d3c2520",
            "e6571047b98d4d18",
            "f9cde63fa478af22",
            "bfa92a18fea9f6db",
            "a6423dd0f1e82e68",
            "4ada7c9f8dd3d3c1",
            "08d57892154c3cb4",
            "a7c4e9efa7a9ad71",
            "62d135e4024d12da",
            "b55619ca5fa84624",
            "6f2b84af6c198677",
            "ede92800fa8827c8",
            "77168ea5a5341a8e",
            "f26bbe4dd29ec42c",
            "52635842ffb1ac5d",
            "62ad99913dec0ba2",
            "541f06a9d0f87b5d",
            "b49b296aba2f2640"
        ],
        "x": 14,
        "y": 179,
        "w": 752,
        "h": 1382
    },
    {
        "id": "89166bbe87877070",
        "type": "group",
        "z": "11c15729dad50c39",
        "name": "Domoticz Setpoint control",
        "style": {
            "fill": "#bfdbef",
            "label": true,
            "color": "#000000"
        },
        "nodes": [
            "f6ccfa7a490be396",
            "e81ad5b0626f8dda",
            "80fb86b547b55555",
            "ff6faae24728b12c",
            "1dfbf5b367b5886e",
            "bce98b1496d5ed45"
        ],
        "x": 9.714279174804688,
        "y": 19,
        "w": 756.2857208251953,
        "h": 147.7142734527588
    },
    {
        "id": "4173e8883e32011b",
        "type": "group",
        "z": "11c15729dad50c39",
        "name": "Adjust charge parameters near the end",
        "style": {
            "fill": "#b797cf",
            "label": true,
            "color": "#ffffff"
        },
        "nodes": [
            "c6dec17afbbc8ee9",
            "d30b1877d0f240d0",
            "186a96fe60498683",
            "7a446c7d181c7c70"
        ],
        "x": 14,
        "y": 1579,
        "w": 972,
        "h": 122
    },
    {
        "id": "118adc3f7ab8b995",
        "type": "group",
        "z": "11c15729dad50c39",
        "name": "Initialization",
        "style": {
            "fill": "#d1d1d1",
            "label": true,
            "color": "#000000"
        },
        "nodes": [
            "83b22b4dba8cc16b",
            "3531f89a0fac36ef",
            "ec8aec609d3dbf27",
            "4265710cca04214d"
        ],
        "x": 814,
        "y": 19,
        "w": 592,
        "h": 122
    },
    {
        "id": "46934fd70a864e7d",
        "type": "group",
        "z": "11c15729dad50c39",
        "name": "Domoticz ESS Mode control",
        "style": {
            "fill": "#9363b7",
            "label": true,
            "color": "#000000"
        },
        "nodes": [
            "8f683f08ca4e0d6d",
            "d83916a2fe777e2f",
            "4a2b5c0c4430540b",
            "44e9c7638da28eda"
        ],
        "x": 14,
        "y": 1719,
        "w": 632,
        "h": 122
    },
    {
        "id": "1bf2cbfd211c76f8",
        "type": "group",
        "z": "11c15729dad50c39",
        "name": "Domoticz Battery Mode/Status Control",
        "style": {
            "fill": "#ffcf3f",
            "label": true,
            "color": "#000000"
        },
        "nodes": [
            "fe29b0e4487b02c0",
            "19094210a4561364",
            "c98824900c31e120",
            "e4baf8667b014c1c",
            "c7f7c335facd37dc",
            "58bd39d70dc748f2",
            "3cb12f5e806dadb9",
            "88700a0ac035432a",
            "5b7b8103806efc12",
            "26c547fb7bc88cee",
            "b6dfbbd90ef362fd"
        ],
        "x": 14,
        "y": 1859,
        "w": 832,
        "h": 162
    },
    {
        "id": "6cc3299294f7eb12",
        "type": "group",
        "z": "11c15729dad50c39",
        "name": "Domoticz MP2 On/Off control",
        "style": {
            "fill": "#c8e7a7",
            "label": true,
            "color": "#000000"
        },
        "nodes": [
            "439d1fa9e5c33602",
            "b5790661fb4671dd",
            "48e8905972378ed1"
        ],
        "x": 14,
        "y": 2039,
        "w": 632,
        "h": 82
    },
    {
        "id": "c8c0c009930503ea",
        "type": "group",
        "z": "11c15729dad50c39",
        "name": "MQTT",
        "style": {
            "stroke": "#ff7f7f",
            "fill": "#ffcf3f",
            "label": true
        },
        "nodes": [
            "c1e616f1b0178c12",
            "c6aa46b57ccb73e5",
            "2a3edab64145a089",
            "3ec85e9cbf9159e7",
            "04b33f5ed2e152e1",
            "032e3829752acb0f",
            "7a46db4de7d2a6f8",
            "c89b03edc9d07f32"
        ],
        "x": 814,
        "y": 119,
        "w": 532,
        "h": 182
    },
    {
        "id": "1a81b3b5b7840ea2",
        "type": "group",
        "z": "edf9f455029eeb7f",
        "name": "Initialization",
        "style": {
            "fill": "#d1d1d1",
            "label": true,
            "color": "#000000"
        },
        "nodes": [
            "122749331c478207",
            "1c936b634fa5b6d7",
            "9e88ca438deb4b19",
            "14c3076dd27b816b"
        ],
        "x": 14,
        "y": 59,
        "w": 602,
        "h": 82
    },
    {
        "id": "9fc897c32bfacc77",
        "type": "group",
        "z": "edf9f455029eeb7f",
        "name": "Tibber Prices Today/Tomorrow",
        "style": {
            "stroke": "#0070c0",
            "label": true,
            "color": "#000000",
            "fill": "#bfdbef"
        },
        "nodes": [
            "7129e14f301fb5a7",
            "7347ef667ed20efa",
            "3822f057ea823e2f",
            "940a6419ce2b4c0f",
            "18ded7543547a3f3",
            "28226bb08eec0b30",
            "b657827f03345e3d",
            "60cbc394be7a8628",
            "2d205981144bf6be",
            "a94b01c687825b75",
            "97ede11f89054187",
            "1d4ccdbd16aed160",
            "2a77a49d4ff72143",
            "18983c8132c11beb",
            "b8e7d236d12fcbe8",
            "95ef6a6364e11d89",
            "1b6c2789468c41cc",
            "f79ebd4ef82b18e4",
            "7ed67c1510d458c5",
            "cef1e6499e62a43b",
            "8ad9d82b77e213a6"
        ],
        "x": 14,
        "y": 159,
        "w": 812,
        "h": 302
    },
    {
        "id": "53c4909b2cd159f9",
        "type": "group",
        "z": "edf9f455029eeb7f",
        "name": "",
        "style": {
            "fill": "#ffefbf",
            "label": true
        },
        "nodes": [
            "9d7f474efb189328",
            "30037a5069c38173",
            "82633b4d062d1a13",
            "ee7037e289888936",
            "3e91a56b38ec890b",
            "9213fea48881c844",
            "6c6c80a15e1cb4be",
            "17d5b20904010c39",
            "0b97aa3927f7c375",
            "c23bdedb46992b45",
            "3933f3579ce2aad0",
            "3dc11edd9ba338dc",
            "098ed9195ff7a18f",
            "58fe7bca50cdfaef",
            "11d9d6c1a87bf0a3",
            "bdf2bb0f2b1c2b9d",
            "04465b10565c458c",
            "6594f371550728ae"
        ],
        "x": 14,
        "y": 499,
        "w": 1202,
        "h": 202
    },
    {
        "id": "09a080a963e69d6f",
        "type": "group",
        "z": "edf9f455029eeb7f",
        "name": "",
        "style": {
            "fill": "#ffefbf",
            "label": true
        },
        "nodes": [
            "9e4cb9245413a0c8",
            "2267757ef11d51f0",
            "c99527de89c75e32",
            "57db08c51ea509f2",
            "159fe759525d9223",
            "2fa2476e9ee7e277",
            "ca4017109521366e",
            "3ebb033deb357c05",
            "febaf0d9ca8c4d2b",
            "6535373b1607bd1e",
            "5333b48ce6123b27",
            "a73a59c7a15f6a8f",
            "9d508e53fd26ec14",
            "e5d4cef80c1ff7da",
            "217231edf82187b4",
            "b1959991955e2764",
            "7ad94d67cc981181",
            "de9ac7915d363f46"
        ],
        "x": 14,
        "y": 719,
        "w": 1202,
        "h": 202
    },
    {
        "id": "4294fa5adf1d40cc",
        "type": "group",
        "z": "ddb33f2863df98a5",
        "name": "AC-In Power Usage",
        "style": {
            "stroke": "#a4a4a4",
            "fill": "#7fb7df",
            "label": true,
            "color": "#ffffff"
        },
        "nodes": [
            "7b60dc31a2076b1f",
            "b586e0714822d972",
            "11f92e80b464a1d6",
            "2ec063d33b8a7f84",
            "c0976c39fde7935c",
            "e473f1d46fb5501d",
            "6bd89a5474aadd23",
            "95d5a72a62e48b55",
            "e658be2b36231f2a",
            "50b5220643150202",
            "bb2045292b7784e9"
        ],
        "x": 14,
        "y": 19,
        "w": 752,
        "h": 202
    },
    {
        "id": "c70320bdd34da074",
        "type": "group",
        "z": "ddb33f2863df98a5",
        "name": "AC-Out-1 Power Usage",
        "style": {
            "stroke": "#a4a4a4",
            "fill": "#bfdbef",
            "label": true,
            "color": "#ffffff"
        },
        "nodes": [
            "7d4442e8b3be559b",
            "703433ba501facff",
            "10a1dc4d89e95cf7",
            "1971b9c044f82cb2",
            "dff804ee95a86520",
            "d576dd0ccd6f6e4d",
            "b8e7d7de824ff8a6",
            "7e5f583d20e15433",
            "1d0f9f6628358241",
            "a4a0fc1ffb8922e1",
            "954eafb592ded153"
        ],
        "x": 14,
        "y": 239,
        "w": 752,
        "h": 202
    },
    {
        "id": "47e7ac41789299da",
        "type": "group",
        "z": "ddb33f2863df98a5",
        "name": "Grid",
        "style": {
            "fill": "#ffefbf",
            "label": true,
            "color": "#000000"
        },
        "nodes": [
            "e47dc594821908f6",
            "6cdbabcda9bb1bf0",
            "24ccb95d5cd0531a",
            "afc2538e4de57b73",
            "581f56ae065b75ef",
            "d3d3bb4f0f6580d2",
            "9f57393bfcc1edd5"
        ],
        "x": 14,
        "y": 459,
        "w": 402,
        "h": 162
    },
    {
        "id": "52734a5bffcceeef",
        "type": "group",
        "z": "ddb33f2863df98a5",
        "name": "Power Over/Underflow Monitor",
        "style": {
            "fill": "#dbcbe7",
            "label": true,
            "color": "#ffffff"
        },
        "nodes": [
            "7fd426c7ab23f005",
            "5c2e7043235b2a67",
            "51c59a043f433e82",
            "aacbe0c5d5d3ed9d",
            "cc6d46e29053cd76",
            "0460462083e78ff0"
        ],
        "x": 14,
        "y": 639,
        "w": 872,
        "h": 162
    },
    {
        "id": "victron-client-id",
        "type": "victron-client",
        "showValues": true,
        "contextStore": true,
        "enablePolling": false
    },
    {
        "id": "ee1bb25c871ce5fc",
        "type": "mqtt-broker",
        "name": "HomeNas",
        "broker": "192.168.0.90",
        "port": "8883",
        "tls": "",
        "clientid": "Victron-NodeRed",
        "autoConnect": true,
        "usetls": true,
        "protocolVersion": "4",
        "keepalive": "60",
        "cleansession": true,
        "autoUnsubscribe": true,
        "birthTopic": "",
        "birthQos": "0",
        "birthPayload": "",
        "birthMsg": {},
        "closeTopic": "",
        "closeQos": "0",
        "closePayload": "",
        "closeMsg": {},
        "willTopic": "",
        "willQos": "0",
        "willPayload": "",
        "willMsg": {},
        "userProps": "",
        "sessionExpiry": ""
    },
    {
        "id": "8a8cd7cfb22df37b",
        "type": "ui_base",
        "theme": {
            "name": "theme-dark",
            "lightTheme": {
                "default": "#0094CE",
                "baseColor": "#0094CE",
                "baseFont": "-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif",
                "edited": true,
                "reset": false
            },
            "darkTheme": {
                "default": "#097479",
                "baseColor": "#097479",
                "baseFont": "-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif",
                "edited": true,
                "reset": false
            },
            "customTheme": {
                "name": "Untitled Theme 1",
                "default": "#4B7930",
                "baseColor": "#4B7930",
                "baseFont": "-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif"
            },
            "themeState": {
                "base-color": {
                    "default": "#097479",
                    "value": "#097479",
                    "edited": false
                },
                "page-titlebar-backgroundColor": {
                    "value": "#097479",
                    "edited": false
                },
                "page-backgroundColor": {
                    "value": "#111111",
                    "edited": false
                },
                "page-sidebar-backgroundColor": {
                    "value": "#333333",
                    "edited": false
                },
                "group-textColor": {
                    "value": "#0eb8c0",
                    "edited": false
                },
                "group-borderColor": {
                    "value": "#555555",
                    "edited": false
                },
                "group-backgroundColor": {
                    "value": "#333333",
                    "edited": false
                },
                "widget-textColor": {
                    "value": "#eeeeee",
                    "edited": false
                },
                "widget-backgroundColor": {
                    "value": "#097479",
                    "edited": false
                },
                "widget-borderColor": {
                    "value": "#333333",
                    "edited": false
                },
                "base-font": {
                    "value": "-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif"
                }
            },
            "angularTheme": {
                "primary": "indigo",
                "accents": "blue",
                "warn": "red",
                "background": "grey",
                "palette": "light"
            }
        },
        "site": {
            "name": "Victron Dashboard",
            "hideToolbar": "false",
            "allowSwipe": "false",
            "lockMenu": "false",
            "allowTempTheme": "true",
            "dateFormat": "DD/MM/YYYY",
            "sizes": {
                "sx": 48,
                "sy": 48,
                "gx": 6,
                "gy": 6,
                "cx": 6,
                "cy": 6,
                "px": 0,
                "py": 0
            }
        }
    },
    {
        "id": "b662aef846bc41cd",
        "type": "ui_tab",
        "name": "Home",
        "icon": "dashboard",
        "disabled": false,
        "hidden": false
    },
    {
        "id": "09c638b767297aba",
        "type": "tibber-api-endpoint",
        "queryUrl": "https://api.tibber.com/v1-beta/gql",
        "feedConnectionTimeout": "30",
        "feedTimeout": "60",
        "queryRequestTimeout": "30",
        "name": ""
    },
    {
        "id": "963cc6570d12d537",
        "type": "ui_group",
        "name": "Basic",
        "tab": "b662aef846bc41cd",
        "order": 1,
        "disp": true,
        "width": "6",
        "collapse": false,
        "className": ""
    },
    {
        "id": "5726694de195109f",
        "type": "http request",
        "z": "481b42546729112e",
        "name": "",
        "method": "GET",
        "ret": "txt",
        "paytoqs": "ignore",
        "url": "",
        "tls": "",
        "persist": false,
        "proxy": "",
        "insecureHTTPParser": false,
        "authType": "",
        "senderr": false,
        "headers": [],
        "x": 390,
        "y": 180,
        "wires": [
            [
                "7884fdf66931c555"
            ]
        ]
    },
    {
        "id": "096ac1e73d64ec13",
        "type": "function",
        "z": "481b42546729112e",
        "name": "create forecast.solar url",
        "func": "msg.url = 'https://api.forecast.solar/';\n\nif (env.get('apikey')) {\n    msg.url += env.get('apikey') + '/';\n    }\n\nmsg.url += env.get('type') + '/';\n\nmsg.url += env.get('watt') + '/';\n\nmsg.url += env.get('latitude') + '/' +\n           env.get('longitude') + '/' +\n           env.get('declination') + '/' +\n           env.get('azimuth') + '/' +\n           env.get('modules power');\n\nif (env.get('horizon')) {\n    msg.url += '?horizon=' + env.get('horizon')\n}\nmsg.topic = 'solar forecast: '+(env.get('type') || '');\nmsg.topic += (' '+env.get('watt') || '');\nif (env.get('kwhoutput')) {\n    msg.topic += ' (kWh)';\n}\n\nreturn msg;",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 630,
        "y": 100,
        "wires": [
            [
                "24bc9c8665678f59"
            ]
        ]
    },
    {
        "id": "7884fdf66931c555",
        "type": "json",
        "z": "481b42546729112e",
        "name": "Convert to json",
        "property": "payload",
        "action": "",
        "pretty": false,
        "x": 680,
        "y": 180,
        "wires": [
            [
                "a1cdf6e6a3a96be1"
            ]
        ]
    },
    {
        "id": "bc4a4177924fef16",
        "type": "function",
        "z": "481b42546729112e",
        "name": "update ratelimit",
        "func": "var remaining = msg.payload.message.ratelimit.remaining || 0;\nvar limit = msg.payload.message.ratelimit.limit;\n\nflow.set('forecast.solar.ratelimit.remaining', remaining)\nflow.set('forecast.solar.ratelimit.limit', limit)\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 540,
        "y": 380,
        "wires": [
            [
                "522529554126d3b5"
            ]
        ]
    },
    {
        "id": "a1cdf6e6a3a96be1",
        "type": "link out",
        "z": "481b42546729112e",
        "name": "link out 1",
        "mode": "link",
        "links": [
            "9baea1642621f8ac",
            "59083f23c4f10495"
        ],
        "x": 815,
        "y": 180,
        "wires": []
    },
    {
        "id": "59083f23c4f10495",
        "type": "link in",
        "z": "481b42546729112e",
        "name": "link in 1",
        "links": [
            "a1cdf6e6a3a96be1"
        ],
        "x": 405,
        "y": 380,
        "wires": [
            [
                "bc4a4177924fef16"
            ]
        ]
    },
    {
        "id": "9baea1642621f8ac",
        "type": "link in",
        "z": "481b42546729112e",
        "name": "link in 2",
        "links": [
            "a1cdf6e6a3a96be1"
        ],
        "x": 225,
        "y": 260,
        "wires": [
            [
                "1ddc734f3070afa0"
            ]
        ]
    },
    {
        "id": "3ddaf128e6c97938",
        "type": "inject",
        "z": "481b42546729112e",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": true,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 550,
        "y": 340,
        "wires": [
            [
                "522529554126d3b5"
            ]
        ]
    },
    {
        "id": "07149d8d71dff11e",
        "type": "function",
        "z": "481b42546729112e",
        "name": "update status",
        "func": "var remaining = flow.get('forecast.solar.ratelimit.remaining') || -1;\nvar limit = flow.get('forecast.solar.ratelimit.limit') || -1\n\nvar text = remaining.toString() + '/' + limit.toString();\nvar fill = \"green\";\n\nif (remaining == 0) {\n    fill = \"red\";\n    text = \"Limit used\";\n}\n\nif (remaining > 0 && remaining < limit / 2) {\n    fill = \"yellow\"\n}\n\nif (remaining == -1 ) {\n    fill = \"blue\"\n    text = \"Limits unknown\"\n}\n\nmsg.payload = ({ fill: fill, text: text });\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 540,
        "y": 480,
        "wires": [
            []
        ]
    },
    {
        "id": "24bc9c8665678f59",
        "type": "link out",
        "z": "481b42546729112e",
        "name": "link out 7",
        "mode": "link",
        "links": [
            "dc22d91dddb12797"
        ],
        "x": 805,
        "y": 100,
        "wires": []
    },
    {
        "id": "dc22d91dddb12797",
        "type": "link in",
        "z": "481b42546729112e",
        "name": "link in 18",
        "links": [
            "24bc9c8665678f59"
        ],
        "x": 245,
        "y": 180,
        "wires": [
            [
                "5726694de195109f"
            ]
        ]
    },
    {
        "id": "eee05cbf111c228c",
        "type": "catch",
        "z": "481b42546729112e",
        "name": "",
        "scope": null,
        "uncaught": false,
        "x": 280,
        "y": 340,
        "wires": [
            [
                "7e22fb1ce267ce1e"
            ]
        ]
    },
    {
        "id": "522529554126d3b5",
        "type": "link out",
        "z": "481b42546729112e",
        "name": "link out 8",
        "mode": "link",
        "links": [
            "2b784cd8cf4d6f54"
        ],
        "x": 705,
        "y": 380,
        "wires": []
    },
    {
        "id": "2b784cd8cf4d6f54",
        "type": "link in",
        "z": "481b42546729112e",
        "name": "link in 19",
        "links": [
            "522529554126d3b5"
        ],
        "x": 405,
        "y": 480,
        "wires": [
            [
                "07149d8d71dff11e"
            ]
        ]
    },
    {
        "id": "7e22fb1ce267ce1e",
        "type": "link out",
        "z": "481b42546729112e",
        "name": "link out 9",
        "mode": "link",
        "links": [
            "ec2a6da31af488af",
            "1f9426b7b979cee1"
        ],
        "x": 395,
        "y": 340,
        "wires": []
    },
    {
        "id": "ec2a6da31af488af",
        "type": "link in",
        "z": "481b42546729112e",
        "name": "link in 20",
        "links": [
            "7e22fb1ce267ce1e"
        ],
        "x": 405,
        "y": 440,
        "wires": [
            [
                "8a583c51d336775e"
            ]
        ]
    },
    {
        "id": "8a583c51d336775e",
        "type": "function",
        "z": "481b42546729112e",
        "name": "Set error status",
        "func": "node.warn(msg.payload)\nmsg.payload = ({ fill: \"red\", text: msg.payload });\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 540,
        "y": 440,
        "wires": [
            []
        ]
    },
    {
        "id": "1f9426b7b979cee1",
        "type": "link in",
        "z": "481b42546729112e",
        "name": "link in 21",
        "links": [
            "7e22fb1ce267ce1e"
        ],
        "x": 665,
        "y": 280,
        "wires": [
            []
        ]
    },
    {
        "id": "1ddc734f3070afa0",
        "type": "function",
        "z": "481b42546729112e",
        "name": "Processed info",
        "func": "msg.resolution = 60;\nmsg.days = 1;\nmsg.type = env.get('type');\nmsg.watt = env.get('watt');\nmsg.kwhoutput = env.get('kwhoutput');\n\nvar key1 = Object.keys(msg.payload.result)[1];\nvar key2 = Object.keys(msg.payload.result)[2];\nvar key3 = Object.keys(msg.payload.result)[Object.keys(msg.payload.result).length-1];\n\nvar d1 = new Date(key1);\nvar d2 = new Date(key2); \nvar d3 = new Date(key3);\nmsg.resolution = 3600000 / (d2.getTime() - d1.getTime());\n\nmsg.days = Math.floor((d3.getTime() - d1.getTime()) / (1000 * 3600 * 24));\n\nif (msg.watt === 'watt_hours_day' || msg.watt === 'watthours/day') {\n    msg.resolution = null;\n}\n\nreturn msg;",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 360,
        "y": 260,
        "wires": [
            []
        ],
        "info": "Function to process the result from forecast.solar to add\nextra information, which is handy for either graphing or\nto store in a database.\n\n\nThe extra values added:\n- `msg.resolution` - The number of measurements per hour. If\nno API key is used, this will be 1. Other values may be 2 or 4.\n- `msg.days` - The number of days in the forcast. If no API\n- key is used this will be 1. Other values may be 3 or 6."
    },
    {
        "id": "c6dec17afbbc8ee9",
        "type": "function",
        "z": "11c15729dad50c39",
        "g": "4173e8883e32011b",
        "name": "IF (SP > 0 && SOC > max_soc) THEN SP = 0W",
        "func": "let data = context.global.data || {};\nlet soc = data[\"batt_soc\"];\nlet ess_setpoint = data[\"ess_setpoint\"];\n\nif (ess_setpoint > 0 && soc > context.global.max_soc) {\n    msg.payload = 0;\n    return msg;\n}\n",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 460,
        "y": 1620,
        "wires": [
            []
        ]
    },
    {
        "id": "d30b1877d0f240d0",
        "type": "inject",
        "z": "11c15729dad50c39",
        "g": "4173e8883e32011b",
        "name": "Every 10 secs",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "5",
        "crontab": "",
        "once": true,
        "onceDelay": "10",
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 140,
        "y": 1620,
        "wires": [
            [
                "c6dec17afbbc8ee9",
                "7a446c7d181c7c70"
            ]
        ]
    },
    {
        "id": "186a96fe60498683",
        "type": "victron-output-ess",
        "z": "11c15729dad50c39",
        "g": "4173e8883e32011b",
        "service": "com.victronenergy.settings",
        "path": "/Settings/CGwacs/AcPowerSetPoint",
        "serviceObj": {
            "service": "com.victronenergy.settings",
            "name": "Venus settings"
        },
        "pathObj": {
            "path": "/Settings/CGwacs/AcPowerSetPoint",
            "type": "integer",
            "name": "Grid set-point (W)",
            "writable": true
        },
        "name": "",
        "onlyChanges": false,
        "x": 820,
        "y": 1640,
        "wires": []
    },
    {
        "id": "8f683f08ca4e0d6d",
        "type": "mqtt in",
        "z": "11c15729dad50c39",
        "g": "46934fd70a864e7d",
        "name": "ESS Mode",
        "topic": "my_victron/set/ess_mode",
        "qos": "2",
        "datatype": "auto-detect",
        "broker": "ee1bb25c871ce5fc",
        "nl": false,
        "rap": true,
        "rh": 0,
        "inputs": 0,
        "x": 100,
        "y": 1760,
        "wires": [
            [
                "44e9c7638da28eda"
            ]
        ]
    },
    {
        "id": "d83916a2fe777e2f",
        "type": "debug",
        "z": "11c15729dad50c39",
        "g": "46934fd70a864e7d",
        "name": "Update ESS Mode",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "payload",
        "targetType": "msg",
        "statusVal": "",
        "statusType": "auto",
        "x": 470,
        "y": 1800,
        "wires": []
    },
    {
        "id": "4a2b5c0c4430540b",
        "type": "victron-output-ess",
        "z": "11c15729dad50c39",
        "g": "46934fd70a864e7d",
        "service": "com.victronenergy.settings",
        "path": "/Settings/CGwacs/Hub4Mode",
        "serviceObj": {
            "service": "com.victronenergy.settings",
            "name": "Venus settings"
        },
        "pathObj": {
            "path": "/Settings/CGwacs/Hub4Mode",
            "type": "enum",
            "name": "ESS mode",
            "enum": {
                "1": "Optimized mode or 'keep batteries charged' and phase compensation enabled",
                "2": "Optimized mode or 'keep batteries charged' and phase compensation disabled",
                "3": "External control"
            },
            "writable": true
        },
        "initial": "",
        "name": "",
        "onlyChanges": false,
        "x": 500,
        "y": 1760,
        "wires": []
    },
    {
        "id": "44e9c7638da28eda",
        "type": "function",
        "z": "11c15729dad50c39",
        "g": "46934fd70a864e7d",
        "name": "Translate",
        "func": "let new_mode = 0;\nif (msg.payload == \"Mode 1\")\n    new_mode = 1;\nelse if (msg.payload == \"Mode 2\")\n    new_mode = 2;\nelse\n    return null;\nmsg.payload = new_mode;\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 240,
        "y": 1760,
        "wires": [
            [
                "4a2b5c0c4430540b",
                "d83916a2fe777e2f"
            ]
        ]
    },
    {
        "id": "ee7542bcad3b216c",
        "type": "victron-input-ess",
        "z": "11c15729dad50c39",
        "g": "538434f8ada5abb4",
        "service": "com.victronenergy.settings",
        "path": "/Settings/CGwacs/AcPowerSetPoint",
        "serviceObj": {
            "service": "com.victronenergy.settings",
            "name": "Venus settings"
        },
        "pathObj": {
            "path": "/Settings/CGwacs/AcPowerSetPoint",
            "type": "integer",
            "name": "Grid set-point (W)"
        },
        "name": "Venus | Grid set-point (W)",
        "onlyChanges": true,
        "x": 150,
        "y": 220,
        "wires": [
            [
                "e81ad5b0626f8dda",
                "7d54a1b3cffc67b4"
            ]
        ]
    },
    {
        "id": "c1e616f1b0178c12",
        "type": "function",
        "z": "11c15729dad50c39",
        "g": "c8c0c009930503ea",
        "name": "construct MQTT-AD",
        "func": "// messages on output 1 will be rate limit\n\nlet final_topic = \"my_victron/\" + msg.topic + \"/state\";\n\nlet data_msg = context.global.data || {};\nlet data_timestamp = context.global.timetamp || {};\nlet topic = msg.topic;\n\nlet sendnow = false;\n\nif (typeof msg.sendnow !== 'undefined') {\n    sendnow = (msg.sendnow == true);\n}\n\ndata_msg[topic] = msg.payload;\ndata_timestamp[topic] = Date.now();\ncontext.global.data = data_msg;\ncontext.global.timetamp = data_timestamp;\n\n//still needed? (everything is in global now)\ncontext.global.victron_data = data_msg;\n\nmsg.topic = final_topic;\n\nlet msg2 = null;\n\nif (sendnow == true) {\n    //node.warn('send now: ' + msg.topic);\n    //send directly\n    msg2 = msg;\n    msg = null;\n}\n\nreturn [msg, msg2];\n",
        "outputs": 2,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1000,
        "y": 160,
        "wires": [
            [
                "3ec85e9cbf9159e7"
            ],
            [
                "c89b03edc9d07f32"
            ]
        ]
    },
    {
        "id": "80fb86b547b55555",
        "type": "victron-output-ess",
        "z": "11c15729dad50c39",
        "g": "89166bbe87877070",
        "service": "com.victronenergy.settings",
        "path": "/Settings/CGwacs/AcPowerSetPoint",
        "serviceObj": {
            "service": "com.victronenergy.settings",
            "name": "Venus settings"
        },
        "pathObj": {
            "path": "/Settings/CGwacs/AcPowerSetPoint",
            "type": "integer",
            "name": "Grid set-point (W)",
            "writable": true
        },
        "name": "",
        "onlyChanges": false,
        "x": 600,
        "y": 60,
        "wires": []
    },
    {
        "id": "2db89dacc5a82bb4",
        "type": "function",
        "z": "11c15729dad50c39",
        "g": "538434f8ada5abb4",
        "name": "Charge State",
        "func": "msg.topic = \"charge_state\";\n\nif (msg.payload == 0)\n    msg.payload = \"Initialising\";\nelse if (msg.payload == 1)\n    msg.payload = \"Bulk\";\nelse if (msg.payload == 2)\n    msg.payload = \"Absorption\";\nelse if (msg.payload == 3)\n    msg.payload = \"Float\";\nelse if (msg.payload == 4)\n    msg.payload = \"Storage\";\nelse if (msg.payload == 5)\n    msg.payload = \"Absorb repeat\";\nelse if (msg.payload == 6)\n    msg.payload = \"Forced absorb\";\nelse if (msg.payload == 7)\n    msg.payload = \"Equalise\";\nelse if (msg.payload == 8)\n    msg.payload = \"Bulk stopped\";\nelse if (msg.payload == 9)\n    msg.payload = \"Unknown (\" + msg.payload + \")\";\nelse\n    msg.payload = \"Unknown? (\" + msg.payload + \")\";\nmsg.sendnow = true;\nreturn msg;\n",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 550,
        "y": 800,
        "wires": [
            [
                "0cc4ffd6af2c92ed"
            ]
        ]
    },
    {
        "id": "8da1b120b4eec60b",
        "type": "function",
        "z": "11c15729dad50c39",
        "g": "538434f8ada5abb4",
        "name": "ESS Mode",
        "func": "msg.topic = \"ess_mode\";\nif (msg.payload == 1)\n    msg.payload = \"Mode 1\";\nelse if (msg.payload == 2)\n    msg.payload = \"Mode 2\";\nelse if (msg.payload == 3)\n    msg.payload = \"Mode 3\";\nelse\n    return null;\nmsg.sendnow = true;\nreturn msg;\n",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 550,
        "y": 840,
        "wires": [
            [
                "0cc4ffd6af2c92ed"
            ]
        ]
    },
    {
        "id": "c6aa46b57ccb73e5",
        "type": "mqtt out",
        "z": "11c15729dad50c39",
        "g": "c8c0c009930503ea",
        "name": "Domoticz-MQTT",
        "topic": "",
        "qos": "",
        "retain": "",
        "respTopic": "",
        "contentType": "",
        "userProps": "",
        "correl": "",
        "expiry": "",
        "broker": "ee1bb25c871ce5fc",
        "x": 1000,
        "y": 220,
        "wires": []
    },
    {
        "id": "2a3edab64145a089",
        "type": "debug",
        "z": "11c15729dad50c39",
        "g": "c8c0c009930503ea",
        "name": "JSON Output",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "payload",
        "targetType": "msg",
        "statusVal": "",
        "statusType": "auto",
        "x": 990,
        "y": 260,
        "wires": []
    },
    {
        "id": "b233b5bf79af5971",
        "type": "victron-input-battery",
        "z": "11c15729dad50c39",
        "g": "538434f8ada5abb4",
        "service": "com.victronenergy.battery/279",
        "path": "/Dc/0/Voltage",
        "serviceObj": {
            "service": "com.victronenergy.battery/279",
            "name": "SmartShunt 500A/50mV"
        },
        "pathObj": {
            "path": "/Dc/0/Voltage",
            "type": "float",
            "name": "Battery voltage (V)"
        },
        "initial": "",
        "name": "SmartShunt | Battery voltage (V)",
        "onlyChanges": true,
        "roundValues": "2",
        "x": 170,
        "y": 400,
        "wires": [
            [
                "45921ca6fe73540e",
                "49c367a2ee0ccd43",
                "404abbe7e621dc1f"
            ]
        ]
    },
    {
        "id": "be72015e9017285b",
        "type": "victron-input-battery",
        "z": "11c15729dad50c39",
        "g": "538434f8ada5abb4",
        "service": "com.victronenergy.battery/279",
        "path": "/Dc/0/Current",
        "serviceObj": {
            "service": "com.victronenergy.battery/279",
            "name": "SmartShunt 500A/50mV"
        },
        "pathObj": {
            "path": "/Dc/0/Current",
            "type": "float",
            "name": "Battery current (A)"
        },
        "initial": "",
        "name": "SmartShunt | Battery current (A)",
        "onlyChanges": true,
        "roundValues": "2",
        "x": 170,
        "y": 440,
        "wires": [
            [
                "60ddd275525b3f49"
            ]
        ]
    },
    {
        "id": "fb7455af236ed55f",
        "type": "victron-input-temperature",
        "z": "11c15729dad50c39",
        "g": "538434f8ada5abb4",
        "service": "com.victronenergy.temperature/24",
        "path": "/Temperature",
        "serviceObj": {
            "service": "com.victronenergy.temperature/24",
            "name": "Temp_1"
        },
        "pathObj": {
            "path": "/Temperature",
            "type": "float",
            "name": "Temperature (°C)"
        },
        "name": "Temp1",
        "onlyChanges": true,
        "roundValues": "2",
        "x": 90,
        "y": 680,
        "wires": [
            [
                "b56ef4d4767031c5"
            ]
        ]
    },
    {
        "id": "20a5c72168cccf7e",
        "type": "victron-input-temperature",
        "z": "11c15729dad50c39",
        "g": "538434f8ada5abb4",
        "service": "com.victronenergy.temperature/24",
        "path": "/Temperature",
        "serviceObj": {
            "service": "com.victronenergy.temperature/24",
            "name": "Temp_1"
        },
        "pathObj": {
            "path": "/Temperature",
            "type": "float",
            "name": "Temperature (°C)"
        },
        "name": "Temp2",
        "onlyChanges": true,
        "roundValues": "2",
        "x": 90,
        "y": 720,
        "wires": [
            [
                "37ea20bd42d9fef6"
            ]
        ]
    },
    {
        "id": "598958ec9a9c8de0",
        "type": "victron-input-temperature",
        "z": "11c15729dad50c39",
        "g": "538434f8ada5abb4",
        "service": "com.victronenergy.temperature/24",
        "path": "/Temperature",
        "serviceObj": {
            "service": "com.victronenergy.temperature/24",
            "name": "Temp_1"
        },
        "pathObj": {
            "path": "/Temperature",
            "type": "float",
            "name": "Temperature (°C)"
        },
        "name": "Temp3",
        "onlyChanges": true,
        "roundValues": "2",
        "x": 90,
        "y": 760,
        "wires": [
            [
                "379778cec535f398"
            ]
        ]
    },
    {
        "id": "d5014f155871290e",
        "type": "victron-input-vebus",
        "z": "11c15729dad50c39",
        "g": "538434f8ada5abb4",
        "service": "com.victronenergy.vebus/276",
        "path": "/VebusChargeState",
        "serviceObj": {
            "service": "com.victronenergy.vebus/276",
            "name": "MultiPlus"
        },
        "pathObj": {
            "path": "/VebusChargeState",
            "type": "enum",
            "name": "Charge state",
            "enum": {
                "0": "Initialising",
                "1": "Bulk",
                "2": "Absorption",
                "3": "Float",
                "4": "Storage",
                "5": "Absorb repeat",
                "6": "Forced absorb",
                "7": "Equalise",
                "8": "Bulk stopped",
                "9": "Unknown"
            }
        },
        "initial": "",
        "name": "MultiPlus-II 48/5000 | Charge State",
        "onlyChanges": true,
        "x": 180,
        "y": 800,
        "wires": [
            [
                "2db89dacc5a82bb4"
            ]
        ]
    },
    {
        "id": "70ef6c4140c82cf3",
        "type": "victron-input-ess",
        "z": "11c15729dad50c39",
        "g": "538434f8ada5abb4",
        "service": "com.victronenergy.settings",
        "path": "/Settings/CGwacs/Hub4Mode",
        "serviceObj": {
            "service": "com.victronenergy.settings",
            "name": "Venus settings"
        },
        "pathObj": {
            "path": "/Settings/CGwacs/Hub4Mode",
            "type": "enum",
            "name": "ESS mode",
            "enum": {
                "1": "Optimized mode or 'keep batteries charged' and phase compensation enabled",
                "2": "Optimized mode or 'keep batteries charged' and phase compensation disabled",
                "3": "External control"
            }
        },
        "initial": "",
        "name": "ESS Mode",
        "onlyChanges": true,
        "x": 100,
        "y": 840,
        "wires": [
            [
                "8da1b120b4eec60b",
                "00e033553ab89f04"
            ]
        ]
    },
    {
        "id": "21fefc9488202f42",
        "type": "victron-input-battery",
        "z": "11c15729dad50c39",
        "g": "538434f8ada5abb4",
        "service": "com.victronenergy.battery/512",
        "path": "/Dc/0/Temperature",
        "serviceObj": {
            "service": "com.victronenergy.battery/512",
            "name": "BasenVT"
        },
        "pathObj": {
            "path": "/Dc/0/Temperature",
            "type": "float",
            "name": "Battery temperature (°C)"
        },
        "initial": "",
        "name": "Basen Battery | Temperature",
        "onlyChanges": true,
        "roundValues": "2",
        "x": 160,
        "y": 620,
        "wires": [
            [
                "2fde97888a47cbe5"
            ]
        ]
    },
    {
        "id": "83b22b4dba8cc16b",
        "type": "function",
        "z": "11c15729dad50c39",
        "g": "118adc3f7ab8b995",
        "name": "Startup Function",
        "func": "let discovery_topic = \"homeassistant\";\nlet root_topic = \"my_victron\";\nlet root_device_identifier = \"victron_0x027c2c0024013256\";\ncontext.global.batt_capacity = 14300 + 16000 + 16000; //Wh\n\ncontext.global.number_of_multiplus = 3;\ncontext.global.max_charge_setpoint = 10000; \ncontext.global.max_discharge_setpoint = 10000;\n\ncontext.global.batt_charge_rate = 9000;     //3000=90.7% see efficiency chart \ncontext.global.batt_discharge_rate = 9000;  //4126=90.8, 4750 = 89.6\n\ncontext.global.idle_rate = 110;\n\ncontext.global.max_phase_power = 5550;\n\ncontext.global.min_soc = 10;\ncontext.global.max_soc = 100; //Because we use a smartshunt and specified 55.2V as 100% (=90%)\n\ncontext.global.original_setpoint = undefined;\ncontext.global.wanted_setpoint = undefined;\ncontext.global.setpoint_adjusted = false;\n\ncontext.global.data = {};\n\nlet pobject = [\n    //\"name\": [\"object_type\", \"varname\", \"unique_id\", \"payload_on/unit\", \"payload_off\", \"step\"],\n\n    //Setpoint\n    { \"ESS Setpoint\": [\"climate\", \"ess_setpoint\", \"0x8000000002\", \"Watt\", \"-11000|11000\", 100] },\n\n    //Switches\n    { \"ESS Control Mode\": [\"select\", \"ess_mode\", \"0x8000000001\", \"Mode 1|Mode 2\", \"\", 0] },\n    { \"Battery Mode\": [\"select\", \"batt_mode\", \"0x800000000E\", \"Off|Idle|IQ Smart Mode|IQ Smart Mode + Balance|Grid Balance|Solar Charge|Charge|Discharge|Manual\", \"\", 0] },\n    { \"Battery State\": [\"select\", \"batt_state\", \"0x8000000014\", \"Off|Idle|Charging|Discharging\", \"\", 0] },\n    { \"MP2 On/Off state\": [\"switch\", \"mp2_switch_position\", \"0x800000000F\", \"On\", \"Off\", 0] },\n\n    //Sensors\n    { \"Battery Percentage\": [\"sensor\", \"batt_soc\", \"0x8000000003\", \"%\", \"\", 0] },\n    { \"Battery Voltage\": [\"sensor\", \"batt_voltage\", \"0x8000000004\", \"V\", \"\", 0] },\n    { \"Battery Amps\": [\"sensor\", \"batt_amps\", \"0x8000000005\", \"A\", \"\", 0] },\n    { \"Battery Temperature\": [\"sensor\", \"batt_temp\", \"0x800000000D\", \"\\u00b0C\", \"\", 0] },\n    { \"VMeter Grid L1 Watt\": [\"sensor\", \"grid_l1_w\", \"0x8000000006\", \"W\", \"\", 0] },\n    { \"VMeter Grid L2 Watt\": [\"sensor\", \"grid_l2_w\", \"0x8000000007\", \"W\", \"\", 0] },\n    { \"VMeter Grid L3 Watt\": [\"sensor\", \"grid_l3_w\", \"0x8000000008\", \"W\", \"\", 0] },\n    { \"Smartshunt Percentage\": [\"sensor\", \"smartshunt_soc\", \"0x8000000018\", \"%\", \"\", 0] },\n    { \"BasenVT Percentage\": [\"sensor\", \"basenvt_soc\", \"0x8000000010\", \"%\", \"\", 0] },\n    { \"BasenVT Voltage\": [\"sensor\", \"basenvt_voltage\", \"0x8000000011\", \"V\", \"\", 0] },\n    { \"BasenVT Amps\": [\"sensor\", \"basenvt_amps\", \"0x8000000013\", \"A\", \"\", 0] },\n    { \"Battery Capacity\": [\"sensor\", \"batt_capacity\", \"0x8000000012\", \"W\", \"\", 0] },\n    { \"Battery Charged kWh\": [\"sensor\", \"batt_charged_kwh\", \"0x8000000015_power\", \"kWh\", \"\", 0] },\n    { \"Battery Charged W\": [\"sensor\", \"batt_charged_w\", \"0x8000000015_energy\", \"W\", \"\", 0] },\n    { \"Battery Discharged kWh\": [\"sensor\", \"batt_discharged_kwh\", \"0x8000000016_power\", \"kWh\", \"\", 0] },\n    { \"Battery Discharged W\": [\"sensor\", \"batt_discharged_w\", \"0x8000000016_energy\", \"W\", \"\", 0] },\n    { \"MP2 AC-In kWh\": [\"sensor\", \"inv_acin_kwh\", \"0x8000000017_power\", \"kWh\", \"\", 0] },\n    { \"MP2 AC-In Charged W\": [\"sensor\", \"inv_acin_w\", \"0x8000000017_energy\", \"W\", \"\", 0] },\n    \n    { \"MP2 AC-Out-1 kWh\": [\"sensor\", \"inv_acout1_kwh\", \"0x8000000023_power\", \"kWh\", \"\", 0] },\n    { \"MP2 AC-Out-1 Watt\": [\"sensor\", \"inv_acout1_w\", \"0x8000000023_energy\", \"W\", \"\", 0] },\n\n    { \"MP2 AC-In L1\": [\"sensor\", \"mp_acin_L1\", \"0x8000000024_energy\", \"W\", \"\", 0] },\n    { \"MP2 AC-In L2\": [\"sensor\", \"mp_acin_L2\", \"0x8000000025_energy\", \"W\", \"\", 0] },\n    { \"MP2 AC-In L3\": [\"sensor\", \"mp_acin_L3\", \"0x8000000026_energy\", \"W\", \"\", 0] },\n\n    { \"MP2 AC-Out-1 L1\": [\"sensor\", \"mp_acout1_L1\", \"0x8000000027_energy\", \"W\", \"\", 0] },\n    { \"MP2 AC-Out-1 L2\": [\"sensor\", \"mp_acout1_L2\", \"0x8000000028_energy\", \"W\", \"\", 0] },\n    { \"MP2 AC-Out-1 L3\": [\"sensor\", \"mp_acout1_L3\", \"0x8000000029_energy\", \"W\", \"\", 0] },\n\n    { \"Combined SOC\": [\"sensor\", \"combined_soc\", \"0x8000000019\", \"%\", \"\", 0] },\n    { \"Combined kWh\": [\"sensor\", \"combined_kw\", \"0x800000001A\", \"W\", \"\", 0] },\n    { \"Combined Volt\": [\"sensor\", \"combined_volt\", \"0x8000000021\", \"V\", \"\", 0] },\n    { \"Combined Amps\": [\"sensor\", \"combined_amps\", \"0x8000000022\", \"A\", \"\", 0] },\n\n    { \"MPPT Watt\": [\"sensor\", \"mppt_w\", \"0x800000001B_energy\", \"W\", \"\", 0] },\n    { \"MPPT kWh\": [\"sensor\", \"mppt_kwh\", \"0x800000001B_power\", \"kWh\", \"\", 0] },\n    { \"MPPT Voltage\": [\"sensor\", \"mppt_voltage\", \"0x800000001D\", \"V\", \"\", 0] },\n    { \"MPPT Batt Amps\": [\"sensor\", \"mppt_batt_amps\", \"0x800000001E\", \"A\", \"\", 0] },\n    { \"MPPT Batt Voltage\": [\"sensor\", \"mppt_batt_voltage\", \"0x800000001F\", \"V\", \"\", 0] },\n\n    { \"TotalPV Watt\": [\"sensor\", \"totpv_w\", \"0x8000000020_energy\", \"W\", \"\", 0] },\n    { \"TotalPV kWh\": [\"sensor\", \"totpv_kwh\", \"0x8000000020_power\", \"kWh\", \"\", 0] },\n\n\n    //Temperatures\n    { \"Temp 1\": [\"sensor\", \"temp_1\", \"0x8000000009\", \"\\u00b0C\", \"\", 0] },\n    { \"Temp 2\": [\"sensor\", \"temp_2\", \"0x800000000A\", \"\\u00b0C\", \"\", 0] },\n    { \"Temp 3\": [\"sensor\", \"temp_3\", \"0x800000000B\", \"\\u00b0C\", \"\", 0] },\n    \n    //Text\n    { \"ESS Charge State\": [\"sensor\", \"charge_state\", \"0x800000000C\", \"text\", \"\", 0] },\n\n    //0x8000000019\n    //{ \"ev_driving_range\": [\"sensor\", \"random2\", \"0x800000000C\", \"km\", \"\", 1] },\n\n    //some other types\n    //{ \"is_locked\": [\"switch\", \"is_locked\", \"0x8000000001\", \"true\", \"false\", 0] },\n    //{ \"charge_door_open\": [\"binary_sensor\", \"ev_charge_port_door_is_open\", \"0x8000000002\", \"true\", \"false\", 0] },\n    //{ \"hood_open\": [\"binary_sensor\", \"hood_is_open\", \"0x8000000003\", \"true\", \"false\", 0] },\n    //{ \"air_temperature\": [\"sensor\", \"air_temperature\", \"0x8000000006\", \"\\u00b0C\", \"\", 1] },\n\n    //config objects, see Domoticz->Hardware->MQTT-AD->Setup\n    //{ \"ev_charge_limits_ac\": [\"number\", \"ev_charge_limits_ac\", \"0x8000001001\", \"\", \"\", 1] },\n    //{ \"ev_charge_limits_dc\": [\"number\", \"ev_charge_limits_ac\", \"0x8000001002\", \"\", \"\", 1] },\n];\n\nfunction createBinaryObject(root, name, varname, unique_id, payload_on = \"ON\", payload_off = \"OFF\")\n{\n    let device_identifier = unique_id;\n    if (device_identifier.indexOf(\"_\") != -1)\n    {\n        device_identifier = unique_id.split(\"_\")[0];\n    }\n    let vjson = {\n        \"stat_t\": \"~/\" + varname + \"/state\",\n        \"dev\": {\n            \"manufacturer\": \"PA1DVB\",\n            \"model\": \"Node-Red\",\n            \"name\": \"BatteryControl\",\n            \"ids\": []\n        }\n    };\n    vjson.dev.ids.push(device_identifier);\n    vjson[\"~\"] = root;\n    vjson[\"name\"] = name;\n    vjson[\"payload_on\"] = payload_on;\n    vjson[\"payload_off\"] = payload_off;\n    vjson[\"uniq_id\"] = unique_id;\n    //vjson[\"val_tpl\"] = \"{{ value_json.\" + varname + \" }}\";\n    return vjson;\n}\n\nfunction createLightObject(root, name, varname, unique_id, payload_on = \"ON\", payload_off = \"OFF\")\n{\n    let device_identifier = unique_id;\n    if (device_identifier.indexOf(\"_\") != -1)\n    {\n        device_identifier = unique_id.split(\"_\")[0];\n    }\n    let vjson = {\n        \"stat_t\": \"~/\" + varname + \"/state\",\n        \"dev\": {\n            \"manufacturer\": \"PA1DVB\",\n            \"model\": \"Node-Red\",\n            \"name\": \"BatteryControl\",\n            \"ids\": []\n        }\n    };\n    vjson.dev.ids.push(device_identifier);\n    vjson[\"~\"] = root;\n    vjson[\"name\"] = name;\n    vjson[\"payload_on\"] = payload_on;\n    vjson[\"payload_off\"] = payload_off;\n    vjson[\"cmd_t\"] = \"~/set/\" + varname;\n    vjson[\"uniq_id\"] = unique_id;\n    //vjson[\"val_tpl\"] = \"{{ value_json.\" + varname + \" }}\";\n    return vjson;\n}\n\nfunction createSelectObject(root, name, varname, unique_id, select_options)\n{\n    let device_identifier = unique_id;\n    if (device_identifier.indexOf(\"_\") != -1)\n    {\n        device_identifier = unique_id.split(\"_\")[0];\n    }\n    let vjson = {\n        \"stat_t\": \"~/\" + varname + \"/state\",\n        \"dev\": {\n            \"manufacturer\": \"PA1DVB\",\n            \"model\": \"Node-Red\",\n            \"name\": \"BatteryControl\",\n            \"ids\": []\n        }\n    };\n    vjson.dev.ids.push(device_identifier);\n    vjson[\"~\"] = root;\n    vjson[\"name\"] = name;\n\n    vjson[\"options\"] = [];\n    select_options.split(\"|\").forEach(function (item) {\n        vjson[\"options\"].push(item);\n    });\n    vjson[\"cmd_t\"] = \"~/set/\" + varname;\n    vjson[\"uniq_id\"] = unique_id;\n    //vjson[\"val_tpl\"] = \"{{ value_json.\" + varname + \" }}\";\n    return vjson;\n}\n\nfunction createNumberObject(root, name, varname, unique_id, step = 1)\n{\n    let device_identifier = unique_id;\n    if (device_identifier.indexOf(\"_\") != -1)\n    {\n        device_identifier = unique_id.split(\"_\")[0];\n    }\n    let vjson = {\n        \"stat_t\": \"~/\" + varname + \"/state\",\n        \"dev\": {\n            \"manufacturer\": \"PA1DVB\",\n            \"model\": \"Node-Red\",\n            \"name\": \"BatteryControl\",\n            \"ids\": []\n        }\n    };\n    vjson.dev.ids.push(device_identifier);\n    vjson[\"~\"] = root;\n    vjson[\"name\"] = name;\n    vjson[\"step\"] = step;\n    vjson[\"cmd_t\"] = \"~/set/\" + varname;\n    vjson[\"uniq_id\"] = unique_id;\n    //vjson[\"val_tpl\"] = \"{{ value_json.\" + varname + \" }}\";\n    return vjson;\n}\n\nfunction createSensorObject(root, name, varname, unique_id, unit_of_measurement)\n{\n    let vjson = {\n        \"stat_t\": \"~/\" + varname + \"/state\",\n        \"dev\": {\n            \"manufacturer\": \"PA1DVB\",\n            \"model\": \"Node-Red\",\n            \"name\": \"BatteryControl\",\n            \"ids\": []\n        }\n    };\n\n    let device_identifier = unique_id;\n    if (device_identifier.indexOf(\"_\") != -1)\n    {\n        device_identifier = unique_id.split(\"_\")[0];\n    }\n\n    vjson.dev.ids.push(device_identifier);\n    vjson[\"~\"] = root;\n    vjson[\"name\"] = name;\n    vjson[\"uniq_id\"] = unique_id;\n    vjson[\"unit_of_meas\"] = unit_of_measurement;\n    \n    let state_class = \"measurement\";\n    \n    let device_class = \"\";\n    switch (unit_of_measurement)\n    {\n        case \"text\":\n            state_class = \"\";\n            break;\n        case \"%\":\n            if (\n                (name.indexOf('Batt') !== -1)\n                || (name.indexOf('batt') !== -1)\n                || (varname.indexOf('_soc') !== -1)\n            ) {\n                device_class = \"battery\";\n            } else {\n                device_class = \"percentage\";\n            }\n            break;\n        case \"°C\":\n        case \"C\":\n        case \"°F\":\n        case \"F\":\n            device_class = \"temperature\";\n            break;\n        case \"V\":\n        case \"mV\":\n            device_class = \"voltage\";\n            break;\n        case \"A\":\n        case \"mA\":\n            device_class = \"current\";\n            break;\n        case \"\\u00b0c\":\n        case \"\\u00b0C\":\n            device_class = \"temperature\";\n            break;\n        case \"W\":\n            device_class = \"power\";\n            break;\n        case \"kWh\":\n        case \"Wh\":\n            device_class = \"energy\";\n            state_class = \"total_increasing\";\n            break;\n    }\n\n    if (device_class != \"\")\n    {\n        vjson[\"device_class\"] = device_class;\n    }\n    if (state_class != \"\")\n    {\n        vjson[\"state_class\"] = state_class;\n    }\n    \n    //vjson[\"val_tpl\"] = \"{{ value_json.\" + varname + \" }}\";\n\n    return vjson\n}\n\nfunction createClimateObject(root, name, varname, unique_id, unit_of_measurement, min_value = 6.5, max_value = 35.0, step_size = 1.0)\n{\n    let device_identifier = unique_id;\n    if (device_identifier.indexOf(\"_\") != -1)\n    {\n        device_identifier = unique_id.split(\"_\")[0];\n    }\n    let vjson = {\n        \"temp_stat_t\": \"~/\" + varname + \"/state\",\n        \"dev\": {\n            \"manufacturer\": \"PA1DVB\",\n            \"model\": \"Node-Red\",\n            \"name\": \"BatteryControl\",\n            \"ids\": []\n        }\n    };\n    vjson.dev.ids.push(device_identifier);\n    vjson[\"~\"] = root;\n    vjson[\"name\"] = name;\n    vjson[\"uniq_id\"] = unique_id;\n    vjson[\"temp_unit\"] = unit_of_measurement;\n    vjson[\"temp_cmd_t\"] = \"~/set/\" + varname;\n    vjson[\"temp_stat_tpl\"] = \"{{ value_json.\" + varname + \" }}\";\n    vjson[\"temp_step\"] = step_size;\n    vjson[\"min_temp\"] = min_value;\n    vjson[\"max_temp\"] = max_value;\n    return vjson\n}\n\nnode.log(\"Flow Initialisation\");\n\npobject.forEach((vvar) => {\n    let name = Object.keys(vvar)[0];\n    let vobj = vvar[Object.keys(vvar)];\n    let object_type = vobj[0]\n    let varname = vobj[1]\n    let unique_id = vobj[2]\n\n    let jobj = null\n    if (object_type == \"light\") {\n        let payload_on = vobj[3]\n        let payload_off = vobj[4]\n        jobj = createLightObject(root_topic, name, varname, unique_id, payload_on, payload_off);\n    }\n    else if (object_type == \"switch\") {\n        let payload_on = vobj[3]\n        let payload_off = vobj[4]\n        jobj = createLightObject(root_topic, name, varname, unique_id, payload_on, payload_off);\n    }\n    else if (object_type == \"binary_sensor\") {\n        let payload_on = vobj[3]\n        let payload_off = vobj[4]\n        jobj = createBinaryObject(root_topic, name, varname, unique_id, payload_on, payload_off);\n    }\n    else if (object_type == \"select\") {\n        let soptions = vobj[3]\n        jobj = createSelectObject(root_topic, name, varname, unique_id, soptions);\n    }\n    else if (object_type == \"number\") {\n        let step = vobj[5]\n        jobj = createNumberObject(root_topic, name, varname, unique_id, step);\n    }\n    else if (object_type == \"sensor\") {\n        let unit_of_measurement = vobj[3]\n        jobj = createSensorObject(root_topic, name, varname, unique_id, unit_of_measurement);\n    }\n    else if (object_type == \"climate\") {\n        let unit_of_measurement = vobj[3]\n        let minmax = vobj[4];\n        let step_size = vobj[5]\n\n        let min_value = 6.5;\n        let max_value = 35;\n        let sresults = minmax.split(\"|\");\n        if (sresults.length == 2) {\n            min_value = parseFloat(sresults[0]);\n            max_value = parseFloat(sresults[1]);\n        }\n\n        jobj = createClimateObject(root_topic, name, varname, unique_id, unit_of_measurement, min_value, max_value, step_size);\n    }\n\n    if (jobj != null) {\n        if (unique_id.indexOf(\"_\") != -1)\n        {\n            unique_id = unique_id.split(\"_\")[0];\n        }\n        let dtopic = discovery_topic + \"/\" + object_type + \"/\" + unique_id + \"/\" + varname + \"/config\"\n        //node.log(\"publishing config ->: \" + dtopic);\n\n        msg.payload = jobj;\n        msg.topic = dtopic;\n        msg.retain = true;\n        node.send(msg);\n    }\n});\nreturn null;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1080,
        "y": 60,
        "wires": [
            [
                "ec8aec609d3dbf27",
                "4265710cca04214d"
            ]
        ]
    },
    {
        "id": "ff6faae24728b12c",
        "type": "mqtt in",
        "z": "11c15729dad50c39",
        "g": "89166bbe87877070",
        "name": "ESS Setpoint",
        "topic": "my_victron/set/ess_setpoint",
        "qos": "2",
        "datatype": "auto-detect",
        "broker": "ee1bb25c871ce5fc",
        "nl": false,
        "rap": true,
        "rh": 0,
        "inputs": 0,
        "x": 110,
        "y": 60,
        "wires": [
            [
                "bce98b1496d5ed45"
            ]
        ]
    },
    {
        "id": "3531f89a0fac36ef",
        "type": "inject",
        "z": "11c15729dad50c39",
        "g": "118adc3f7ab8b995",
        "name": "Startup",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": true,
        "onceDelay": "0.3",
        "topic": "online",
        "payload": "true",
        "payloadType": "str",
        "x": 920,
        "y": 60,
        "wires": [
            [
                "83b22b4dba8cc16b"
            ]
        ]
    },
    {
        "id": "fe29b0e4487b02c0",
        "type": "mqtt in",
        "z": "11c15729dad50c39",
        "g": "1bf2cbfd211c76f8",
        "name": "Battery Mode",
        "topic": "my_victron/set/batt_mode",
        "qos": "2",
        "datatype": "auto-detect",
        "broker": "ee1bb25c871ce5fc",
        "nl": false,
        "rap": true,
        "rh": 0,
        "inputs": 0,
        "x": 110,
        "y": 1900,
        "wires": [
            [
                "19094210a4561364",
                "58bd39d70dc748f2"
            ]
        ]
    },
    {
        "id": "19094210a4561364",
        "type": "switch",
        "z": "11c15729dad50c39",
        "g": "1bf2cbfd211c76f8",
        "name": "On or Off",
        "property": "payload",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "Off",
                "vt": "str"
            },
            {
                "t": "neq",
                "v": "Off",
                "vt": "str"
            }
        ],
        "checkall": "false",
        "repair": false,
        "outputs": 2,
        "x": 280,
        "y": 1940,
        "wires": [
            [
                "e4baf8667b014c1c"
            ],
            [
                "3cb12f5e806dadb9"
            ]
        ]
    },
    {
        "id": "c98824900c31e120",
        "type": "victron-output-vebus",
        "z": "11c15729dad50c39",
        "g": "1bf2cbfd211c76f8",
        "service": "com.victronenergy.vebus/276",
        "path": "/Mode",
        "serviceObj": {
            "service": "com.victronenergy.vebus/276",
            "name": "MultiPlus"
        },
        "pathObj": {
            "path": "/Mode",
            "type": "enum",
            "name": "Switch Position",
            "remarks": "<p>Note that <tt>/ModeIsAdjustable</tt> needs to be set to 1.</p> ",
            "enum": {
                "1": "Charger Only",
                "2": "Inverter Only",
                "3": "On",
                "4": "Off"
            },
            "writable": true
        },
        "initial": "",
        "name": "",
        "onlyChanges": false,
        "x": 690,
        "y": 1960,
        "wires": []
    },
    {
        "id": "e4baf8667b014c1c",
        "type": "function",
        "z": "11c15729dad50c39",
        "g": "1bf2cbfd211c76f8",
        "name": "System Off",
        "func": "msg.payload = 4;\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 490,
        "y": 1920,
        "wires": [
            [
                "c7f7c335facd37dc",
                "c98824900c31e120"
            ]
        ]
    },
    {
        "id": "3cb12f5e806dadb9",
        "type": "function",
        "z": "11c15729dad50c39",
        "g": "1bf2cbfd211c76f8",
        "name": "System On",
        "func": "msg.payload = 3;\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 490,
        "y": 1960,
        "wires": [
            [
                "c7f7c335facd37dc",
                "c98824900c31e120"
            ]
        ]
    },
    {
        "id": "c7f7c335facd37dc",
        "type": "debug",
        "z": "11c15729dad50c39",
        "g": "1bf2cbfd211c76f8",
        "name": "ESS Switch Position",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "payload",
        "targetType": "msg",
        "statusVal": "",
        "statusType": "auto",
        "x": 700,
        "y": 1920,
        "wires": []
    },
    {
        "id": "cda41a95cbfa126b",
        "type": "victron-input-vebus",
        "z": "11c15729dad50c39",
        "g": "538434f8ada5abb4",
        "service": "com.victronenergy.vebus/276",
        "path": "/Mode",
        "serviceObj": {
            "service": "com.victronenergy.vebus/276",
            "name": "MultiPlus"
        },
        "pathObj": {
            "path": "/Mode",
            "type": "enum",
            "name": "Switch Position",
            "enum": {
                "1": "Charger Only",
                "2": "Inverter Only",
                "3": "On",
                "4": "Off"
            }
        },
        "initial": "",
        "name": "",
        "onlyChanges": true,
        "x": 150,
        "y": 880,
        "wires": [
            [
                "fbf67a6f4252ba21",
                "9a3ed4a17cfdf232"
            ]
        ]
    },
    {
        "id": "9a3ed4a17cfdf232",
        "type": "function",
        "z": "11c15729dad50c39",
        "g": "538434f8ada5abb4",
        "name": "MP2 On/Off State",
        "func": "if (msg.payload == 3)\n    msg.payload = \"On\";\nelse\n    msg.payload = \"Off\";\nmsg.topic = \"mp2_switch_position\";\nmsg.sendnow = true;\nreturn msg;\n",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 530,
        "y": 880,
        "wires": [
            [
                "0cc4ffd6af2c92ed"
            ]
        ]
    },
    {
        "id": "439d1fa9e5c33602",
        "type": "mqtt in",
        "z": "11c15729dad50c39",
        "g": "6cc3299294f7eb12",
        "name": "MP2 Switch Position",
        "topic": "my_victron/set/mp2_switch_position",
        "qos": "2",
        "datatype": "auto-detect",
        "broker": "ee1bb25c871ce5fc",
        "nl": false,
        "rap": true,
        "rh": 0,
        "inputs": 0,
        "x": 130,
        "y": 2080,
        "wires": [
            [
                "b5790661fb4671dd"
            ]
        ]
    },
    {
        "id": "b5790661fb4671dd",
        "type": "function",
        "z": "11c15729dad50c39",
        "g": "6cc3299294f7eb12",
        "name": "Translate",
        "func": "let new_mode = 4;\nif (msg.payload == \"On\")\n    new_mode = 3;\nmsg.payload = new_mode;\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 300,
        "y": 2080,
        "wires": [
            [
                "48e8905972378ed1"
            ]
        ]
    },
    {
        "id": "48e8905972378ed1",
        "type": "victron-output-vebus",
        "z": "11c15729dad50c39",
        "g": "6cc3299294f7eb12",
        "service": "com.victronenergy.vebus/276",
        "path": "/Mode",
        "serviceObj": {
            "service": "com.victronenergy.vebus/276",
            "name": "MultiPlus"
        },
        "pathObj": {
            "path": "/Mode",
            "type": "enum",
            "name": "Switch Position",
            "remarks": "<p>Note that <tt>/ModeIsAdjustable</tt> needs to be set to 1.</p> ",
            "enum": {
                "1": "Charger Only",
                "2": "Inverter Only",
                "3": "On",
                "4": "Off"
            },
            "writable": true
        },
        "initial": "",
        "name": "",
        "onlyChanges": false,
        "x": 510,
        "y": 2080,
        "wires": []
    },
    {
        "id": "bce98b1496d5ed45",
        "type": "function",
        "z": "11c15729dad50c39",
        "g": "89166bbe87877070",
        "name": "Check",
        "func": "/*\nDomoticz script IQ mode stuurt Setpoint = 3000 --> In overload? -> Dan zet de gewenste waarde in backup_setpoint en doe niets, zo niet stuur hem door naar de multiplus\nDus je wilt tussentijds ontvangen/opslaan wat Domoticz zegt in de backup setpoint misschien, maar in het geval van een overload (setpoint_adjusted), dan niet de echt setpoint zetten maar opslaan in de backup setpoint waarde\nEn die nieuwe backup_setpoint waarde gebruiken in je overload berekening\n\n*/\n\nlet data = context.global.data || {};\nlet max_charge_setpoint = data[\"max_charge_setpoint\"];\nlet min_discharge_setpoint = -data[\"max_discharge_setpoint\"];\n\nif (msg.payload > max_charge_setpoint)\n    msg.payload = max_charge_setpoint;\nelse if (msg.payload < min_discharge_setpoint)\n    msg.payload = min_discharge_setpoint;\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 250,
        "y": 60,
        "wires": [
            [
                "80fb86b547b55555",
                "f6ccfa7a490be396"
            ]
        ]
    },
    {
        "id": "58bd39d70dc748f2",
        "type": "function",
        "z": "11c15729dad50c39",
        "g": "1bf2cbfd211c76f8",
        "name": "Battety Mode",
        "func": "msg.topic = \"batt_mode\";\nmsg.sendnow = true;\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 290,
        "y": 1900,
        "wires": [
            [
                "88700a0ac035432a"
            ]
        ]
    },
    {
        "id": "73c8292b08ced613",
        "type": "victron-input-battery",
        "z": "11c15729dad50c39",
        "g": "538434f8ada5abb4",
        "service": "com.victronenergy.battery/512",
        "path": "/Soc",
        "serviceObj": {
            "service": "com.victronenergy.battery/512",
            "name": "BasenVT"
        },
        "pathObj": {
            "path": "/Soc",
            "type": "float",
            "name": "State of charge (%)"
        },
        "initial": "",
        "name": "BasenVT | State of Charge (%)",
        "onlyChanges": true,
        "roundValues": "1",
        "x": 170,
        "y": 920,
        "wires": [
            [
                "7b96f665eb122495"
            ]
        ]
    },
    {
        "id": "e697e78dd2476445",
        "type": "victron-input-battery",
        "z": "11c15729dad50c39",
        "g": "538434f8ada5abb4",
        "service": "com.victronenergy.battery/512",
        "path": "/Dc/0/Voltage",
        "serviceObj": {
            "service": "com.victronenergy.battery/512",
            "name": "BasenVT"
        },
        "pathObj": {
            "path": "/Dc/0/Voltage",
            "type": "float",
            "name": "Battery voltage (V)"
        },
        "initial": "",
        "name": "BasenVT | Voltage",
        "onlyChanges": true,
        "roundValues": "2",
        "x": 130,
        "y": 960,
        "wires": [
            [
                "615522e20c187a0e"
            ]
        ]
    },
    {
        "id": "f684634197238553",
        "type": "function",
        "z": "11c15729dad50c39",
        "g": "538434f8ada5abb4",
        "name": "Actual Battery Capacity",
        "func": "let soc = msg.payload;\nmsg.payload = (context.global.batt_capacity / 100) * soc;\nmsg.topic = \"batt_capacity\";\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 510,
        "y": 320,
        "wires": [
            [
                "0cc4ffd6af2c92ed"
            ]
        ]
    },
    {
        "id": "3ec85e9cbf9159e7",
        "type": "delay",
        "z": "11c15729dad50c39",
        "g": "c8c0c009930503ea",
        "name": "Rate Limit",
        "pauseType": "timed",
        "timeout": "5",
        "timeoutUnits": "seconds",
        "rate": "1",
        "nbRateUnits": "10",
        "rateUnits": "second",
        "randomFirst": "1",
        "randomLast": "5",
        "randomUnits": "seconds",
        "drop": true,
        "allowrate": false,
        "outputs": 1,
        "x": 1200,
        "y": 160,
        "wires": [
            [
                "7a46db4de7d2a6f8"
            ]
        ]
    },
    {
        "id": "0ad09ce64e47abdc",
        "type": "victron-input-battery",
        "z": "11c15729dad50c39",
        "g": "538434f8ada5abb4",
        "service": "com.victronenergy.battery/512",
        "path": "/Dc/0/Current",
        "serviceObj": {
            "service": "com.victronenergy.battery/512",
            "name": "BasenVT"
        },
        "pathObj": {
            "path": "/Dc/0/Current",
            "type": "float",
            "name": "Battery current (A)"
        },
        "initial": "",
        "name": "BasenVT | current (A)",
        "onlyChanges": true,
        "roundValues": "2",
        "x": 140,
        "y": 1000,
        "wires": [
            [
                "07067fa9860f9e2f"
            ]
        ]
    },
    {
        "id": "0cc4ffd6af2c92ed",
        "type": "link out",
        "z": "11c15729dad50c39",
        "g": "538434f8ada5abb4",
        "name": "ToMQTT",
        "mode": "link",
        "links": [
            "04b33f5ed2e152e1"
        ],
        "x": 725,
        "y": 720,
        "wires": []
    },
    {
        "id": "04b33f5ed2e152e1",
        "type": "link in",
        "z": "11c15729dad50c39",
        "g": "c8c0c009930503ea",
        "name": "ToMQTT-Limit",
        "links": [
            "0cc4ffd6af2c92ed",
            "88700a0ac035432a",
            "b6dfbbd90ef362fd",
            "bb2045292b7784e9",
            "c526dba98b24ed05",
            "954eafb592ded153",
            "9f57393bfcc1edd5"
        ],
        "x": 855,
        "y": 160,
        "wires": [
            [
                "c1e616f1b0178c12"
            ]
        ]
    },
    {
        "id": "88700a0ac035432a",
        "type": "link out",
        "z": "11c15729dad50c39",
        "g": "1bf2cbfd211c76f8",
        "name": "ToMQTT",
        "mode": "link",
        "links": [
            "04b33f5ed2e152e1"
        ],
        "x": 395,
        "y": 1900,
        "wires": []
    },
    {
        "id": "ec8aec609d3dbf27",
        "type": "link out",
        "z": "11c15729dad50c39",
        "g": "118adc3f7ab8b995",
        "name": "ToMQTT-Direct",
        "mode": "link",
        "links": [
            "032e3829752acb0f"
        ],
        "x": 1225,
        "y": 60,
        "wires": []
    },
    {
        "id": "032e3829752acb0f",
        "type": "link in",
        "z": "11c15729dad50c39",
        "g": "c8c0c009930503ea",
        "name": "ToMQTT-Direct",
        "links": [
            "7a46db4de7d2a6f8",
            "c89b03edc9d07f32",
            "ec8aec609d3dbf27"
        ],
        "x": 855,
        "y": 220,
        "wires": [
            [
                "2a3edab64145a089",
                "c6aa46b57ccb73e5"
            ]
        ]
    },
    {
        "id": "7a46db4de7d2a6f8",
        "type": "link out",
        "z": "11c15729dad50c39",
        "g": "c8c0c009930503ea",
        "name": "ToMQTT-Direct",
        "mode": "link",
        "links": [
            "032e3829752acb0f"
        ],
        "x": 1305,
        "y": 160,
        "wires": []
    },
    {
        "id": "c89b03edc9d07f32",
        "type": "link out",
        "z": "11c15729dad50c39",
        "g": "c8c0c009930503ea",
        "name": "ToMQTT-Direct",
        "mode": "link",
        "links": [
            "032e3829752acb0f"
        ],
        "x": 1155,
        "y": 200,
        "wires": []
    },
    {
        "id": "45117e09372083fa",
        "type": "function",
        "z": "11c15729dad50c39",
        "g": "538434f8ada5abb4",
        "name": "Send All",
        "func": "let data_msg = context.global.data || {};\nlet data_timestamp = context.global.timetamp || {};\n\nlet atime = Date.now();\n\nfor (var key in data_msg)\n{\n    let timestamp = 0;\n    if (data_timestamp.hasOwnProperty(key)) {\n        timestamp = data_timestamp[key];\n    }\n    if (data_msg.hasOwnProperty(key))\n    {\n        let timediff = (atime - timestamp) / 1000;\n        if (timediff < 60)\n            continue;\n        //node.warn(\"key: \" + key + \", value: \" + data_msg[key] + \", time: \"  + timestamp);\n        msg.topic = key;\n        msg.payload = data_msg[key];\n        msg.sendnow = true;\n        node.send(msg);\n    }\n}\nreturn;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 540,
        "y": 1520,
        "wires": [
            [
                "0cc4ffd6af2c92ed"
            ]
        ]
    },
    {
        "id": "9afa29835011a413",
        "type": "inject",
        "z": "11c15729dad50c39",
        "g": "538434f8ada5abb4",
        "name": "Timer 60s",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "5",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 350,
        "y": 1520,
        "wires": [
            [
                "45117e09372083fa"
            ]
        ]
    },
    {
        "id": "7a446c7d181c7c70",
        "type": "function",
        "z": "11c15729dad50c39",
        "g": "4173e8883e32011b",
        "name": "IF ( SP <=0 && SOC < min_soc)  THEN  SP = 100",
        "func": "let data = context.global.data || {};\nlet soc = data[\"batt_soc\"];\nlet ess_setpoint = data[\"ess_setpoint\"];\n\nif (ess_setpoint <=0 && soc < context.global.min_soc){\n    msg.payload = 100;\n    return msg;    \n}\n",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 470,
        "y": 1660,
        "wires": [
            [
                "186a96fe60498683"
            ]
        ]
    },
    {
        "id": "5b7b8103806efc12",
        "type": "mqtt in",
        "z": "11c15729dad50c39",
        "g": "1bf2cbfd211c76f8",
        "name": "Battery State",
        "topic": "my_victron/set/batt_state",
        "qos": "2",
        "datatype": "auto-detect",
        "broker": "ee1bb25c871ce5fc",
        "nl": false,
        "rap": true,
        "rh": 0,
        "inputs": 0,
        "x": 110,
        "y": 1980,
        "wires": [
            [
                "26c547fb7bc88cee"
            ]
        ]
    },
    {
        "id": "26c547fb7bc88cee",
        "type": "function",
        "z": "11c15729dad50c39",
        "g": "1bf2cbfd211c76f8",
        "name": "Battety State",
        "func": "msg.topic = \"batt_state\";\nmsg.sendnow = true;\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 290,
        "y": 1980,
        "wires": [
            [
                "b6dfbbd90ef362fd"
            ]
        ]
    },
    {
        "id": "b6dfbbd90ef362fd",
        "type": "link out",
        "z": "11c15729dad50c39",
        "g": "1bf2cbfd211c76f8",
        "name": "ToMQTT",
        "mode": "link",
        "links": [
            "04b33f5ed2e152e1"
        ],
        "x": 395,
        "y": 1980,
        "wires": []
    },
    {
        "id": "57447ed22f5a3c27",
        "type": "victron-input-battery",
        "z": "11c15729dad50c39",
        "g": "538434f8ada5abb4",
        "service": "com.victronenergy.battery/279",
        "path": "/History/ChargedEnergy",
        "serviceObj": {
            "service": "com.victronenergy.battery/279",
            "name": "SmartShunt 500A/50mV"
        },
        "pathObj": {
            "path": "/History/ChargedEnergy",
            "type": "float",
            "name": "Charged Energy (kWh)"
        },
        "initial": "",
        "name": "SmartShunt | Battery Charged (kWh)",
        "onlyChanges": true,
        "roundValues": "3",
        "x": 180,
        "y": 480,
        "wires": [
            [
                "c08db8232c5fd37d"
            ]
        ]
    },
    {
        "id": "c375d87f6ea3bb74",
        "type": "victron-input-battery",
        "z": "11c15729dad50c39",
        "g": "538434f8ada5abb4",
        "service": "com.victronenergy.battery/279",
        "path": "/History/DischargedEnergy",
        "serviceObj": {
            "service": "com.victronenergy.battery/279",
            "name": "SmartShunt 500A/50mV"
        },
        "pathObj": {
            "path": "/History/DischargedEnergy",
            "type": "float",
            "name": "Discharged Energy (kWh)"
        },
        "initial": "",
        "name": "SmartShunt | Battery Discharged (kWh)",
        "onlyChanges": true,
        "roundValues": "3",
        "x": 190,
        "y": 520,
        "wires": [
            [
                "e0aa73f0d9258546"
            ]
        ]
    },
    {
        "id": "f6bbde458a85b6c6",
        "type": "victron-input-battery",
        "z": "11c15729dad50c39",
        "g": "538434f8ada5abb4",
        "service": "com.victronenergy.battery/279",
        "path": "/Dc/0/Power",
        "serviceObj": {
            "service": "com.victronenergy.battery/279",
            "name": "SmartShunt 500A/50mV"
        },
        "pathObj": {
            "path": "/Dc/0/Power",
            "type": "float",
            "name": "Battery power (W)"
        },
        "initial": "",
        "name": "SmartShunt | Battery Power (W)",
        "onlyChanges": true,
        "roundValues": "2",
        "x": 170,
        "y": 560,
        "wires": [
            [
                "0e11460ee019f369"
            ]
        ]
    },
    {
        "id": "0e11460ee019f369",
        "type": "function",
        "z": "11c15729dad50c39",
        "g": "538434f8ada5abb4",
        "name": "PwrDist",
        "func": "let msg2 = RED.util.cloneMessage(msg);\nmsg2.payload = 0;\nif (msg.payload < 0)\n{\n    msg2.payload = Math.abs(msg.payload);\n    msg.payload = 0;\n}\nreturn [msg, msg2];",
        "outputs": 2,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 380,
        "y": 560,
        "wires": [
            [
                "426454ccf5f41ce9"
            ],
            [
                "44af7ae1d270db90"
            ]
        ]
    },
    {
        "id": "3f96fb98555546bc",
        "type": "comment",
        "z": "11c15729dad50c39",
        "name": "Version 1.13",
        "info": "2025-11-23 Version 1.13\n- Added more status MQTT outputs\n- Made most flow.context variables global\n- Moved the Meter Grid part to another flow\n\n2025-08-26 Version 1.12\n- Added MPPT stats\n\n2025-03-21 Version 1.11\n- charge_state, if unknown, add payload ID\n\n2025-03-16\n- Added separate Smartshunt SOC reporting\n\n2025-03-08\n- MQTT Sensors, more compatible with HASS (device class/measurement)\n\n2024-06-08\n- Added Multiplus AC-In Power/Energy sensor\n\n2024-04-27\n- Fixed Basen Batt Temp",
        "x": 890,
        "y": 340,
        "wires": []
    },
    {
        "id": "404abbe7e621dc1f",
        "type": "change",
        "z": "11c15729dad50c39",
        "g": "538434f8ada5abb4",
        "name": "T=Voltage",
        "rules": [
            {
                "t": "set",
                "p": "topic",
                "pt": "msg",
                "to": "batt_voltage",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 560,
        "y": 400,
        "wires": [
            [
                "0cc4ffd6af2c92ed"
            ]
        ]
    },
    {
        "id": "60ddd275525b3f49",
        "type": "change",
        "z": "11c15729dad50c39",
        "g": "538434f8ada5abb4",
        "name": "T=Amps",
        "rules": [
            {
                "t": "set",
                "p": "topic",
                "pt": "msg",
                "to": "batt_amps",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 560,
        "y": 440,
        "wires": [
            [
                "0cc4ffd6af2c92ed"
            ]
        ]
    },
    {
        "id": "c08db8232c5fd37d",
        "type": "change",
        "z": "11c15729dad50c39",
        "g": "538434f8ada5abb4",
        "name": "T=Charged kWh",
        "rules": [
            {
                "t": "set",
                "p": "topic",
                "pt": "msg",
                "to": "batt_charged_kwh",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 540,
        "y": 480,
        "wires": [
            [
                "0cc4ffd6af2c92ed"
            ]
        ]
    },
    {
        "id": "e0aa73f0d9258546",
        "type": "change",
        "z": "11c15729dad50c39",
        "g": "538434f8ada5abb4",
        "name": "T=Disharged kWh",
        "rules": [
            {
                "t": "set",
                "p": "topic",
                "pt": "msg",
                "to": "batt_discharged_kwh",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 530,
        "y": 520,
        "wires": [
            [
                "0cc4ffd6af2c92ed"
            ]
        ]
    },
    {
        "id": "7d54a1b3cffc67b4",
        "type": "change",
        "z": "11c15729dad50c39",
        "g": "538434f8ada5abb4",
        "name": "T=Setpoint",
        "rules": [
            {
                "t": "set",
                "p": "topic",
                "pt": "msg",
                "to": "ess_setpoint",
                "tot": "str"
            },
            {
                "t": "set",
                "p": "sendnow",
                "pt": "msg",
                "to": "true",
                "tot": "bool"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 550,
        "y": 220,
        "wires": [
            [
                "0cc4ffd6af2c92ed"
            ]
        ]
    },
    {
        "id": "175c74606259bb38",
        "type": "change",
        "z": "11c15729dad50c39",
        "g": "538434f8ada5abb4",
        "name": "T=SOC",
        "rules": [
            {
                "t": "set",
                "p": "topic",
                "pt": "msg",
                "to": "batt_soc",
                "tot": "str"
            },
            {
                "t": "set",
                "p": "sendnow",
                "pt": "msg",
                "to": "true",
                "tot": "bool"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 560,
        "y": 280,
        "wires": [
            [
                "0cc4ffd6af2c92ed"
            ]
        ]
    },
    {
        "id": "426454ccf5f41ce9",
        "type": "change",
        "z": "11c15729dad50c39",
        "g": "538434f8ada5abb4",
        "name": "T=Charged W",
        "rules": [
            {
                "t": "set",
                "p": "topic",
                "pt": "msg",
                "to": "batt_charged_w",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 540,
        "y": 560,
        "wires": [
            [
                "0cc4ffd6af2c92ed"
            ]
        ]
    },
    {
        "id": "44af7ae1d270db90",
        "type": "change",
        "z": "11c15729dad50c39",
        "g": "538434f8ada5abb4",
        "name": "T=Dischardwd W",
        "rules": [
            {
                "t": "set",
                "p": "topic",
                "pt": "msg",
                "to": "batt_discharged_w",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 530,
        "y": 580,
        "wires": [
            [
                "0cc4ffd6af2c92ed"
            ]
        ]
    },
    {
        "id": "b56ef4d4767031c5",
        "type": "change",
        "z": "11c15729dad50c39",
        "g": "538434f8ada5abb4",
        "name": "T=Temp 1",
        "rules": [
            {
                "t": "set",
                "p": "topic",
                "pt": "msg",
                "to": "temp_1",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 560,
        "y": 680,
        "wires": [
            [
                "0cc4ffd6af2c92ed"
            ]
        ]
    },
    {
        "id": "37ea20bd42d9fef6",
        "type": "change",
        "z": "11c15729dad50c39",
        "g": "538434f8ada5abb4",
        "name": "T=Temp 2",
        "rules": [
            {
                "t": "set",
                "p": "topic",
                "pt": "msg",
                "to": "temp_2",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 560,
        "y": 720,
        "wires": [
            [
                "0cc4ffd6af2c92ed"
            ]
        ]
    },
    {
        "id": "379778cec535f398",
        "type": "change",
        "z": "11c15729dad50c39",
        "g": "538434f8ada5abb4",
        "name": "T=Temp 3",
        "rules": [
            {
                "t": "set",
                "p": "topic",
                "pt": "msg",
                "to": "temp_3",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 560,
        "y": 760,
        "wires": [
            [
                "0cc4ffd6af2c92ed"
            ]
        ]
    },
    {
        "id": "7b96f665eb122495",
        "type": "change",
        "z": "11c15729dad50c39",
        "g": "538434f8ada5abb4",
        "name": "T=Basen SOC",
        "rules": [
            {
                "t": "set",
                "p": "topic",
                "pt": "msg",
                "to": "basenvt_soc",
                "tot": "str"
            },
            {
                "t": "set",
                "p": "sendnow",
                "pt": "msg",
                "to": "true",
                "tot": "bool"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 540,
        "y": 920,
        "wires": [
            [
                "0cc4ffd6af2c92ed"
            ]
        ]
    },
    {
        "id": "615522e20c187a0e",
        "type": "change",
        "z": "11c15729dad50c39",
        "g": "538434f8ada5abb4",
        "name": "T=Basen Voltage",
        "rules": [
            {
                "t": "set",
                "p": "topic",
                "pt": "msg",
                "to": "basenvt_voltage",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 530,
        "y": 960,
        "wires": [
            [
                "0cc4ffd6af2c92ed"
            ]
        ]
    },
    {
        "id": "07067fa9860f9e2f",
        "type": "change",
        "z": "11c15729dad50c39",
        "g": "538434f8ada5abb4",
        "name": "T=Basen Amps",
        "rules": [
            {
                "t": "set",
                "p": "topic",
                "pt": "msg",
                "to": "basenvt_amps",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 540,
        "y": 1000,
        "wires": [
            [
                "0cc4ffd6af2c92ed"
            ]
        ]
    },
    {
        "id": "2fde97888a47cbe5",
        "type": "change",
        "z": "11c15729dad50c39",
        "g": "538434f8ada5abb4",
        "name": "T=BTemp",
        "rules": [
            {
                "t": "set",
                "p": "topic",
                "pt": "msg",
                "to": "batt_temp",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 560,
        "y": 620,
        "wires": [
            [
                "0cc4ffd6af2c92ed"
            ]
        ]
    },
    {
        "id": "4265710cca04214d",
        "type": "debug",
        "z": "11c15729dad50c39",
        "g": "118adc3f7ab8b995",
        "name": "debug 58",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "false",
        "statusVal": "",
        "statusType": "auto",
        "x": 1300,
        "y": 100,
        "wires": []
    },
    {
        "id": "29bf06e828834f98",
        "type": "victron-input-battery",
        "z": "11c15729dad50c39",
        "g": "538434f8ada5abb4",
        "service": "com.victronenergy.battery/279",
        "path": "/Soc",
        "serviceObj": {
            "service": "com.victronenergy.battery/279",
            "name": "SmartShunt 500A/50mV"
        },
        "pathObj": {
            "path": "/Soc",
            "type": "float",
            "name": "State of charge (%)"
        },
        "initial": "",
        "name": "SmartShunt | State of Charge (%s)",
        "onlyChanges": true,
        "roundValues": "1",
        "x": 180,
        "y": 360,
        "wires": [
            [
                "ef39bdefab74d1dd"
            ]
        ]
    },
    {
        "id": "7e6bb5e97122dcb5",
        "type": "victron-input-system",
        "z": "11c15729dad50c39",
        "g": "538434f8ada5abb4",
        "service": "com.victronenergy.system/0",
        "path": "/Dc/Battery/Soc",
        "serviceObj": {
            "service": "com.victronenergy.system/0",
            "name": "Venus system"
        },
        "pathObj": {
            "path": "/Dc/Battery/Soc",
            "type": "float",
            "name": "Battery State of Charge (%)"
        },
        "name": "Venus Battery | State of Charge (%)",
        "onlyChanges": true,
        "roundValues": "1",
        "x": 180,
        "y": 280,
        "wires": [
            [
                "f684634197238553",
                "57b85b918dc8b58a",
                "175c74606259bb38"
            ]
        ]
    },
    {
        "id": "ef39bdefab74d1dd",
        "type": "change",
        "z": "11c15729dad50c39",
        "g": "538434f8ada5abb4",
        "name": "T=Smart SOC",
        "rules": [
            {
                "t": "set",
                "p": "topic",
                "pt": "msg",
                "to": "smartshunt_soc",
                "tot": "str"
            },
            {
                "t": "set",
                "p": "sendnow",
                "pt": "msg",
                "to": "true",
                "tot": "bool"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 540,
        "y": 360,
        "wires": [
            [
                "0cc4ffd6af2c92ed"
            ]
        ]
    },
    {
        "id": "6cde60b4c7585891",
        "type": "victron-input-solarcharger",
        "z": "11c15729dad50c39",
        "g": "538434f8ada5abb4",
        "service": "com.victronenergy.solarcharger/278",
        "path": "/Pv/V",
        "serviceObj": {
            "service": "com.victronenergy.solarcharger/278",
            "name": "SmartSolar Charger MPPT 150/45 rev3"
        },
        "pathObj": {
            "path": "/Pv/V",
            "type": "float",
            "name": "PV voltage"
        },
        "name": "MPPT Voltage",
        "onlyChanges": true,
        "roundValues": "2",
        "x": 110,
        "y": 1040,
        "wires": [
            [
                "6f28f251feaec99c"
            ]
        ]
    },
    {
        "id": "5747688d3b58b44f",
        "type": "victron-input-solarcharger",
        "z": "11c15729dad50c39",
        "g": "538434f8ada5abb4",
        "service": "com.victronenergy.solarcharger/278",
        "path": "/Yield/Power",
        "serviceObj": {
            "service": "com.victronenergy.solarcharger/278",
            "name": "SmartSolar Charger MPPT 150/45 rev3"
        },
        "pathObj": {
            "path": "/Yield/Power",
            "type": "float",
            "name": "PV Power (W)"
        },
        "name": "MPPT Watt",
        "onlyChanges": true,
        "roundValues": "2",
        "x": 110,
        "y": 1160,
        "wires": [
            [
                "840c6a167c2978d4"
            ]
        ]
    },
    {
        "id": "f23d66c23430238c",
        "type": "victron-input-solarcharger",
        "z": "11c15729dad50c39",
        "g": "538434f8ada5abb4",
        "service": "com.victronenergy.solarcharger/278",
        "path": "/Yield/User",
        "serviceObj": {
            "service": "com.victronenergy.solarcharger/278",
            "name": "SmartSolar Charger MPPT 150/45 rev3"
        },
        "pathObj": {
            "path": "/Yield/User",
            "type": "string",
            "name": "Yield since reset (kWh)"
        },
        "name": "MPPT kWh",
        "onlyChanges": true,
        "x": 110,
        "y": 1200,
        "wires": [
            [
                "a8359c3bb7176b44"
            ]
        ]
    },
    {
        "id": "6f28f251feaec99c",
        "type": "change",
        "z": "11c15729dad50c39",
        "g": "538434f8ada5abb4",
        "name": "T=MPPT Voltage",
        "rules": [
            {
                "t": "set",
                "p": "topic",
                "pt": "msg",
                "to": "mppt_voltage",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 530,
        "y": 1040,
        "wires": [
            [
                "0cc4ffd6af2c92ed"
            ]
        ]
    },
    {
        "id": "840c6a167c2978d4",
        "type": "change",
        "z": "11c15729dad50c39",
        "g": "538434f8ada5abb4",
        "name": "T=MPPT W",
        "rules": [
            {
                "t": "set",
                "p": "topic",
                "pt": "msg",
                "to": "mppt_w",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 550,
        "y": 1160,
        "wires": [
            [
                "0cc4ffd6af2c92ed"
            ]
        ]
    },
    {
        "id": "a8359c3bb7176b44",
        "type": "change",
        "z": "11c15729dad50c39",
        "g": "538434f8ada5abb4",
        "name": "T=MPPT kWh",
        "rules": [
            {
                "t": "set",
                "p": "topic",
                "pt": "msg",
                "to": "mppt_kwh",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 540,
        "y": 1200,
        "wires": [
            [
                "0cc4ffd6af2c92ed"
            ]
        ]
    },
    {
        "id": "3ba65bd50d3c2520",
        "type": "victron-input-solarcharger",
        "z": "11c15729dad50c39",
        "g": "538434f8ada5abb4",
        "service": "com.victronenergy.solarcharger/278",
        "path": "/Dc/0/Current",
        "serviceObj": {
            "service": "com.victronenergy.solarcharger/278",
            "name": "SmartSolar Charger MPPT 150/45 rev3"
        },
        "pathObj": {
            "path": "/Dc/0/Current",
            "type": "float",
            "name": "Battery current (A)"
        },
        "name": "MPPT Battery Amps",
        "onlyChanges": true,
        "roundValues": "2",
        "x": 130,
        "y": 1080,
        "wires": [
            [
                "e6571047b98d4d18"
            ]
        ]
    },
    {
        "id": "e6571047b98d4d18",
        "type": "change",
        "z": "11c15729dad50c39",
        "g": "538434f8ada5abb4",
        "name": "T=MPPT Batt Amps",
        "rules": [
            {
                "t": "set",
                "p": "topic",
                "pt": "msg",
                "to": "mppt_batt_amps",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 530,
        "y": 1080,
        "wires": [
            [
                "0cc4ffd6af2c92ed"
            ]
        ]
    },
    {
        "id": "f9cde63fa478af22",
        "type": "change",
        "z": "11c15729dad50c39",
        "g": "538434f8ada5abb4",
        "name": "T=MPPT Batt Voltage",
        "rules": [
            {
                "t": "set",
                "p": "topic",
                "pt": "msg",
                "to": "mppt_batt_voltage",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 520,
        "y": 1120,
        "wires": [
            []
        ]
    },
    {
        "id": "e36bd2ef40431b8e",
        "type": "victron-input-solarcharger",
        "z": "11c15729dad50c39",
        "service": "com.victronenergy.solarcharger/278",
        "path": "/Dc/0/Voltage",
        "serviceObj": {
            "service": "com.victronenergy.solarcharger/278",
            "name": "SmartSolar Charger MPPT 150/45 rev3"
        },
        "pathObj": {
            "path": "/Dc/0/Voltage",
            "type": "float",
            "name": "Battery voltage (V)"
        },
        "name": "MPPT Battery Voltage",
        "onlyChanges": true,
        "roundValues": "2",
        "x": 140,
        "y": 1120,
        "wires": [
            [
                "f9cde63fa478af22"
            ]
        ]
    },
    {
        "id": "bfa92a18fea9f6db",
        "type": "join",
        "z": "11c15729dad50c39",
        "g": "538434f8ada5abb4",
        "name": "",
        "mode": "custom",
        "build": "object",
        "property": "payload",
        "propertyType": "msg",
        "key": "topic",
        "joiner": "\\n",
        "joinerType": "str",
        "accumulate": false,
        "timeout": "",
        "count": "2",
        "reduceRight": false,
        "reduceExp": "",
        "reduceInit": "",
        "reduceInitType": "",
        "reduceFixup": "",
        "x": 370,
        "y": 1300,
        "wires": [
            [
                "08d57892154c3cb4"
            ]
        ]
    },
    {
        "id": "a6423dd0f1e82e68",
        "type": "victron-input-pvinverter",
        "z": "11c15729dad50c39",
        "g": "538434f8ada5abb4",
        "service": "com.victronenergy.pvinverter/100",
        "path": "/Ac/Power",
        "serviceObj": {
            "service": "com.victronenergy.pvinverter/100",
            "name": "Enphase PV"
        },
        "pathObj": {
            "path": "/Ac/Power",
            "type": "float",
            "name": "Total Power (W)"
        },
        "name": "Enphase Total W",
        "onlyChanges": true,
        "roundValues": "2",
        "x": 120,
        "y": 1260,
        "wires": [
            [
                "541f06a9d0f87b5d"
            ]
        ]
    },
    {
        "id": "4ada7c9f8dd3d3c1",
        "type": "victron-input-solarcharger",
        "z": "11c15729dad50c39",
        "g": "538434f8ada5abb4",
        "service": "com.victronenergy.solarcharger/278",
        "path": "/Yield/Power",
        "serviceObj": {
            "service": "com.victronenergy.solarcharger/278",
            "name": "SmartSolar Charger MPPT 150/45 rev3"
        },
        "pathObj": {
            "path": "/Yield/Power",
            "type": "float",
            "name": "PV Power (W)"
        },
        "name": "MPPT Total W",
        "onlyChanges": true,
        "roundValues": "2",
        "x": 110,
        "y": 1300,
        "wires": [
            [
                "b49b296aba2f2640"
            ]
        ]
    },
    {
        "id": "08d57892154c3cb4",
        "type": "function",
        "z": "11c15729dad50c39",
        "g": "538434f8ada5abb4",
        "name": "Sum",
        "func": "if (\n    (msg.payload.hasOwnProperty(\"enphase_w\"))\n    && (msg.payload.hasOwnProperty(\"mptt_w\"))\n    )\n{\n    msg.payload = Math.round( parseFloat(msg.payload[\"enphase_w\"] + msg.payload[\"mptt_w\"]) * 100 + Number.EPSILON ) / 100;\n    return msg;\n}\nreturn null;\n",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 490,
        "y": 1280,
        "wires": [
            [
                "ede92800fa8827c8"
            ]
        ]
    },
    {
        "id": "a7c4e9efa7a9ad71",
        "type": "victron-input-pvinverter",
        "z": "11c15729dad50c39",
        "g": "538434f8ada5abb4",
        "service": "com.victronenergy.pvinverter/100",
        "path": "/Ac/L1/Energy/Forward",
        "serviceObj": {
            "service": "com.victronenergy.pvinverter/100",
            "name": "Enphase PV"
        },
        "pathObj": {
            "path": "/Ac/L1/Energy/Forward",
            "type": "float",
            "name": "L1 Energy (kWh)"
        },
        "name": "Enphase Total kWh",
        "onlyChanges": true,
        "roundValues": "3",
        "x": 130,
        "y": 1400,
        "wires": [
            [
                "52635842ffb1ac5d"
            ]
        ]
    },
    {
        "id": "62d135e4024d12da",
        "type": "victron-input-solarcharger",
        "z": "11c15729dad50c39",
        "g": "538434f8ada5abb4",
        "service": "com.victronenergy.solarcharger/278",
        "path": "/Yield/System",
        "serviceObj": {
            "service": "com.victronenergy.solarcharger/278",
            "name": "MPPT Schuur"
        },
        "pathObj": {
            "path": "/Yield/System",
            "type": "string",
            "name": "Yield since last update (kWh)"
        },
        "name": "MPPT Total kWh",
        "onlyChanges": true,
        "roundValues": "3",
        "x": 120,
        "y": 1440,
        "wires": [
            [
                "62ad99913dec0ba2"
            ]
        ]
    },
    {
        "id": "b55619ca5fa84624",
        "type": "join",
        "z": "11c15729dad50c39",
        "g": "538434f8ada5abb4",
        "name": "",
        "mode": "custom",
        "build": "object",
        "property": "payload",
        "propertyType": "msg",
        "key": "topic",
        "joiner": "\\n",
        "joinerType": "str",
        "accumulate": false,
        "timeout": "",
        "count": "2",
        "reduceRight": false,
        "reduceExp": "",
        "reduceInit": "",
        "reduceInitType": "",
        "reduceFixup": "",
        "x": 390,
        "y": 1420,
        "wires": [
            [
                "6f2b84af6c198677"
            ]
        ]
    },
    {
        "id": "6f2b84af6c198677",
        "type": "function",
        "z": "11c15729dad50c39",
        "g": "538434f8ada5abb4",
        "name": "Sum",
        "func": "if (\n    (msg.payload.hasOwnProperty(\"enphase_kwh\"))\n    && (msg.payload.hasOwnProperty(\"mptt_kwh\"))\n    )\n{\n    msg.payload = Math.round( parseFloat(msg.payload[\"enphase_kwh\"] + msg.payload[\"mptt_kwh\"]) * 1000 + Number.EPSILON ) / 1000;\n    return msg;        \n}\nreturn null;\n\n\n",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 490,
        "y": 1380,
        "wires": [
            [
                "77168ea5a5341a8e"
            ]
        ]
    },
    {
        "id": "ede92800fa8827c8",
        "type": "change",
        "z": "11c15729dad50c39",
        "g": "538434f8ada5abb4",
        "name": "T=TotPV W",
        "rules": [
            {
                "t": "set",
                "p": "topic",
                "pt": "msg",
                "to": "totpv_w",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 650,
        "y": 1280,
        "wires": [
            [
                "0cc4ffd6af2c92ed"
            ]
        ]
    },
    {
        "id": "77168ea5a5341a8e",
        "type": "change",
        "z": "11c15729dad50c39",
        "g": "538434f8ada5abb4",
        "name": "T=TotPV kWh",
        "rules": [
            {
                "t": "set",
                "p": "topic",
                "pt": "msg",
                "to": "totpv_kwh",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 640,
        "y": 1400,
        "wires": [
            [
                "0cc4ffd6af2c92ed",
                "f26bbe4dd29ec42c"
            ]
        ]
    },
    {
        "id": "f26bbe4dd29ec42c",
        "type": "debug",
        "z": "11c15729dad50c39",
        "g": "538434f8ada5abb4",
        "name": "debug 1",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "false",
        "statusVal": "",
        "statusType": "auto",
        "x": 620,
        "y": 1440,
        "wires": []
    },
    {
        "id": "52635842ffb1ac5d",
        "type": "change",
        "z": "11c15729dad50c39",
        "g": "538434f8ada5abb4",
        "name": "T=enphase_kwh",
        "rules": [
            {
                "t": "set",
                "p": "topic",
                "pt": "msg",
                "to": "enphase_kwh",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 320,
        "y": 1380,
        "wires": [
            [
                "b55619ca5fa84624"
            ]
        ]
    },
    {
        "id": "62ad99913dec0ba2",
        "type": "change",
        "z": "11c15729dad50c39",
        "g": "538434f8ada5abb4",
        "name": "T=mptt_kwh",
        "rules": [
            {
                "t": "set",
                "p": "topic",
                "pt": "msg",
                "to": "mptt_kwh",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 310,
        "y": 1460,
        "wires": [
            [
                "b55619ca5fa84624"
            ]
        ]
    },
    {
        "id": "541f06a9d0f87b5d",
        "type": "change",
        "z": "11c15729dad50c39",
        "g": "538434f8ada5abb4",
        "name": "T=enphase_kwh",
        "rules": [
            {
                "t": "set",
                "p": "topic",
                "pt": "msg",
                "to": "enphase_w",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 320,
        "y": 1260,
        "wires": [
            [
                "bfa92a18fea9f6db"
            ]
        ]
    },
    {
        "id": "b49b296aba2f2640",
        "type": "change",
        "z": "11c15729dad50c39",
        "g": "538434f8ada5abb4",
        "name": "T=mptt_w",
        "rules": [
            {
                "t": "set",
                "p": "topic",
                "pt": "msg",
                "to": "mptt_w",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 300,
        "y": 1340,
        "wires": [
            [
                "bfa92a18fea9f6db"
            ]
        ]
    },
    {
        "id": "e81ad5b0626f8dda",
        "type": "ui_slider",
        "z": "11c15729dad50c39",
        "g": "89166bbe87877070",
        "name": "",
        "label": "Setpoint Slider",
        "tooltip": "Changes the Setpoint",
        "group": "963cc6570d12d537",
        "order": 3,
        "width": 0,
        "height": 0,
        "passthru": false,
        "outs": "end",
        "topic": "topic",
        "topicType": "msg",
        "min": "-4200",
        "max": "4200",
        "step": "50",
        "className": "",
        "x": 315.7142791748047,
        "y": 125.71427345275879,
        "wires": [
            [
                "80fb86b547b55555"
            ]
        ]
    },
    {
        "id": "f6ccfa7a490be396",
        "type": "ui_numeric",
        "z": "11c15729dad50c39",
        "g": "89166bbe87877070",
        "name": "Setpoint-Num",
        "label": "Setpoint",
        "tooltip": "Change Setpoint",
        "group": "963cc6570d12d537",
        "order": 2,
        "width": 0,
        "height": 0,
        "wrap": false,
        "passthru": false,
        "topic": "topic",
        "topicType": "msg",
        "format": "{{value}}",
        "min": "-4200",
        "max": "4200",
        "step": "50",
        "className": "",
        "x": 115.71427917480469,
        "y": 125.71427345275879,
        "wires": [
            [
                "80fb86b547b55555"
            ]
        ]
    },
    {
        "id": "49c367a2ee0ccd43",
        "type": "ui_text",
        "z": "11c15729dad50c39",
        "g": "538434f8ada5abb4",
        "group": "963cc6570d12d537",
        "order": 5,
        "width": 6,
        "height": 1,
        "name": "Voltage",
        "label": "",
        "format": "{{msg.payload}} Volt",
        "layout": "row-center",
        "className": "",
        "style": true,
        "font": "Verdana,Verdana,Geneva,sans-serif",
        "fontSize": 16,
        "color": "#4fb4f3",
        "x": 380,
        "y": 400,
        "wires": []
    },
    {
        "id": "57b85b918dc8b58a",
        "type": "ui_gauge",
        "z": "11c15729dad50c39",
        "g": "538434f8ada5abb4",
        "name": "",
        "group": "963cc6570d12d537",
        "order": 4,
        "width": 0,
        "height": 0,
        "gtype": "gage",
        "title": "SOC",
        "label": "%",
        "format": "{{value}}",
        "min": 0,
        "max": "100",
        "colors": [
            "#d41138",
            "#e6e600",
            "#37e14b"
        ],
        "seg1": "30",
        "seg2": "80",
        "diff": false,
        "className": "",
        "x": 405.7142791748047,
        "y": 265.7142734527588,
        "wires": []
    },
    {
        "id": "45921ca6fe73540e",
        "type": "ui_chart",
        "z": "11c15729dad50c39",
        "g": "538434f8ada5abb4",
        "name": "",
        "group": "963cc6570d12d537",
        "order": 6,
        "width": 0,
        "height": 0,
        "label": "Battery Voltage",
        "chartType": "line",
        "legend": "false",
        "xformat": "HH:mm",
        "interpolate": "bezier",
        "nodata": "No data",
        "dot": false,
        "ymin": "",
        "ymax": "",
        "removeOlder": 1,
        "removeOlderPoints": "",
        "removeOlderUnit": "86400",
        "cutout": 0,
        "useOneColor": false,
        "useUTC": false,
        "colors": [
            "#1f7ec1",
            "#aec7e8",
            "#ff7f0e",
            "#2ca02c",
            "#98df8a",
            "#d62728",
            "#ff9896",
            "#9467bd",
            "#c5b0d5"
        ],
        "outputs": 1,
        "useDifferentColor": false,
        "className": "",
        "x": 400,
        "y": 420,
        "wires": [
            []
        ]
    },
    {
        "id": "1dfbf5b367b5886e",
        "type": "ui_button",
        "z": "11c15729dad50c39",
        "g": "89166bbe87877070",
        "name": "",
        "group": "963cc6570d12d537",
        "order": 1,
        "width": 0,
        "height": 0,
        "passthru": false,
        "label": "Setpoint 0",
        "tooltip": "",
        "color": "",
        "bgcolor": "",
        "className": "",
        "icon": "",
        "payload": "0",
        "payloadType": "str",
        "topic": "topic",
        "topicType": "msg",
        "x": 495.7142791748047,
        "y": 125.71427345275879,
        "wires": [
            [
                "80fb86b547b55555"
            ]
        ]
    },
    {
        "id": "00e033553ab89f04",
        "type": "ui_multistate_switch",
        "z": "11c15729dad50c39",
        "g": "538434f8ada5abb4",
        "name": "Mode Switch",
        "group": "963cc6570d12d537",
        "order": 7,
        "width": 0,
        "height": 0,
        "label": "ESS Mode",
        "stateField": "payload",
        "enableField": "enable",
        "passthroughField": "passthrough",
        "inputMsgField": "inputmsg",
        "rounded": true,
        "useThemeColors": false,
        "hideSelectedLabel": false,
        "multilineLabel": false,
        "passThrough": "never",
        "inputMsg": "all",
        "userInput": "disabled",
        "options": [
            {
                "label": "Mode 1",
                "value": "1",
                "valueType": "num",
                "color": "#ef4d4d"
            },
            {
                "label": "Mode 2",
                "value": "2",
                "valueType": "num",
                "color": "#0bfecd"
            }
        ],
        "topic": "",
        "x": 290,
        "y": 840,
        "wires": [
            [
                "4a2b5c0c4430540b"
            ]
        ]
    },
    {
        "id": "fbf67a6f4252ba21",
        "type": "ui_multistate_switch",
        "z": "11c15729dad50c39",
        "g": "538434f8ada5abb4",
        "name": "MP2 On/Off",
        "group": "963cc6570d12d537",
        "order": 8,
        "width": 0,
        "height": 0,
        "label": "MP2 On/Off",
        "stateField": "payload",
        "enableField": "enable",
        "passthroughField": "passthrough",
        "inputMsgField": "inputmsg",
        "rounded": true,
        "useThemeColors": false,
        "hideSelectedLabel": false,
        "multilineLabel": false,
        "passThrough": "never",
        "inputMsg": "all",
        "userInput": "disabled",
        "options": [
            {
                "label": "Off",
                "value": "4",
                "valueType": "num",
                "color": "#ef4d4d"
            },
            {
                "label": "On",
                "value": "3",
                "valueType": "num",
                "color": "#0bfecd"
            }
        ],
        "topic": "",
        "x": 350,
        "y": 880,
        "wires": [
            [
                "c7f7c335facd37dc",
                "c98824900c31e120"
            ]
        ]
    },
    {
        "id": "e47dc594821908f6",
        "type": "change",
        "z": "ddb33f2863df98a5",
        "g": "47e7ac41789299da",
        "name": "T=Watt L2",
        "rules": [
            {
                "t": "set",
                "p": "topic",
                "pt": "msg",
                "to": "grid_l2_w",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 250,
        "y": 540,
        "wires": [
            [
                "9f57393bfcc1edd5"
            ]
        ]
    },
    {
        "id": "6cdbabcda9bb1bf0",
        "type": "victron-input-system",
        "z": "ddb33f2863df98a5",
        "g": "47e7ac41789299da",
        "service": "com.victronenergy.system/0",
        "path": "/Ac/Grid/L1/Power",
        "serviceObj": {
            "service": "com.victronenergy.system/0",
            "name": "Venus system"
        },
        "pathObj": {
            "path": "/Ac/Grid/L1/Power",
            "type": "float",
            "name": "Grid L1 (W)"
        },
        "name": "L1 W",
        "onlyChanges": true,
        "roundValues": "2",
        "x": 90,
        "y": 500,
        "wires": [
            [
                "d3d3bb4f0f6580d2"
            ]
        ]
    },
    {
        "id": "24ccb95d5cd0531a",
        "type": "victron-input-system",
        "z": "ddb33f2863df98a5",
        "g": "47e7ac41789299da",
        "service": "com.victronenergy.system/0",
        "path": "/Ac/Grid/L2/Power",
        "serviceObj": {
            "service": "com.victronenergy.system/0",
            "name": "Venus system"
        },
        "pathObj": {
            "path": "/Ac/Grid/L2/Power",
            "type": "float",
            "name": "Grid L2 (W)"
        },
        "name": "L2 W",
        "onlyChanges": true,
        "roundValues": "2",
        "x": 90,
        "y": 540,
        "wires": [
            [
                "e47dc594821908f6"
            ]
        ]
    },
    {
        "id": "afc2538e4de57b73",
        "type": "victron-input-system",
        "z": "ddb33f2863df98a5",
        "g": "47e7ac41789299da",
        "service": "com.victronenergy.system/0",
        "path": "/Ac/Grid/L3/Power",
        "serviceObj": {
            "service": "com.victronenergy.system/0",
            "name": "Venus system"
        },
        "pathObj": {
            "path": "/Ac/Grid/L3/Power",
            "type": "float",
            "name": "Grid L3 (W)"
        },
        "name": "L3 W",
        "onlyChanges": true,
        "roundValues": "2",
        "x": 90,
        "y": 580,
        "wires": [
            [
                "581f56ae065b75ef"
            ]
        ]
    },
    {
        "id": "581f56ae065b75ef",
        "type": "change",
        "z": "ddb33f2863df98a5",
        "g": "47e7ac41789299da",
        "name": "T=Watt L3",
        "rules": [
            {
                "t": "set",
                "p": "topic",
                "pt": "msg",
                "to": "grid_l3_w",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 250,
        "y": 580,
        "wires": [
            [
                "9f57393bfcc1edd5"
            ]
        ]
    },
    {
        "id": "d3d3bb4f0f6580d2",
        "type": "change",
        "z": "ddb33f2863df98a5",
        "g": "47e7ac41789299da",
        "name": "T=Watt L1",
        "rules": [
            {
                "t": "set",
                "p": "topic",
                "pt": "msg",
                "to": "grid_l1_w",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 250,
        "y": 500,
        "wires": [
            [
                "9f57393bfcc1edd5"
            ]
        ]
    },
    {
        "id": "7b60dc31a2076b1f",
        "type": "victron-input-vebus",
        "z": "ddb33f2863df98a5",
        "g": "4294fa5adf1d40cc",
        "service": "com.victronenergy.vebus/276",
        "path": "/Energy/AcIn1ToInverter",
        "serviceObj": {
            "service": "com.victronenergy.vebus/276",
            "name": "MultiPlus"
        },
        "pathObj": {
            "path": "/Energy/AcIn1ToInverter",
            "type": "float",
            "name": "Energy AcIn1 to Inverter (kWh)"
        },
        "initial": "",
        "name": "Input (kWh)",
        "onlyChanges": true,
        "roundValues": "3",
        "x": 110,
        "y": 180,
        "wires": [
            [
                "50b5220643150202"
            ]
        ]
    },
    {
        "id": "b586e0714822d972",
        "type": "victron-input-vebus",
        "z": "ddb33f2863df98a5",
        "g": "4294fa5adf1d40cc",
        "service": "com.victronenergy.vebus/276",
        "path": "/Ac/ActiveIn/L1/P",
        "serviceObj": {
            "service": "com.victronenergy.vebus/276",
            "name": "MultiPlus"
        },
        "pathObj": {
            "path": "/Ac/ActiveIn/L1/P",
            "type": "float",
            "name": "Input power phase 1 (W)"
        },
        "initial": "",
        "name": "Input Phase 1 (W)",
        "onlyChanges": true,
        "roundValues": "2",
        "x": 130,
        "y": 60,
        "wires": [
            [
                "e473f1d46fb5501d"
            ]
        ]
    },
    {
        "id": "11f92e80b464a1d6",
        "type": "join",
        "z": "ddb33f2863df98a5",
        "g": "4294fa5adf1d40cc",
        "name": "",
        "mode": "custom",
        "build": "object",
        "property": "payload",
        "propertyType": "msg",
        "key": "topic",
        "joiner": "\\n",
        "joinerType": "str",
        "accumulate": true,
        "timeout": "",
        "count": "3",
        "reduceRight": false,
        "reduceExp": "",
        "reduceInit": "",
        "reduceInitType": "",
        "reduceFixup": "",
        "x": 450,
        "y": 100,
        "wires": [
            [
                "e658be2b36231f2a"
            ]
        ]
    },
    {
        "id": "2ec063d33b8a7f84",
        "type": "victron-input-vebus",
        "z": "ddb33f2863df98a5",
        "g": "4294fa5adf1d40cc",
        "service": "com.victronenergy.vebus/276",
        "path": "/Ac/ActiveIn/L2/P",
        "serviceObj": {
            "service": "com.victronenergy.vebus/276",
            "name": "MultiPlus"
        },
        "pathObj": {
            "path": "/Ac/ActiveIn/L2/P",
            "type": "float",
            "name": "Input power phase 2 (W)"
        },
        "initial": "",
        "name": "Input Phase 2 (W)",
        "onlyChanges": true,
        "roundValues": "2",
        "x": 130,
        "y": 100,
        "wires": [
            [
                "6bd89a5474aadd23"
            ]
        ]
    },
    {
        "id": "c0976c39fde7935c",
        "type": "victron-input-vebus",
        "z": "ddb33f2863df98a5",
        "g": "4294fa5adf1d40cc",
        "service": "com.victronenergy.vebus/276",
        "path": "/Ac/ActiveIn/L3/P",
        "serviceObj": {
            "service": "com.victronenergy.vebus/276",
            "name": "MultiPlus"
        },
        "pathObj": {
            "path": "/Ac/ActiveIn/L3/P",
            "type": "float",
            "name": "Input power phase 3 (W)"
        },
        "initial": "",
        "name": "Input Phase 3 (W)",
        "onlyChanges": true,
        "roundValues": "2",
        "x": 130,
        "y": 140,
        "wires": [
            [
                "95d5a72a62e48b55"
            ]
        ]
    },
    {
        "id": "e473f1d46fb5501d",
        "type": "change",
        "z": "ddb33f2863df98a5",
        "g": "4294fa5adf1d40cc",
        "name": "T=phase_1",
        "rules": [
            {
                "t": "set",
                "p": "topic",
                "pt": "msg",
                "to": "mp_acin_L1",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 310,
        "y": 60,
        "wires": [
            [
                "11f92e80b464a1d6",
                "bb2045292b7784e9"
            ]
        ]
    },
    {
        "id": "6bd89a5474aadd23",
        "type": "change",
        "z": "ddb33f2863df98a5",
        "g": "4294fa5adf1d40cc",
        "name": "T=phase_2",
        "rules": [
            {
                "t": "set",
                "p": "topic",
                "pt": "msg",
                "to": "mp_acin_L2",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 310,
        "y": 100,
        "wires": [
            [
                "11f92e80b464a1d6",
                "bb2045292b7784e9"
            ]
        ]
    },
    {
        "id": "95d5a72a62e48b55",
        "type": "change",
        "z": "ddb33f2863df98a5",
        "g": "4294fa5adf1d40cc",
        "name": "T=phase_3",
        "rules": [
            {
                "t": "set",
                "p": "topic",
                "pt": "msg",
                "to": "mp_acin_L3",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 310,
        "y": 140,
        "wires": [
            [
                "11f92e80b464a1d6",
                "bb2045292b7784e9"
            ]
        ]
    },
    {
        "id": "e658be2b36231f2a",
        "type": "function",
        "z": "ddb33f2863df98a5",
        "g": "4294fa5adf1d40cc",
        "name": "Combine",
        "func": "let total = 0;\nif (msg.payload.mp_acin_L1 != null) {\n    total += msg.payload.mp_acin_L1;\n}\nif (msg.payload.mp_acin_L2 != null) {\n    total += msg.payload.mp_acin_L2;\n}\nif (msg.payload.mp_acin_L3 != null) {\n    total += msg.payload.mp_acin_L3;\n}\nmsg.topic = \"inv_acin_w\"\nmsg.payload = total;\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 580,
        "y": 100,
        "wires": [
            [
                "bb2045292b7784e9"
            ]
        ]
    },
    {
        "id": "50b5220643150202",
        "type": "change",
        "z": "ddb33f2863df98a5",
        "g": "4294fa5adf1d40cc",
        "name": "T=inv_acin_kwh",
        "rules": [
            {
                "t": "set",
                "p": "topic",
                "pt": "msg",
                "to": "inv_acin_kwh",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 560,
        "y": 180,
        "wires": [
            [
                "bb2045292b7784e9"
            ]
        ]
    },
    {
        "id": "bb2045292b7784e9",
        "type": "link out",
        "z": "ddb33f2863df98a5",
        "g": "4294fa5adf1d40cc",
        "name": "ToMQTT",
        "mode": "link",
        "links": [
            "04b33f5ed2e152e1"
        ],
        "x": 725,
        "y": 140,
        "wires": []
    },
    {
        "id": "7d4442e8b3be559b",
        "type": "victron-input-vebus",
        "z": "ddb33f2863df98a5",
        "g": "c70320bdd34da074",
        "service": "com.victronenergy.vebus/276",
        "path": "/Energy/InverterToAcOut",
        "serviceObj": {
            "service": "com.victronenergy.vebus/276",
            "name": "MultiPlus"
        },
        "pathObj": {
            "path": "/Energy/InverterToAcOut",
            "type": "float",
            "name": "Inverter To AcOut (kWh)"
        },
        "initial": "",
        "name": "Output (kWh)",
        "onlyChanges": true,
        "roundValues": "3",
        "x": 110,
        "y": 400,
        "wires": [
            [
                "a4a0fc1ffb8922e1"
            ]
        ]
    },
    {
        "id": "703433ba501facff",
        "type": "victron-input-vebus",
        "z": "ddb33f2863df98a5",
        "g": "c70320bdd34da074",
        "service": "com.victronenergy.vebus/276",
        "path": "/Ac/Out/L1/P",
        "serviceObj": {
            "service": "com.victronenergy.vebus/276",
            "name": "MultiPlus"
        },
        "pathObj": {
            "path": "/Ac/Out/L1/P",
            "type": "float",
            "name": "Output power phase 1 (W)"
        },
        "initial": "",
        "name": "Output Phase 1 (W)",
        "onlyChanges": true,
        "roundValues": "2",
        "x": 130,
        "y": 280,
        "wires": [
            [
                "d576dd0ccd6f6e4d"
            ]
        ]
    },
    {
        "id": "10a1dc4d89e95cf7",
        "type": "join",
        "z": "ddb33f2863df98a5",
        "g": "c70320bdd34da074",
        "name": "",
        "mode": "custom",
        "build": "object",
        "property": "payload",
        "propertyType": "msg",
        "key": "topic",
        "joiner": "\\n",
        "joinerType": "str",
        "accumulate": true,
        "timeout": "",
        "count": "3",
        "reduceRight": false,
        "reduceExp": "",
        "reduceInit": "",
        "reduceInitType": "",
        "reduceFixup": "",
        "x": 450,
        "y": 320,
        "wires": [
            [
                "1d0f9f6628358241"
            ]
        ]
    },
    {
        "id": "1971b9c044f82cb2",
        "type": "victron-input-vebus",
        "z": "ddb33f2863df98a5",
        "g": "c70320bdd34da074",
        "service": "com.victronenergy.vebus/276",
        "path": "/Ac/Out/L2/P",
        "serviceObj": {
            "service": "com.victronenergy.vebus/276",
            "name": "MultiPlus"
        },
        "pathObj": {
            "path": "/Ac/Out/L2/P",
            "type": "float",
            "name": "Output power phase 2 (W)"
        },
        "initial": "",
        "name": "Output Phase 2 (W)",
        "onlyChanges": true,
        "roundValues": "2",
        "x": 130,
        "y": 320,
        "wires": [
            [
                "b8e7d7de824ff8a6"
            ]
        ]
    },
    {
        "id": "dff804ee95a86520",
        "type": "victron-input-vebus",
        "z": "ddb33f2863df98a5",
        "g": "c70320bdd34da074",
        "service": "com.victronenergy.vebus/276",
        "path": "/Ac/Out/L3/P",
        "serviceObj": {
            "service": "com.victronenergy.vebus/276",
            "name": "MultiPlus"
        },
        "pathObj": {
            "path": "/Ac/Out/L3/P",
            "type": "float",
            "name": "Output power phase 3 (W)"
        },
        "initial": "",
        "name": "Output Phase 3 (W)",
        "onlyChanges": true,
        "roundValues": "2",
        "x": 130,
        "y": 360,
        "wires": [
            [
                "7e5f583d20e15433"
            ]
        ]
    },
    {
        "id": "d576dd0ccd6f6e4d",
        "type": "change",
        "z": "ddb33f2863df98a5",
        "g": "c70320bdd34da074",
        "name": "T=phase_1",
        "rules": [
            {
                "t": "set",
                "p": "topic",
                "pt": "msg",
                "to": "mp_acout1_L1",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 310,
        "y": 280,
        "wires": [
            [
                "10a1dc4d89e95cf7",
                "954eafb592ded153"
            ]
        ]
    },
    {
        "id": "b8e7d7de824ff8a6",
        "type": "change",
        "z": "ddb33f2863df98a5",
        "g": "c70320bdd34da074",
        "name": "T=phase_2",
        "rules": [
            {
                "t": "set",
                "p": "topic",
                "pt": "msg",
                "to": "mp_acout1_L2",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 310,
        "y": 320,
        "wires": [
            [
                "10a1dc4d89e95cf7",
                "954eafb592ded153"
            ]
        ]
    },
    {
        "id": "7e5f583d20e15433",
        "type": "change",
        "z": "ddb33f2863df98a5",
        "g": "c70320bdd34da074",
        "name": "T=phase_3",
        "rules": [
            {
                "t": "set",
                "p": "topic",
                "pt": "msg",
                "to": "mp_acout1_L3",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 310,
        "y": 360,
        "wires": [
            [
                "10a1dc4d89e95cf7",
                "954eafb592ded153"
            ]
        ]
    },
    {
        "id": "1d0f9f6628358241",
        "type": "function",
        "z": "ddb33f2863df98a5",
        "g": "c70320bdd34da074",
        "name": "Combine",
        "func": "let total = 0;\nif (msg.payload.mp_acout1_L1 != null) {\n    total += msg.payload.mp_acout1_L1;\n}\nif (msg.payload.mp_acout1_L2 != null) {\n    total += msg.payload.mp_acout1_L2;\n}\nif (msg.payload.mp_acout1_L3 != null) {\n    total += msg.payload.mp_acout1_L3;\n}\nmsg.topic = \"inv_acout1_w\"\nmsg.payload = total;\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 580,
        "y": 320,
        "wires": [
            [
                "954eafb592ded153"
            ]
        ]
    },
    {
        "id": "a4a0fc1ffb8922e1",
        "type": "change",
        "z": "ddb33f2863df98a5",
        "g": "c70320bdd34da074",
        "name": "T=inv_acout1_kwh",
        "rules": [
            {
                "t": "set",
                "p": "topic",
                "pt": "msg",
                "to": "inv_acout1_kwh",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 570,
        "y": 400,
        "wires": [
            [
                "954eafb592ded153"
            ]
        ]
    },
    {
        "id": "954eafb592ded153",
        "type": "link out",
        "z": "ddb33f2863df98a5",
        "g": "c70320bdd34da074",
        "name": "ToMQTT",
        "mode": "link",
        "links": [
            "04b33f5ed2e152e1"
        ],
        "x": 725,
        "y": 360,
        "wires": []
    },
    {
        "id": "9f57393bfcc1edd5",
        "type": "link out",
        "z": "ddb33f2863df98a5",
        "g": "47e7ac41789299da",
        "name": "ToMQTT",
        "mode": "link",
        "links": [
            "04b33f5ed2e152e1"
        ],
        "x": 375,
        "y": 540,
        "wires": []
    },
    {
        "id": "7fd426c7ab23f005",
        "type": "function",
        "z": "ddb33f2863df98a5",
        "g": "52734a5bffcceeef",
        "name": "Power Monitor",
        "func": "let data = context.global.data || {};\n\nif (data[\"ess_setpoint\"] == undefined) {\n    return null;\n}\nlet setpoint = data[\"ess_setpoint\"] || 0;\nlet new_setpoint = setpoint;\n\nlet L1 = data[\"grid_l1_w\"] || 0;\nlet L2 = data[\"grid_l2_w\"] || 0;\nlet L3 = data[\"grid_l3_w\"] || 0;\nlet num_multi = context.global.number_of_multiplus;\n\nlet max_phase_power = context.global.max_phase_power;\nlet idle_rate = context.global.idle_rate;\nlet adjusted = context.global.setpoint_adjusted || false;\n\n//max_phase_power = 1300;\n\n//node.warn(\"L1/L2/L3 = \" + L1 + \"/\" + L2 + \"/\" + L3)\n//node.warn(\"setpoint: \" + setpoint)\n//node.warn(\"In Power Monitor, adjusted is \" + adjusted)\n\nif (adjusted == false) {\n    if (setpoint > idle_rate) {\n        // charging\n    \tlet highest_phase_power = Math.max(L1, L2, L3);           // phase with the highest load\n        //node.warn(\"highest_phase_power: \" + highest_phase_power);\n        if (highest_phase_power > max_phase_power) {\n            node.warn(\"Charge overload adjust\");\n\n        \tlet highest_phase_power = Math.max(L1, L2, L3);           // phase with the highest load\n        \tlet delta = highest_phase_power - max_phase_power;            // how much over the max for the phase\n        \tnew_setpoint = Math.ceil(setpoint - (delta * num_multi));           // lower for each inverter as one setpoint for all\n        \tnode.warn(\"Diff = \" + delta + \" for a new setpoint of \" + new_setpoint);\n        \tnew_setpoint = Math.min(new_setpoint, idle_rate);\n        \tnode.warn(\"Setting new setpoint now to \" + new_setpoint);\n            if (context.global.original_setpoint === undefined) {\n                context.global.original_setpoint = new_setpoint;\n            }\n        \tcontext.global.setpoint_adjusted = true;\n        }\n    }\n    else if (setpoint < 0) { \n        //discharging\n    \tlet lowest_phase_power = Math.min(L1, L2, L3);           // phase with the highest load\n        //node.warn(\"lowest_phase_power: \" + lowest_phase_power);\n    \tif (lowest_phase_power < -max_phase_power) {\n        \tnode.warn(\"Discharge overload adjust\");\n    \n        \tlet delta = lowest_phase_power + max_phase_power;            // how much over the max for the phase\n        \tnew_setpoint = Math.floor(setpoint - (delta * num_multi));          // increase for each inverter as one setpoint for all\n        \tif (new_setpoint > 0)                                         // lets not switch to a charge state\n        \t{\n        \t    //keep in discharging state\n        \t    new_setpoint = -1;\n        \t}\n        \tnode.warn(\"Setting new setpoint now to \" + new_setpoint);\n            if (context.global.original_setpoint === undefined) {\n                context.global.original_setpoint = new_setpoint;\n            }\n        \tcontext.global.setpoint_adjusted = true;\n    \t}\n    }\n}\nelse {\n    // the setpoint was adjusted  \n\tif (setpoint > idle_rate)                                     // charging in an adjusted state\n\t{\n        node.warn(\"In Charge re-adjust\");\n\t\tlet highest_phase_power = Math.max(L1, L2, L3);     // find the phase with the highest power\n\t\tlet delta = max_phase_power - highest_phase_power;        // see if there is room to adjust\n\t\tnode.warn(\"Delta: \" + delta);\n\t \tif (delta > 150)                                    // only adjust if the diff is > 150W\n\t \t{\n\t \t    let original_setpoint = context.global.original_setpoint;\n\t\t\tnew_setpoint = Math.ceil(Math.min((setpoint + (delta * num_multi)), original_setpoint)); // add the delta to the setpoint but do not exceed original_setpoint\n\t\t\tnode.warn(\"Re-adjusting setpoint from \" + setpoint + \" to \" + new_setpoint + \" original was: \" + original_setpoint);\n\t\t\tif (new_setpoint == original_setpoint)\n\t\t\t{\n\t\t\t    context.global.original_setpoint = undefined;\n\t\t\t\tcontext.global.setpoint_adjusted = false;     // we are back at the original setpoint so set adjusted to false\n\t\t\t\tnode.warn(\"adjusted == false \" + new_setpoint + \" \" + original_setpoint);\n\t\t\t}\n\t\t}\n\t}\n\telse if (setpoint < 0)                                        // discharging in an adjusted stage\n\t{\n        node.warn(\"Discharge re-adjust\")\n\t\tlet lowest_phase_power = Math.min(L1, L2, L3);          // find the phase with the highest (negative) power\n\t\tlet delta = -max_phase_power - lowest_phase_power;      // see if there is room to adjust\n\t\tnode.warn(\"Delta: \" + delta);\n\t \tif (delta < -150)                                       // only adjust of diff > 150W\n\t \t{\n\t \t    let original_setpoint = context.global.original_setpoint;\n\t\t\tnew_setpoint = Math.floor(Math.max((setpoint - (delta * num_multi)), original_setpoint)); //add the delta to the setpoint but do not exceed original_setpoint\n\t\t\tnode.warn(\"Re-adjusting setpoint to \" + new_setpoint);\n\t\t\tif (new_setpoint == original_setpoint)\n\t\t\t{\n\t\t\t    context.global.original_setpoint = undefined;\n\t\t\t\tcontext.global.setpoint_adjusted = false;     // we are back at the original setpoint so set adjusted to false\n\t\t\t\tnode.warn(\"adjusted == false \" + new_setpoint + \" \" + original_setpoint);\n\t\t\t}\n\t\t}\n\t}\n}\n//node.warn(\"The end, setpoint: \" + setpoint + \" new: \" + new_setpoint);\n\nif (new_setpoint != setpoint)                                           // only adjust of the setpoint has changed\n{\n\tmsg.payload = new_setpoint;\n\tcontext.global.data[\"ess_setpoint\"] = new_setpoint; // this would be handled with the next victron setpoint update but for debugging\n\tnode.warn(\"Setting new setpoint now to \" + new_setpoint)\n\treturn null;//haha don't do it yet!\n\t//return msg;\n}\nreturn null;\n",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 340,
        "y": 720,
        "wires": [
            [
                "51c59a043f433e82",
                "0460462083e78ff0"
            ]
        ]
    },
    {
        "id": "5c2e7043235b2a67",
        "type": "victron-output-ess",
        "z": "ddb33f2863df98a5",
        "g": "52734a5bffcceeef",
        "service": "com.victronenergy.settings",
        "path": "/Settings/CGwacs/AcPowerSetPoint",
        "serviceObj": {
            "service": "com.victronenergy.settings",
            "name": "Venus settings"
        },
        "pathObj": {
            "path": "/Settings/CGwacs/AcPowerSetPoint",
            "type": "integer",
            "name": "Grid set-point (W)",
            "writable": true
        },
        "name": "",
        "onlyChanges": false,
        "x": 600,
        "y": 760,
        "wires": []
    },
    {
        "id": "51c59a043f433e82",
        "type": "debug",
        "z": "ddb33f2863df98a5",
        "g": "52734a5bffcceeef",
        "name": "Grid Overload Adjust",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "payload",
        "targetType": "msg",
        "statusVal": "",
        "statusType": "auto",
        "x": 560,
        "y": 720,
        "wires": []
    },
    {
        "id": "aacbe0c5d5d3ed9d",
        "type": "inject",
        "z": "ddb33f2863df98a5",
        "g": "52734a5bffcceeef",
        "name": "Every 10 secs",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "10",
        "crontab": "",
        "once": true,
        "onceDelay": "3",
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 140,
        "y": 720,
        "wires": [
            [
                "7fd426c7ab23f005"
            ]
        ]
    },
    {
        "id": "cc6d46e29053cd76",
        "type": "http request",
        "z": "ddb33f2863df98a5",
        "g": "52734a5bffcceeef",
        "name": "",
        "method": "GET",
        "ret": "txt",
        "paytoqs": false,
        "url": "",
        "persist": false,
        "insecureHTTPParser": false,
        "authType": "",
        "senderr": false,
        "headers": [],
        "x": 790,
        "y": 680,
        "wires": [
            []
        ]
    },
    {
        "id": "0460462083e78ff0",
        "type": "function",
        "z": "ddb33f2863df98a5",
        "g": "52734a5bffcceeef",
        "name": "Log SP adjust to domo log",
        "func": "let sp = msg.payload;\nlet alert = encodeURIComponent(\"Victron overload adjust to \"+sp)\nmsg.url = \"http://192.168.0.90:8080/json.htm?type=command&param=addlogmessage&message=\"+alert+\"&level=1\"\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 580,
        "y": 680,
        "wires": [
            [
                "cc6d46e29053cd76"
            ]
        ]
    },
    {
        "id": "e9c238be38dfc615",
        "type": "victron-virtual",
        "z": "9aa76971e5aacbd8",
        "name": "Enphase PV",
        "device": "pvinverter",
        "default_values": true,
        "battery_capacity": 25,
        "include_battery_temperature": false,
        "grid_nrofphases": 1,
        "include_motor_temp": false,
        "include_controller_temp": false,
        "include_coolant_temp": false,
        "include_motor_rpm": true,
        "include_motor_direction": true,
        "position": 0,
        "pvinverter_nrofphases": 1,
        "fluid_type": 0,
        "include_tank_battery": false,
        "include_tank_temperature": false,
        "tank_battery_voltage": 3.3,
        "tank_capacity": 0.2,
        "temperature_type": 2,
        "include_humidity": false,
        "include_pressure": false,
        "include_temp_battery": false,
        "temp_battery_voltage": 3.3,
        "x": 170,
        "y": 100,
        "wires": []
    },
    {
        "id": "63da225f629bddd3",
        "type": "victron-output-custom",
        "z": "9aa76971e5aacbd8",
        "service": "com.victronenergy.pvinverter/100",
        "path": "/Connected",
        "serviceObj": {
            "service": "com.victronenergy.pvinverter/100",
            "name": "Enphase PV (100)"
        },
        "pathObj": {
            "path": "/Connected",
            "name": "/Connected",
            "type": "number",
            "value": 1
        },
        "name": "",
        "onlyChanges": false,
        "x": 650,
        "y": 100,
        "wires": []
    },
    {
        "id": "0c2960b5be26181c",
        "type": "inject",
        "z": "9aa76971e5aacbd8",
        "name": "1",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": true,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "1",
        "payloadType": "num",
        "x": 430,
        "y": 100,
        "wires": [
            [
                "63da225f629bddd3"
            ]
        ]
    },
    {
        "id": "94152efca0329e6c",
        "type": "victron-output-custom",
        "z": "9aa76971e5aacbd8",
        "service": "com.victronenergy.pvinverter/100",
        "path": "/Serial",
        "serviceObj": {
            "service": "com.victronenergy.pvinverter/100",
            "name": "Enphase PV (100)"
        },
        "pathObj": {
            "path": "/Serial",
            "name": "/Serial",
            "type": "string",
            "value": "e9c238be38dfc615"
        },
        "name": "",
        "onlyChanges": false,
        "x": 640,
        "y": 140,
        "wires": []
    },
    {
        "id": "fdbe056efc8b32dd",
        "type": "inject",
        "z": "9aa76971e5aacbd8",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": true,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "42635462",
        "payloadType": "str",
        "x": 410,
        "y": 140,
        "wires": [
            [
                "94152efca0329e6c"
            ]
        ]
    },
    {
        "id": "c5c329458ff4a379",
        "type": "inject",
        "z": "9aa76971e5aacbd8",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": true,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "7",
        "payloadType": "num",
        "x": 430,
        "y": 180,
        "wires": [
            [
                "dcf7d82d20667f40"
            ]
        ]
    },
    {
        "id": "12ed329f045d94ef",
        "type": "inject",
        "z": "9aa76971e5aacbd8",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": true,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "5200",
        "payloadType": "num",
        "x": 430,
        "y": 220,
        "wires": [
            [
                "7bede248bbb5ad18"
            ]
        ]
    },
    {
        "id": "dcf7d82d20667f40",
        "type": "victron-output-custom",
        "z": "9aa76971e5aacbd8",
        "service": "com.victronenergy.pvinverter/100",
        "path": "/StatusCode",
        "serviceObj": {
            "service": "com.victronenergy.pvinverter/100",
            "name": "Enphase PV (100)"
        },
        "pathObj": {
            "path": "/StatusCode",
            "name": "/StatusCode",
            "type": "number",
            "value": 0
        },
        "name": "",
        "onlyChanges": false,
        "x": 650,
        "y": 180,
        "wires": []
    },
    {
        "id": "7bede248bbb5ad18",
        "type": "victron-output-custom",
        "z": "9aa76971e5aacbd8",
        "service": "com.victronenergy.pvinverter/100",
        "path": "/Ac/MaxPower",
        "serviceObj": {
            "service": "com.victronenergy.pvinverter/100",
            "name": "Enphase PV (100)"
        },
        "pathObj": {
            "path": "/Ac/MaxPower",
            "name": "/Ac/MaxPower",
            "type": "number",
            "value": 1000
        },
        "name": "",
        "onlyChanges": false,
        "x": 660,
        "y": 220,
        "wires": []
    },
    {
        "id": "f710fb60c2b82a8d",
        "type": "victron-output-custom",
        "z": "9aa76971e5aacbd8",
        "service": "com.victronenergy.pvinverter/100",
        "path": "/Ac/L1/Voltage",
        "serviceObj": {
            "service": "com.victronenergy.pvinverter/100",
            "name": "Enphase PV (100)"
        },
        "pathObj": {
            "path": "/Ac/L1/Voltage",
            "name": "/Ac/L1/Voltage",
            "type": "number",
            "value": 241.76
        },
        "name": "",
        "onlyChanges": false,
        "x": 740,
        "y": 480,
        "wires": []
    },
    {
        "id": "ee934bd04b2464f8",
        "type": "victron-output-custom",
        "z": "9aa76971e5aacbd8",
        "service": "com.victronenergy.pvinverter/100",
        "path": "/Ac/L1/Power",
        "serviceObj": {
            "service": "com.victronenergy.pvinverter/100",
            "name": "Enphase PV (100)"
        },
        "pathObj": {
            "path": "/Ac/L1/Power",
            "name": "/Ac/L1/Power",
            "type": "number",
            "value": 2356.83
        },
        "name": "",
        "onlyChanges": false,
        "x": 740,
        "y": 400,
        "wires": []
    },
    {
        "id": "f36ec1e6375bd455",
        "type": "victron-output-custom",
        "z": "9aa76971e5aacbd8",
        "service": "com.victronenergy.pvinverter/100",
        "path": "/Ac/L1/Energy/Forward",
        "serviceObj": {
            "service": "com.victronenergy.pvinverter/100",
            "name": "Enphase PV (100)"
        },
        "pathObj": {
            "path": "/Ac/L1/Energy/Forward",
            "name": "/Ac/L1/Energy/Forward",
            "type": "number",
            "value": 5386.582
        },
        "name": "",
        "onlyChanges": false,
        "x": 770,
        "y": 580,
        "wires": []
    },
    {
        "id": "cd6ef05ca65b599e",
        "type": "victron-output-custom",
        "z": "9aa76971e5aacbd8",
        "service": "com.victronenergy.pvinverter/100",
        "path": "/Ac/L1/Current",
        "serviceObj": {
            "service": "com.victronenergy.pvinverter/100",
            "name": "Enphase PV (100)"
        },
        "pathObj": {
            "path": "/Ac/L1/Current",
            "name": "/Ac/L1/Current",
            "type": "number",
            "value": 9.152796161482463
        },
        "name": "",
        "onlyChanges": false,
        "x": 1020,
        "y": 540,
        "wires": []
    },
    {
        "id": "f91c59eb7132039a",
        "type": "victron-output-custom",
        "z": "9aa76971e5aacbd8",
        "service": "com.victronenergy.pvinverter/100",
        "path": "/Ac/Power",
        "serviceObj": {
            "service": "com.victronenergy.pvinverter/100",
            "name": "Enphase PV (100)"
        },
        "pathObj": {
            "path": "/Ac/Power",
            "name": "/Ac/Power",
            "type": "number",
            "value": 2212.78
        },
        "name": "",
        "onlyChanges": false,
        "x": 730,
        "y": 440,
        "wires": []
    },
    {
        "id": "ba09394bb3fccf14",
        "type": "victron-output-custom",
        "z": "9aa76971e5aacbd8",
        "service": "com.victronenergy.pvinverter/100",
        "path": "/Ac/Energy/Forward",
        "serviceObj": {
            "service": "com.victronenergy.pvinverter/100",
            "name": "Enphase PV (100)"
        },
        "pathObj": {
            "path": "/Ac/Energy/Forward",
            "name": "/Ac/Energy/Forward",
            "type": "number",
            "value": 5386.582
        },
        "name": "",
        "onlyChanges": false,
        "x": 760,
        "y": 620,
        "wires": []
    },
    {
        "id": "a5cd8ee985da5c34",
        "type": "mqtt in",
        "z": "9aa76971e5aacbd8",
        "name": "PV Meter Enphase",
        "topic": "shellies/shellyem-1/emeter/0/#",
        "qos": "2",
        "datatype": "auto-detect",
        "broker": "ee1bb25c871ce5fc",
        "nl": false,
        "rap": true,
        "rh": 0,
        "inputs": 0,
        "x": 150,
        "y": 420,
        "wires": [
            [
                "88ba341fd585da42"
            ]
        ]
    },
    {
        "id": "8611f47023c644e9",
        "type": "switch",
        "z": "9aa76971e5aacbd8",
        "name": "Extract",
        "property": "topic",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "power",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "voltage",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "total_returned",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "reactive_power",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "pf",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "total",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 6,
        "x": 320,
        "y": 440,
        "wires": [
            [
                "f0a8ca2ad713484c"
            ],
            [
                "f710fb60c2b82a8d",
                "60a339d9b398d890"
            ],
            [
                "f24aa0ba852a865a"
            ],
            [],
            [],
            []
        ]
    },
    {
        "id": "f0a8ca2ad713484c",
        "type": "function",
        "z": "9aa76971e5aacbd8",
        "name": "ABS/Limit",
        "func": "let power = parseInt(Math.ceil(Math.abs(msg.payload)));\nif (power < 5) {\n    power = 0;\n}\nmsg.payload = power;\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 480,
        "y": 400,
        "wires": [
            [
                "ee934bd04b2464f8",
                "f91c59eb7132039a",
                "60a339d9b398d890"
            ]
        ]
    },
    {
        "id": "60a339d9b398d890",
        "type": "join",
        "z": "9aa76971e5aacbd8",
        "name": "",
        "mode": "custom",
        "build": "object",
        "property": "payload",
        "propertyType": "msg",
        "key": "topic",
        "joiner": "\\n",
        "joinerType": "str",
        "accumulate": true,
        "timeout": "",
        "count": "2",
        "reduceRight": false,
        "reduceExp": "",
        "reduceInit": "",
        "reduceInitType": "",
        "reduceFixup": "",
        "x": 650,
        "y": 540,
        "wires": [
            [
                "381e5fe76782a558"
            ]
        ]
    },
    {
        "id": "381e5fe76782a558",
        "type": "function",
        "z": "9aa76971e5aacbd8",
        "name": "Make Amps",
        "func": "let amps = 0;\nif (\n    (msg.payload.voltage != 0)\n    && (msg.payload.power > 4)\n    )\n{\n    // If power is below 5 Watt, than show as 0 Amps.\n    // This prevents showing 1-2 W on PV when no sun is shining\n     amps = (msg.payload.power / msg.payload.voltage);\n     amps = Math.round((amps + Number.EPSILON) * 100) / 100\n}\nmsg.topic = \"amps\"\nmsg.payload = amps;\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 790,
        "y": 540,
        "wires": [
            [
                "cd6ef05ca65b599e"
            ]
        ]
    },
    {
        "id": "88ba341fd585da42",
        "type": "change",
        "z": "9aa76971e5aacbd8",
        "name": "",
        "rules": [
            {
                "t": "change",
                "p": "topic",
                "pt": "msg",
                "from": "shellies/shellyem-1/emeter/0/",
                "fromt": "str",
                "to": "",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 150,
        "y": 480,
        "wires": [
            [
                "8611f47023c644e9"
            ]
        ]
    },
    {
        "id": "f24aa0ba852a865a",
        "type": "function",
        "z": "9aa76971e5aacbd8",
        "name": "kWh",
        "func": "let kWh = (msg.payload / 1000.0);\nkWh = Math.round((kWh + Number.EPSILON) * 1000) / 1000\nmsg.payload = kWh;\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 510,
        "y": 580,
        "wires": [
            [
                "f36ec1e6375bd455",
                "ba09394bb3fccf14"
            ]
        ]
    },
    {
        "id": "3a61e56d3bd98883",
        "type": "comment",
        "z": "9aa76971e5aacbd8",
        "name": "7 = running, 8=standby",
        "info": "",
        "x": 900,
        "y": 180,
        "wires": []
    },
    {
        "id": "e55a37c092aa569a",
        "type": "comment",
        "z": "9aa76971e5aacbd8",
        "name": "If Power is below 5 Watt, we display 0. This prevents displaying 1-2 Watts when there is no Sun",
        "info": "",
        "x": 470,
        "y": 40,
        "wires": []
    },
    {
        "id": "8ad52523984d9bb3",
        "type": "mqtt in",
        "z": "9aa76971e5aacbd8",
        "name": "Basen BMS",
        "topic": "basen_pack_1/status/#",
        "qos": "2",
        "datatype": "auto-detect",
        "broker": "ee1bb25c871ce5fc",
        "nl": false,
        "rap": true,
        "rh": 0,
        "inputs": 0,
        "x": 170,
        "y": 860,
        "wires": [
            [
                "5de5ce6544b45f93"
            ]
        ]
    },
    {
        "id": "5de5ce6544b45f93",
        "type": "change",
        "z": "9aa76971e5aacbd8",
        "name": "",
        "rules": [
            {
                "t": "change",
                "p": "topic",
                "pt": "msg",
                "from": "basen_pack_1/status",
                "fromt": "str",
                "to": "basen",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 150,
        "y": 900,
        "wires": [
            [
                "7d7e757bfc97c5e6"
            ]
        ]
    },
    {
        "id": "510ca31b521b5b30",
        "type": "change",
        "z": "9aa76971e5aacbd8",
        "name": "",
        "rules": [
            {
                "t": "change",
                "p": "topic",
                "pt": "msg",
                "from": "jk_pack_1/status",
                "fromt": "str",
                "to": "jk",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 190,
        "y": 980,
        "wires": [
            [
                "e981e1facbdcee0d"
            ]
        ]
    },
    {
        "id": "9bae87bbb9be9c01",
        "type": "mqtt in",
        "z": "9aa76971e5aacbd8",
        "name": "JK BMS",
        "topic": "jk_pack_1/status/#",
        "qos": "2",
        "datatype": "auto-detect",
        "broker": "ee1bb25c871ce5fc",
        "nl": false,
        "rap": true,
        "rh": 0,
        "inputs": 0,
        "x": 160,
        "y": 940,
        "wires": [
            [
                "510ca31b521b5b30"
            ]
        ]
    },
    {
        "id": "7d7e757bfc97c5e6",
        "type": "function",
        "z": "9aa76971e5aacbd8",
        "name": "SOC,Total kW,Volt,Amps, PWR",
        "func": "let msg2 = RED.util.cloneMessage(msg);\nlet msg3 = RED.util.cloneMessage(msg);\nlet msg4 = RED.util.cloneMessage(msg);\nlet msg5 = RED.util.cloneMessage(msg);\nmsg5.payload = msg.payload.battery_power;\nmsg4.payload = msg.payload.battery_current;\nmsg3.payload = msg.payload.battery_voltage;\nmsg2.payload = msg.payload.battery_kw;\nmsg.payload = msg.payload.soc;\n\nreturn [msg, msg2, msg3, msg4, msg5];",
        "outputs": 5,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 390,
        "y": 900,
        "wires": [
            [
                "33b5561a487b7122",
                "99173553ebb3396f"
            ],
            [
                "81c49a35505eb9b8"
            ],
            [
                "f916f96980c953bb",
                "7c1588b159fa8ad1"
            ],
            [
                "d3eaba1b184b69d5",
                "4f988d989b23054d"
            ],
            [
                "b21429e8d508e955"
            ]
        ]
    },
    {
        "id": "e981e1facbdcee0d",
        "type": "function",
        "z": "9aa76971e5aacbd8",
        "name": "SOC, TotalkW, Volt, Amps",
        "func": "let msg2 = RED.util.cloneMessage(msg);\nlet msg3 = RED.util.cloneMessage(msg);\nlet msg4 = RED.util.cloneMessage(msg);\nmsg4.payload = msg.payload.battery_current;\nmsg3.payload = msg.payload.battery_voltage;\nmsg2.payload = msg.payload.battery_kw;\nmsg.payload = msg.payload.soc;\n\nreturn [msg, msg2, msg3, msg4];\n",
        "outputs": 4,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 410,
        "y": 980,
        "wires": [
            [
                "33b5561a487b7122"
            ],
            [
                "81c49a35505eb9b8"
            ],
            [
                "f916f96980c953bb"
            ],
            [
                "d3eaba1b184b69d5"
            ]
        ]
    },
    {
        "id": "33b5561a487b7122",
        "type": "join",
        "z": "9aa76971e5aacbd8",
        "name": "Join SOC",
        "mode": "custom",
        "build": "object",
        "property": "payload",
        "propertyType": "msg",
        "key": "topic",
        "joiner": "\\n",
        "joinerType": "str",
        "accumulate": false,
        "timeout": "",
        "count": "3",
        "reduceRight": false,
        "reduceExp": "",
        "reduceInit": "",
        "reduceInitType": "num",
        "reduceFixup": "",
        "x": 670,
        "y": 880,
        "wires": [
            [
                "5814d8fa323c11c7"
            ]
        ]
    },
    {
        "id": "5814d8fa323c11c7",
        "type": "function",
        "z": "9aa76971e5aacbd8",
        "name": "Calc SOC",
        "func": "//new routine\nfunction SocAverager() {\n    const samples = [];\n\n    // Method to add SOC/Ah pairs\n    function add(soc, ah) {\n        if (soc != 0) {\n            samples.push({ soc, ah });\n        }\n    }\n\n    // Method to get the weighted average SOC\n    function average() {\n        let totalCapacity = 0;\n        let weightedSocSum = 0;\n\n        for (const sample of samples) {\n            totalCapacity += sample.ah;\n            weightedSocSum += sample.soc * sample.ah;\n        }\n\n        if (totalCapacity === 0) return 0;\n        return weightedSocSum / totalCapacity;\n    }\n\n    // Return object with both methods\n    return {\n        add,\n        average\n    };\n}\n\nlet soc_jk_1 = msg.payload.jk;\nlet soc_jk_2 = msg.payload.jk2;\nlet soc_basen = msg.payload.basen;\n\nlet ah_jk = 314;\nlet ah_basen = 280;\n\nconst socTool = SocAverager();\nsocTool.add(soc_basen, ah_basen);\nsocTool.add(soc_jk_1, ah_jk);\nsocTool.add(soc_jk_2, ah_jk);\nlet c_soc = Math.round(socTool.average() * 10) / 10;\n\nmsg.topic = \"combined_soc\";\nmsg.payload = Math.round(c_soc * 10) / 10;\nmsg.sendnow = true;\n\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 820,
        "y": 880,
        "wires": [
            [
                "c526dba98b24ed05",
                "78944cc006f58cae"
            ]
        ]
    },
    {
        "id": "c526dba98b24ed05",
        "type": "link out",
        "z": "9aa76971e5aacbd8",
        "name": "ToMQTT",
        "mode": "link",
        "links": [
            "04b33f5ed2e152e1"
        ],
        "x": 965,
        "y": 920,
        "wires": []
    },
    {
        "id": "81c49a35505eb9b8",
        "type": "join",
        "z": "9aa76971e5aacbd8",
        "name": "Join kW",
        "mode": "custom",
        "build": "object",
        "property": "payload",
        "propertyType": "msg",
        "key": "topic",
        "joiner": "\\n",
        "joinerType": "str",
        "accumulate": false,
        "timeout": "",
        "count": "3",
        "reduceRight": false,
        "reduceExp": "",
        "reduceInit": "",
        "reduceInitType": "num",
        "reduceFixup": "",
        "x": 660,
        "y": 920,
        "wires": [
            [
                "735e2c945aeda301"
            ]
        ]
    },
    {
        "id": "735e2c945aeda301",
        "type": "function",
        "z": "9aa76971e5aacbd8",
        "name": "Calc Total",
        "func": "let kw_jk_1 = msg.payload.jk;\nlet kw_jk_2 = msg.payload.jk2;\nlet kw_basen = msg.payload.basen;\nmsg.topic = \"combined_kw\";\nmsg.payload = Math.round(kw_jk_1 + kw_jk_2 + kw_basen);\nmsg.sendnow = true;\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 820,
        "y": 920,
        "wires": [
            [
                "c526dba98b24ed05"
            ]
        ]
    },
    {
        "id": "f916f96980c953bb",
        "type": "join",
        "z": "9aa76971e5aacbd8",
        "name": "Join Volt",
        "mode": "custom",
        "build": "object",
        "property": "payload",
        "propertyType": "msg",
        "key": "topic",
        "joiner": "\\n",
        "joinerType": "str",
        "accumulate": false,
        "timeout": "",
        "count": "3",
        "reduceRight": false,
        "reduceExp": "",
        "reduceInit": "",
        "reduceInitType": "num",
        "reduceFixup": "",
        "x": 670,
        "y": 960,
        "wires": [
            [
                "a549d62d279ee086"
            ]
        ]
    },
    {
        "id": "d3eaba1b184b69d5",
        "type": "join",
        "z": "9aa76971e5aacbd8",
        "name": "Join Amps",
        "mode": "custom",
        "build": "object",
        "property": "payload",
        "propertyType": "msg",
        "key": "topic",
        "joiner": "\\n",
        "joinerType": "str",
        "accumulate": false,
        "timeout": "",
        "count": "3",
        "reduceRight": false,
        "reduceExp": "",
        "reduceInit": "",
        "reduceInitType": "num",
        "reduceFixup": "",
        "x": 670,
        "y": 1000,
        "wires": [
            [
                "397351e6e516d7cf"
            ]
        ]
    },
    {
        "id": "a549d62d279ee086",
        "type": "function",
        "z": "9aa76971e5aacbd8",
        "name": "Calc AVG",
        "func": "let volt_jk_1 = msg.payload.jk;\nlet volt_jk_2 = msg.payload.jk2;\nlet volt_basen = msg.payload.basen;\nmsg.topic = \"combined_volt\";\nlet avg = (volt_jk_1 + volt_jk_2 + volt_basen) / 3;\nmsg.payload = Math.round( parseFloat(avg) * 100 + Number.EPSILON ) / 100;\nmsg.sendnow = true;\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 820,
        "y": 960,
        "wires": [
            [
                "c526dba98b24ed05",
                "58ce90eb695272f8",
                "d81ad0b4896cee2d"
            ]
        ]
    },
    {
        "id": "397351e6e516d7cf",
        "type": "function",
        "z": "9aa76971e5aacbd8",
        "name": "Calc AVG",
        "func": "let amps_jk_1 = msg.payload.jk;\nlet amps_jk_2 = msg.payload.jk2;\nlet amps_basen = msg.payload.basen;\nmsg.topic = \"combined_amps\";\n\nlet avg = (amps_jk_1 + amps_jk_2 + amps_basen) / 1;\nmsg.payload = Math.round( parseFloat(avg) * 100 + Number.EPSILON ) / 100;\nmsg.sendnow = true;\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 820,
        "y": 1000,
        "wires": [
            [
                "c526dba98b24ed05",
                "8dec4e277566c140",
                "d81ad0b4896cee2d"
            ]
        ]
    },
    {
        "id": "bdf77e9728598ddd",
        "type": "victron-virtual",
        "z": "9aa76971e5aacbd8",
        "name": "Virtual Battery",
        "device": "battery",
        "default_values": true,
        "battery_capacity": "9504",
        "include_battery_temperature": false,
        "grid_nrofphases": 1,
        "include_motor_temp": false,
        "include_controller_temp": false,
        "include_coolant_temp": false,
        "include_motor_rpm": true,
        "include_motor_direction": true,
        "position": 0,
        "pvinverter_nrofphases": 1,
        "fluid_type": 0,
        "include_tank_battery": false,
        "include_tank_temperature": false,
        "tank_battery_voltage": 3.3,
        "tank_capacity": 0.2,
        "temperature_type": 2,
        "include_humidity": false,
        "include_pressure": false,
        "include_temp_battery": false,
        "temp_battery_voltage": 3.3,
        "x": 180,
        "y": 160,
        "wires": []
    },
    {
        "id": "78944cc006f58cae",
        "type": "victron-output-custom",
        "z": "9aa76971e5aacbd8",
        "service": "com.victronenergy.battery/101",
        "path": "/Soc",
        "serviceObj": {
            "service": "com.victronenergy.battery/101",
            "name": "Virtual Battery (101)"
        },
        "pathObj": {
            "path": "/Soc",
            "name": "/Soc",
            "type": "number",
            "value": 80
        },
        "name": "",
        "onlyChanges": false,
        "x": 1080,
        "y": 880,
        "wires": []
    },
    {
        "id": "58ce90eb695272f8",
        "type": "victron-output-custom",
        "z": "9aa76971e5aacbd8",
        "service": "com.victronenergy.battery/101",
        "path": "/Dc/0/Voltage",
        "serviceObj": {
            "service": "com.victronenergy.battery/101",
            "name": "Virtual Battery (101)"
        },
        "pathObj": {
            "path": "/Dc/0/Voltage",
            "name": "/Dc/0/Voltage",
            "type": "number",
            "value": 24
        },
        "name": "",
        "onlyChanges": false,
        "x": 1100,
        "y": 960,
        "wires": []
    },
    {
        "id": "8dec4e277566c140",
        "type": "victron-output-custom",
        "z": "9aa76971e5aacbd8",
        "service": "com.victronenergy.battery/101",
        "path": "/Dc/0/Current",
        "serviceObj": {
            "service": "com.victronenergy.battery/101",
            "name": "Virtual Battery (101)"
        },
        "pathObj": {
            "path": "/Dc/0/Current",
            "name": "/Dc/0/Current",
            "type": "number",
            "value": 0
        },
        "name": "",
        "onlyChanges": false,
        "x": 1100,
        "y": 1020,
        "wires": []
    },
    {
        "id": "d81ad0b4896cee2d",
        "type": "join",
        "z": "9aa76971e5aacbd8",
        "name": "Join Power",
        "mode": "custom",
        "build": "object",
        "property": "payload",
        "propertyType": "msg",
        "key": "topic",
        "joiner": "\\n",
        "joinerType": "str",
        "accumulate": false,
        "timeout": "",
        "count": "2",
        "reduceRight": false,
        "reduceExp": "",
        "reduceInit": "",
        "reduceInitType": "num",
        "reduceFixup": "",
        "x": 670,
        "y": 1060,
        "wires": [
            [
                "513de15068422670"
            ]
        ]
    },
    {
        "id": "513de15068422670",
        "type": "function",
        "z": "9aa76971e5aacbd8",
        "name": "Calc Power",
        "func": "let voltage = msg.payload.combined_volt;\nlet amps = msg.payload.combined_amps;\nmsg.topic = \"combined_power\";\nlet power = voltage*amps;\nmsg.payload = Math.round( parseFloat(power) * 100 + Number.EPSILON ) / 100;\nmsg.sendnow = true;\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 830,
        "y": 1060,
        "wires": [
            [
                "90e40c16fee803ba"
            ]
        ]
    },
    {
        "id": "90e40c16fee803ba",
        "type": "victron-output-custom",
        "z": "9aa76971e5aacbd8",
        "service": "com.victronenergy.battery/101",
        "path": "/Dc/0/Power",
        "serviceObj": {
            "service": "com.victronenergy.battery/101",
            "name": "Virtual Battery (101)"
        },
        "pathObj": {
            "path": "/Dc/0/Power",
            "name": "/Dc/0/Power",
            "type": "number",
            "value": 0
        },
        "name": "",
        "onlyChanges": false,
        "x": 1100,
        "y": 1100,
        "wires": []
    },
    {
        "id": "8ab24c05822f87e3",
        "type": "victron-virtual",
        "z": "9aa76971e5aacbd8",
        "name": "VR Basen Battery",
        "device": "battery",
        "default_values": true,
        "battery_capacity": "4480",
        "include_battery_temperature": false,
        "grid_nrofphases": 1,
        "include_motor_temp": false,
        "include_controller_temp": false,
        "include_coolant_temp": false,
        "include_motor_rpm": true,
        "include_motor_direction": true,
        "position": 0,
        "pvinverter_nrofphases": 1,
        "fluid_type": 0,
        "include_tank_battery": false,
        "include_tank_temperature": false,
        "tank_battery_voltage": 3.3,
        "tank_capacity": 0.2,
        "temperature_type": 2,
        "include_humidity": false,
        "include_pressure": false,
        "include_temp_battery": false,
        "temp_battery_voltage": 3.3,
        "x": 190,
        "y": 220,
        "wires": []
    },
    {
        "id": "99173553ebb3396f",
        "type": "victron-output-custom",
        "z": "9aa76971e5aacbd8",
        "service": "com.victronenergy.battery/102",
        "path": "/Soc",
        "serviceObj": {
            "service": "com.victronenergy.battery/102",
            "name": "VR Basen Battery (102)"
        },
        "pathObj": {
            "path": "/Soc",
            "name": "/Soc",
            "type": "number",
            "value": 80
        },
        "name": "",
        "onlyChanges": false,
        "x": 730,
        "y": 700,
        "wires": []
    },
    {
        "id": "7c1588b159fa8ad1",
        "type": "victron-output-custom",
        "z": "9aa76971e5aacbd8",
        "service": "com.victronenergy.battery/102",
        "path": "/Dc/0/Voltage",
        "serviceObj": {
            "service": "com.victronenergy.battery/102",
            "name": "VR Basen Battery (102)"
        },
        "pathObj": {
            "path": "/Dc/0/Voltage",
            "name": "/Dc/0/Voltage",
            "type": "number",
            "value": 24
        },
        "name": "",
        "onlyChanges": false,
        "x": 750,
        "y": 740,
        "wires": []
    },
    {
        "id": "4f988d989b23054d",
        "type": "victron-output-custom",
        "z": "9aa76971e5aacbd8",
        "service": "com.victronenergy.battery/102",
        "path": "/Dc/0/Current",
        "serviceObj": {
            "service": "com.victronenergy.battery/102",
            "name": "VR Basen Battery (102)"
        },
        "pathObj": {
            "path": "/Dc/0/Current",
            "name": "/Dc/0/Current",
            "type": "number",
            "value": 0
        },
        "name": "",
        "onlyChanges": false,
        "x": 750,
        "y": 780,
        "wires": []
    },
    {
        "id": "b21429e8d508e955",
        "type": "victron-output-custom",
        "z": "9aa76971e5aacbd8",
        "service": "com.victronenergy.battery/102",
        "path": "/Dc/0/Power",
        "serviceObj": {
            "service": "com.victronenergy.battery/102",
            "name": "VR Basen Battery (102)"
        },
        "pathObj": {
            "path": "/Dc/0/Power",
            "name": "/Dc/0/Power",
            "type": "number",
            "value": 0
        },
        "name": "",
        "onlyChanges": false,
        "x": 750,
        "y": 820,
        "wires": []
    },
    {
        "id": "8f7afdb403e119b1",
        "type": "mqtt in",
        "z": "9aa76971e5aacbd8",
        "name": "JK BMS 2",
        "topic": "jk_pack_2/status/#",
        "qos": "2",
        "datatype": "auto-detect",
        "broker": "ee1bb25c871ce5fc",
        "nl": false,
        "rap": true,
        "rh": 0,
        "inputs": 0,
        "x": 160,
        "y": 1040,
        "wires": [
            [
                "bfadc506821c90ba"
            ]
        ]
    },
    {
        "id": "bfadc506821c90ba",
        "type": "change",
        "z": "9aa76971e5aacbd8",
        "name": "",
        "rules": [
            {
                "t": "change",
                "p": "topic",
                "pt": "msg",
                "from": "jk_pack_2/status",
                "fromt": "str",
                "to": "jk2",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 150,
        "y": 1080,
        "wires": [
            [
                "635f8f927fc6e7c1"
            ]
        ]
    },
    {
        "id": "635f8f927fc6e7c1",
        "type": "function",
        "z": "9aa76971e5aacbd8",
        "name": "SOC,Total kW,Volt,Amps, PWR",
        "func": "let msg2 = RED.util.cloneMessage(msg);\nlet msg3 = RED.util.cloneMessage(msg);\nlet msg4 = RED.util.cloneMessage(msg);\nlet msg5 = RED.util.cloneMessage(msg);\nmsg5.payload = msg.payload.battery_power;\nmsg4.payload = msg.payload.battery_current;\nmsg3.payload = msg.payload.battery_voltage;\nmsg2.payload = msg.payload.battery_kw;\nmsg.payload = msg.payload.soc;\n\nreturn [msg, msg2, msg3, msg4, msg5];",
        "outputs": 5,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 390,
        "y": 1060,
        "wires": [
            [
                "8726a276109867c3",
                "33b5561a487b7122"
            ],
            [
                "81c49a35505eb9b8"
            ],
            [
                "967854601bc8d921",
                "f916f96980c953bb"
            ],
            [
                "cff9adb1081a0663",
                "d3eaba1b184b69d5"
            ],
            [
                "ccd84a2ae4d8b5e8"
            ]
        ]
    },
    {
        "id": "b82fd64b9a12b756",
        "type": "victron-virtual",
        "z": "9aa76971e5aacbd8",
        "name": "VR JK_2 Battery",
        "device": "battery",
        "default_values": true,
        "battery_capacity": "5024",
        "include_battery_temperature": false,
        "grid_nrofphases": 1,
        "include_motor_temp": false,
        "include_controller_temp": false,
        "include_coolant_temp": false,
        "include_motor_rpm": true,
        "include_motor_direction": true,
        "position": 0,
        "pvinverter_nrofphases": 1,
        "fluid_type": 0,
        "include_tank_battery": false,
        "include_tank_temperature": false,
        "tank_battery_voltage": 3.3,
        "tank_capacity": 0.2,
        "temperature_type": 2,
        "include_humidity": false,
        "include_pressure": false,
        "include_temp_battery": false,
        "temp_battery_voltage": 3.3,
        "x": 190,
        "y": 280,
        "wires": []
    },
    {
        "id": "8726a276109867c3",
        "type": "victron-output-custom",
        "z": "9aa76971e5aacbd8",
        "service": "com.victronenergy.battery/100",
        "path": "/Soc",
        "serviceObj": {
            "service": "com.victronenergy.battery/100",
            "name": "VR JK_2 Battery (100)"
        },
        "pathObj": {
            "path": "/Soc",
            "name": "/Soc",
            "type": "number",
            "value": 80
        },
        "name": "",
        "onlyChanges": false,
        "x": 700,
        "y": 1120,
        "wires": []
    },
    {
        "id": "967854601bc8d921",
        "type": "victron-output-custom",
        "z": "9aa76971e5aacbd8",
        "service": "com.victronenergy.battery/100",
        "path": "/Dc/0/Voltage",
        "serviceObj": {
            "service": "com.victronenergy.battery/100",
            "name": "VR JK_2 Battery (100)"
        },
        "pathObj": {
            "path": "/Dc/0/Voltage",
            "name": "/Dc/0/Voltage",
            "type": "number",
            "value": 24
        },
        "name": "",
        "onlyChanges": false,
        "x": 730,
        "y": 1160,
        "wires": []
    },
    {
        "id": "cff9adb1081a0663",
        "type": "victron-output-custom",
        "z": "9aa76971e5aacbd8",
        "service": "com.victronenergy.battery/100",
        "path": "/Dc/0/Current",
        "serviceObj": {
            "service": "com.victronenergy.battery/100",
            "name": "VR JK_2 Battery (100)"
        },
        "pathObj": {
            "path": "/Dc/0/Current",
            "name": "/Dc/0/Current",
            "type": "number",
            "value": 0
        },
        "name": "",
        "onlyChanges": false,
        "x": 730,
        "y": 1200,
        "wires": []
    },
    {
        "id": "ccd84a2ae4d8b5e8",
        "type": "victron-output-custom",
        "z": "9aa76971e5aacbd8",
        "service": "com.victronenergy.battery/100",
        "path": "/Dc/0/Power",
        "serviceObj": {
            "service": "com.victronenergy.battery/100",
            "name": "VR JK_2 Battery (100)"
        },
        "pathObj": {
            "path": "/Dc/0/Power",
            "name": "/Dc/0/Power",
            "type": "number",
            "value": 0
        },
        "name": "",
        "onlyChanges": false,
        "x": 730,
        "y": 1240,
        "wires": []
    },
    {
        "id": "7129e14f301fb5a7",
        "type": "inject",
        "z": "edf9f455029eeb7f",
        "g": "9fc897c32bfacc77",
        "name": "@00:01",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "01 00 * * *",
        "once": true,
        "onceDelay": "1",
        "topic": "",
        "payload": "1",
        "payloadType": "str",
        "x": 120,
        "y": 200,
        "wires": [
            [
                "18983c8132c11beb"
            ]
        ]
    },
    {
        "id": "7347ef667ed20efa",
        "type": "link out",
        "z": "edf9f455029eeb7f",
        "g": "9fc897c32bfacc77",
        "name": "ToMQTT-Direct",
        "mode": "link",
        "links": [
            "032e3829752acb0f"
        ],
        "x": 785,
        "y": 380,
        "wires": []
    },
    {
        "id": "122749331c478207",
        "type": "function",
        "z": "edf9f455029eeb7f",
        "g": "1a81b3b5b7840ea2",
        "name": "Startup Function",
        "func": "let discovery_topic = \"homeassistant\";\nlet root_topic = \"tibber_data\";\n\nlet pobject = [\n    //Text\n    { \"tibber_prices_today\": [\"sensor\", \"today\", \"0x9000000001\", \"variable\", \"\", 0] },\n    { \"tibber_prices_tomorrow\": [\"sensor\", \"tomorrow\", \"0x9000000002\", \"variable\", \"\", 0] },\n    { \"charge_scheme_today\": [\"sensor\", \"scheme_today\", \"0x9000000003\", \"variable\", \"\", 0] },\n    { \"charge_scheme_tomorrow\": [\"sensor\", \"scheme_tomorrow\", \"0x9000000004\", \"variable\", \"\", 0] },\n];\n\nfunction createSensorObject(root, name, varname, unique_id, unit_of_measurement)\n{\n    let vjson = {\n                \"stat_t\": \"~/\" + varname + \"/state\",\n                \"dev\": {\n                    \"manufacturer\": \"PA1DVB\",\n                    \"ids\": []\n                }\n    };\n    \n    let device_identifier = unique_id;\n    if (device_identifier.indexOf(\"_\") != -1)\n    {\n        device_identifier = unique_id.split(\"_\")[0];\n    }\n    vjson.dev.ids.push(device_identifier);\n\n    vjson[\"~\"] = root;\n    vjson[\"name\"] = name;\n    vjson[\"uniq_id\"] = unique_id;\n    vjson[\"unit_of_meas\"] = unit_of_measurement;\n    //vjson[\"val_tpl\"] = \"{{ value_json.\" + varname + \" }}\";\n\n    return vjson\n}\n\npobject.forEach((vvar) => {\n    let name = Object.keys(vvar)[0];\n    let vobj = vvar[Object.keys(vvar)];\n    let object_type = vobj[0]\n    let varname = vobj[1]\n    let unique_id = vobj[2]\n\n    let jobj = null\n    if (object_type == \"sensor\") {\n        let unit_of_measurement = vobj[3]\n        jobj = createSensorObject(root_topic, name, varname, unique_id, unit_of_measurement);\n    }\n\n    if (jobj != null) {\n        if (unique_id.indexOf(\"_\") != -1)\n        {\n            unique_id = unique_id.split(\"_\")[0];\n        }\n        let dtopic = discovery_topic + \"/\" + object_type + \"/\" + unique_id + \"/\" + varname + \"/config\"\n        //node.log(\"publishing config ->: \" + dtopic);\n\n        msg.payload = jobj;\n        msg.topic = dtopic;\n        msg.retain = true;\n        node.send(msg);\n    }\n});\nreturn null;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 460,
        "y": 100,
        "wires": [
            [
                "9e88ca438deb4b19"
            ]
        ]
    },
    {
        "id": "1c936b634fa5b6d7",
        "type": "inject",
        "z": "edf9f455029eeb7f",
        "g": "1a81b3b5b7840ea2",
        "name": "Startup",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": true,
        "onceDelay": "0.3",
        "topic": "online",
        "payload": "true",
        "payloadType": "str",
        "x": 120,
        "y": 100,
        "wires": [
            [
                "14c3076dd27b816b"
            ]
        ]
    },
    {
        "id": "9e88ca438deb4b19",
        "type": "link out",
        "z": "edf9f455029eeb7f",
        "g": "1a81b3b5b7840ea2",
        "name": "ToMQTT-Direct",
        "mode": "link",
        "links": [
            "032e3829752acb0f"
        ],
        "x": 575,
        "y": 100,
        "wires": []
    },
    {
        "id": "3822f057ea823e2f",
        "type": "function",
        "z": "edf9f455029eeb7f",
        "g": "9fc897c32bfacc77",
        "name": "Combine/Simplify",
        "func": "var ret = {};\nvar json = msg.payload.tibber;\n\nret.datum = json[0].startsAt.substr(0, 10);\n\n// Tibber prices in Hours or Quarters only\nif ((json.length != 24) && (json.length != 24*4)) {\n    ret.status = false;\n    msg.payload = ret;\n    return msg;\n}\n\nret.status = true;\n\n//Check if forecast has 24 values, otherwise it's invalid!\nvar varray = msg.payload.forecast || [];\nvar bHaveForecast = (varray.length == 24);\n\n// Transform array of objects\nret.data = json.map(item => ({\n                    datum: ret.datum + \" \" + item.startsAt.substr(11, 8),\n                    hour_price: item.total,\n                    level: item.level,\n                    forecast: (bHaveForecast == true) ? varray[parseInt(item.startsAt.substr(11, 2))] : 0\n                }));\n\nmsg.payload = ret;\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 190,
        "y": 380,
        "wires": [
            [
                "b657827f03345e3d",
                "7347ef667ed20efa"
            ]
        ]
    },
    {
        "id": "69b33dbd0610989b",
        "type": "comment",
        "z": "edf9f455029eeb7f",
        "name": "Version 1.12",
        "info": "Last edited: 2025-11-28\n\n1.12\nPrepared for Tibber Quarter prices\n\n1.11\n- Also make today/tomorrow charge scheme when it is not interested (all 'idle')\n\n1.10\n- Better compatible with HASS\n\n1.09\n- Using forcast.solar for today/tomorrow forecast\n- Simplified flow\n\n1.08\n- setting milliseconds in today date check to 0\n- \n1.07\n- Optimized OptimusPrime (only use max. to charge hour count in highPrices block)\n\n",
        "x": 90,
        "y": 20,
        "wires": []
    },
    {
        "id": "940a6419ce2b4c0f",
        "type": "function",
        "z": "edf9f455029eeb7f",
        "g": "9fc897c32bfacc77",
        "name": "OptimusPrime",
        "func": "/*\nDynamic price calculaton\nV1.08\n(c) 2024-2025 PA1DVB\n*/\n\nfunction sanityCheck(json) {\n    if (json.status != true) {\n        node.error(\"Invalid Tibber result!\", msg);\n        return false;\n    }\n    var jDate = new Date(json.datum);\n    var tDate = new Date();\n    tDate.setHours(0, 0, 0, 0);\n\n    if (jDate.getTime() < tDate.getTime()) {\n        node.error(\"Incorrect date in Tibber result!\");\n        return false;\n    }\n\n    //We should have at least 24 data items (96 for quarter prices)\n    let tot_results = Object.keys(json.data).length;\n    if (tot_results < 24) {\n        node.error(\"Incorrect data in Tibber result!\");\n        return false;\n    }\n    return true;\n}\n\nfunction calculate_charge_schema(data) {\n    const processedData = JSON.parse(JSON.stringify(data)); // Deep copy\n\n    const bIsQuarterData = (processedData.length > 24);\n    const blockMultiply = (bIsQuarterData == true) ? 0.25 : 1;\n\n    const calc_charge_rate = context.global.batt_charge_rate * blockMultiply;\n    const calc_discharge_rate = context.global.batt_discharge_rate * blockMultiply;\n\n    // Calculate average price for reference\n    const prices = processedData.map(item => item.hour_price);\n    const avgPrice = prices.reduce((a, b) => a + b, 0) / prices.length;\n\n    // Find price extremes for charging (low prices) and discharging (high prices)\n    const sortedByPrice = [...processedData].sort((a, b) => a.hour_price - b.hour_price);\n\n    // Strategy: charge at lowest prices, discharge at highest prices\n    // Ensure equal charge/discharge periods\n    let chargeSlots = [];\n    let dischargeSlots = [];\n\n    // Find potential charge slots (lowest prices)\n    for (let i = 0; i < sortedByPrice.length; i++) {\n        const item = sortedByPrice[i];\n        const potentialDischarge = sortedByPrice[sortedByPrice.length - 1 - i];\n\n        // Check if price difference is at least the sell threshold\n        if (potentialDischarge.hour_price - item.hour_price >= context.flow.price_min_sell_difference) {\n            chargeSlots.push(item.datum);\n            dischargeSlots.push(potentialDischarge.datum);\n        }\n    }\n\n    // Calculate max slots to max_soc\n    let maxSlots = Math.ceil(context.flow.batt_charged_capacity / calc_charge_rate);\n\n    // Ensure equal number of charge and discharge slots\n    let minSlots = Math.min(chargeSlots.length, dischargeSlots.length);\n\n    // Ensure we do not charge more then needed\n    minSlots = Math.min(minSlots, maxSlots);\n\n    chargeSlots = chargeSlots.slice(0, minSlots);\n    dischargeSlots = dischargeSlots.slice(0, minSlots);\n\n    // Apply actions to data\n    processedData.forEach(item => {\n        if (chargeSlots.includes(item.datum)) {\n            item.hour_type = 'charge';\n        } else if (dischargeSlots.includes(item.datum)) {\n            item.hour_type = 'discharge';\n        } else {\n            item.hour_type = 'idle';\n        }\n    });\n\n    // Ensure first action is CHARGE by sorting if needed\n    const firstChargeIndex = processedData.findIndex(item => item.hour_type === 'charge');\n    const firstDischargeIndex = processedData.findIndex(item => item.hour_type === 'discharge');\n\n    if (firstDischargeIndex < firstChargeIndex && firstDischargeIndex !== -1) {\n        // Swap the first discharge with a later charge to ensure charge comes first\n        const firstDischarge = processedData[firstDischargeIndex];\n        const laterCharge = processedData.find((item, idx) =>\n            idx > firstDischargeIndex && item.hour_type === 'charge'\n        );\n\n        if (laterCharge) {\n            firstDischarge.hour_type = 'charge';\n            laterCharge.hour_type = 'discharge';\n        }\n    }\n\n    // Apply charged percentage to data (Assume we start empty)\n    let battery_capacity_start = context.flow.batt_min_charged;\n\n    let battery_capacity_watt = battery_capacity_start;\n    let earned_money = 0.0;\n\n    processedData.forEach(item => {\n        if (item.hour_type == 'charge') {\n            const power_2_add = Math.min(\n                calc_charge_rate,\n                context.global.batt_capacity - battery_capacity_watt\n            );            \n            if (power_2_add > 0) {\n                battery_capacity_watt += power_2_add;\n                earned_money -= (power_2_add / 1000) * item.hour_price;\n            }\n            item.setpoint = context.global.batt_charge_rate;\n        } else if (item.hour_type == 'discharge') {\n            let power_2_sub = Math.max(0, Math.min(calc_discharge_rate, battery_capacity_watt - context.flow.batt_min_charged));\n            if (power_2_sub > 0) {\n                battery_capacity_watt -= power_2_sub;\n                earned_money += (power_2_sub / 1000) * item.hour_price;\n            }\n            item.setpoint = -context.global.batt_discharge_rate;\n        } else {\n            item.setpoint = context.global.idle_rate;\n        }\n        item.battery_capacity_watt = battery_capacity_watt;\n        item.battery_capacity_percentage = parseFloat(((100.0 / context.global.batt_capacity) * item.battery_capacity_watt).toFixed(2));\n        item.earned_money = parseFloat(earned_money.toFixed(4));\n    });\n\n    return processedData;\n}\n\nlet ret = {\n    \"status\": false\n};\n\nconst json = msg.payload;\n\nif (sanityCheck(json) == false) {\n    msg.payload = ret;\n    return msg;\n}\n\nret.status = true;\nret.datum = json.datum;\nret.data = calculate_charge_schema(json.data);\nmsg.payload = ret;\nreturn msg;\n",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 540,
        "y": 400,
        "wires": [
            [
                "28226bb08eec0b30",
                "7347ef667ed20efa"
            ]
        ]
    },
    {
        "id": "18ded7543547a3f3",
        "type": "inject",
        "z": "edf9f455029eeb7f",
        "g": "9fc897c32bfacc77",
        "name": "@14:01",
        "props": [
            {
                "p": "payload"
            }
        ],
        "repeat": "",
        "crontab": "01 14 * * *",
        "once": true,
        "onceDelay": "2",
        "topic": "",
        "payload": "1",
        "payloadType": "str",
        "x": 120,
        "y": 240,
        "wires": [
            [
                "b8e7d236d12fcbe8"
            ]
        ]
    },
    {
        "id": "28226bb08eec0b30",
        "type": "debug",
        "z": "edf9f455029eeb7f",
        "g": "9fc897c32bfacc77",
        "name": "debug 56",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "false",
        "statusVal": "",
        "statusType": "auto",
        "x": 700,
        "y": 420,
        "wires": []
    },
    {
        "id": "14c3076dd27b816b",
        "type": "function",
        "z": "edf9f455029eeb7f",
        "g": "1a81b3b5b7840ea2",
        "name": "Global Variables",
        "func": "let debug = false;\n\nflow.set('retry_count', 0);\n\ncontext.flow.price_min_sell_difference= 0.06; //6 cents\ncontext.flow.price_percentage_sell_difference = 23; //%\ncontext.flow.price_percentage_sell_efficiency = 0.8; //80%\n\ncontext.flow.calculation_method = \"price\"; //price, percentage_difference, percentage_efficiency\n\ncontext.flow.batt_min_charged = context.global.batt_capacity * context.global.min_soc / 100;\ncontext.flow.batt_charged_capacity = context.global.batt_capacity * (context.global.max_soc - context.global.min_soc) / 100;\n\nfunction printBasicInfo()\n{\n    var gstr = \"\";\n    gstr +=\"Battery Capacity: \" + context.global.batt_capacity + \" Watt\";\n    gstr +=\"\\nCharged Capacity: \" + context.flow.batt_charged_capacity + \" Watt\";\n    gstr +=\"\\nmin-soc: \" + context.global.min_soc + \" %\";\n    gstr +=\"\\nmax-soc: \" + context.global.max_soc + \" %\";\n    gstr +=\"\\nCharge-Rate: \" + context.global.batt_charge_rate + \" Watt\";\n    gstr +=\"\\nDischarge-Rate: \" + context.global.batt_discharge_rate + \" Watt\";\n\n    gstr +=\"\\nCalculation method used: \";\n    switch (context.flow.calculation_method) {\n        case \"price\":\n            gstr +=\"\\nprice difference\";\n            break;\n        case \"percentage_difference\":\n            gstr +=\"\\npercentage difference\";\n            break;\n        case \"percentage_efficiency\":\n            gstr +=\"\\npercentage efficiency\";\n            break;\n    }\n    node.warn((gstr));\n}\n\n// @ts-ignore\nif (debug == true) {\n    printBasicInfo();\n}\n\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 280,
        "y": 100,
        "wires": [
            [
                "122749331c478207"
            ]
        ]
    },
    {
        "id": "b657827f03345e3d",
        "type": "change",
        "z": "edf9f455029eeb7f",
        "g": "9fc897c32bfacc77",
        "name": "Tib2Scheme",
        "rules": [
            {
                "t": "change",
                "p": "topic",
                "pt": "msg",
                "from": "today",
                "fromt": "str",
                "to": "scheme_today",
                "tot": "str"
            },
            {
                "t": "change",
                "p": "topic",
                "pt": "msg",
                "from": "tomorrow",
                "fromt": "str",
                "to": "scheme_tomorrow",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 370,
        "y": 400,
        "wires": [
            [
                "940a6419ce2b4c0f"
            ]
        ]
    },
    {
        "id": "60cbc394be7a8628",
        "type": "catch",
        "z": "edf9f455029eeb7f",
        "g": "9fc897c32bfacc77",
        "name": "",
        "scope": null,
        "uncaught": false,
        "x": 260,
        "y": 280,
        "wires": [
            [
                "2d205981144bf6be",
                "a94b01c687825b75"
            ]
        ]
    },
    {
        "id": "2d205981144bf6be",
        "type": "debug",
        "z": "edf9f455029eeb7f",
        "g": "9fc897c32bfacc77",
        "name": "msg.error",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "error",
        "targetType": "msg",
        "statusVal": "",
        "statusType": "auto",
        "x": 440,
        "y": 320,
        "wires": []
    },
    {
        "id": "a94b01c687825b75",
        "type": "function",
        "z": "edf9f455029eeb7f",
        "g": "9fc897c32bfacc77",
        "name": "Do Retry",
        "func": "let act_retry_count = flow.get('retry_count')  + 1;\nif (act_retry_count >= 8)\n    return null;\nflow.set('retry_count', act_retry_count);\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 420,
        "y": 280,
        "wires": [
            [
                "97ede11f89054187"
            ]
        ]
    },
    {
        "id": "97ede11f89054187",
        "type": "delay",
        "z": "edf9f455029eeb7f",
        "g": "9fc897c32bfacc77",
        "name": "",
        "pauseType": "delay",
        "timeout": "15",
        "timeoutUnits": "minutes",
        "rate": "1",
        "nbRateUnits": "1",
        "rateUnits": "second",
        "randomFirst": "1",
        "randomLast": "5",
        "randomUnits": "seconds",
        "drop": false,
        "allowrate": false,
        "outputs": 1,
        "x": 590,
        "y": 280,
        "wires": [
            [
                "2a77a49d4ff72143"
            ]
        ]
    },
    {
        "id": "1d4ccdbd16aed160",
        "type": "change",
        "z": "edf9f455029eeb7f",
        "g": "9fc897c32bfacc77",
        "name": "Reset",
        "rules": [
            {
                "t": "set",
                "p": "retry_count",
                "pt": "flow",
                "to": "0",
                "tot": "num"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 390,
        "y": 200,
        "wires": [
            [
                "2a77a49d4ff72143"
            ]
        ]
    },
    {
        "id": "2a77a49d4ff72143",
        "type": "change",
        "z": "edf9f455029eeb7f",
        "g": "9fc897c32bfacc77",
        "name": "Start",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "1",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 530,
        "y": 200,
        "wires": [
            [
                "7ed67c1510d458c5"
            ]
        ]
    },
    {
        "id": "18983c8132c11beb",
        "type": "change",
        "z": "edf9f455029eeb7f",
        "g": "9fc897c32bfacc77",
        "name": "Today",
        "rules": [
            {
                "t": "set",
                "p": "today",
                "pt": "msg",
                "to": "true",
                "tot": "bool"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 250,
        "y": 200,
        "wires": [
            [
                "1d4ccdbd16aed160"
            ]
        ]
    },
    {
        "id": "b8e7d236d12fcbe8",
        "type": "change",
        "z": "edf9f455029eeb7f",
        "g": "9fc897c32bfacc77",
        "name": "Tomorrow",
        "rules": [
            {
                "t": "set",
                "p": "today",
                "pt": "msg",
                "to": "false",
                "tot": "bool"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 260,
        "y": 240,
        "wires": [
            [
                "1d4ccdbd16aed160"
            ]
        ]
    },
    {
        "id": "95ef6a6364e11d89",
        "type": "link out",
        "z": "edf9f455029eeb7f",
        "g": "9fc897c32bfacc77",
        "name": "Perform Today",
        "mode": "link",
        "links": [
            "9d7f474efb189328"
        ],
        "x": 785,
        "y": 200,
        "wires": []
    },
    {
        "id": "9d7f474efb189328",
        "type": "link in",
        "z": "edf9f455029eeb7f",
        "g": "53c4909b2cd159f9",
        "name": "Perform Today",
        "links": [
            "95ef6a6364e11d89"
        ],
        "x": 55,
        "y": 540,
        "wires": [
            [
                "82633b4d062d1a13",
                "0b97aa3927f7c375"
            ]
        ]
    },
    {
        "id": "30037a5069c38173",
        "type": "link out",
        "z": "edf9f455029eeb7f",
        "g": "53c4909b2cd159f9",
        "name": "Data Ready",
        "mode": "link",
        "links": [
            "1b6c2789468c41cc"
        ],
        "x": 1175,
        "y": 540,
        "wires": []
    },
    {
        "id": "1b6c2789468c41cc",
        "type": "link in",
        "z": "edf9f455029eeb7f",
        "g": "9fc897c32bfacc77",
        "name": "Data Ready",
        "links": [
            "30037a5069c38173",
            "9e4cb9245413a0c8"
        ],
        "x": 55,
        "y": 380,
        "wires": [
            [
                "3822f057ea823e2f"
            ]
        ]
    },
    {
        "id": "ee7037e289888936",
        "type": "change",
        "z": "edf9f455029eeb7f",
        "g": "53c4909b2cd159f9",
        "name": "T=Today Prices",
        "rules": [
            {
                "t": "set",
                "p": "topic",
                "pt": "msg",
                "to": "tibber_data/today/state",
                "tot": "str"
            },
            {
                "t": "set",
                "p": "sendnow",
                "pt": "msg",
                "to": "true",
                "tot": "bool"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 1040,
        "y": 540,
        "wires": [
            [
                "30037a5069c38173"
            ]
        ]
    },
    {
        "id": "3e91a56b38ec890b",
        "type": "join",
        "z": "edf9f455029eeb7f",
        "g": "53c4909b2cd159f9",
        "name": "Join",
        "mode": "custom",
        "build": "object",
        "property": "payload",
        "propertyType": "msg",
        "key": "topic",
        "joiner": "\\n",
        "joinerType": "str",
        "accumulate": false,
        "timeout": "",
        "count": "2",
        "reduceRight": false,
        "reduceExp": "",
        "reduceInit": "",
        "reduceInitType": "num",
        "reduceFixup": "",
        "x": 800,
        "y": 540,
        "wires": [
            [
                "ee7037e289888936",
                "04465b10565c458c"
            ]
        ]
    },
    {
        "id": "9213fea48881c844",
        "type": "change",
        "z": "edf9f455029eeb7f",
        "g": "53c4909b2cd159f9",
        "name": "T=tibber",
        "rules": [
            {
                "t": "set",
                "p": "topic",
                "pt": "msg",
                "to": "tibber",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 650,
        "y": 540,
        "wires": [
            [
                "3e91a56b38ec890b"
            ]
        ]
    },
    {
        "id": "6c6c80a15e1cb4be",
        "type": "switch",
        "z": "edf9f455029eeb7f",
        "g": "53c4909b2cd159f9",
        "name": "IsOK?",
        "property": "payload",
        "propertyType": "msg",
        "rules": [
            {
                "t": "jsonata_exp",
                "v": "($count(payload))=24 or ($count(payload))=96",
                "vt": "jsonata"
            },
            {
                "t": "else"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 520,
        "y": 540,
        "wires": [
            [
                "9213fea48881c844"
            ],
            [
                "17d5b20904010c39",
                "bdf2bb0f2b1c2b9d"
            ]
        ]
    },
    {
        "id": "17d5b20904010c39",
        "type": "link out",
        "z": "edf9f455029eeb7f",
        "g": "53c4909b2cd159f9",
        "name": "Do Retry",
        "mode": "link",
        "links": [
            "f79ebd4ef82b18e4"
        ],
        "x": 635,
        "y": 580,
        "wires": []
    },
    {
        "id": "f79ebd4ef82b18e4",
        "type": "link in",
        "z": "edf9f455029eeb7f",
        "g": "9fc897c32bfacc77",
        "name": "Do Retry",
        "links": [
            "17d5b20904010c39",
            "159fe759525d9223"
        ],
        "x": 245,
        "y": 320,
        "wires": [
            [
                "a94b01c687825b75"
            ]
        ]
    },
    {
        "id": "0b97aa3927f7c375",
        "type": "subflow:481b42546729112e",
        "z": "edf9f455029eeb7f",
        "g": "53c4909b2cd159f9",
        "name": "",
        "env": [
            {
                "name": "latitude",
                "value": "52.140480",
                "type": "num"
            },
            {
                "name": "longitude",
                "value": "5.436300",
                "type": "num"
            },
            {
                "name": "azimuth",
                "value": "180",
                "type": "num"
            },
            {
                "name": "modules power",
                "value": "13",
                "type": "num"
            },
            {
                "name": "apikey",
                "type": "cred"
            }
        ],
        "x": 220,
        "y": 620,
        "wires": [
            [
                "c23bdedb46992b45",
                "58fe7bca50cdfaef"
            ]
        ]
    },
    {
        "id": "c23bdedb46992b45",
        "type": "switch",
        "z": "edf9f455029eeb7f",
        "g": "53c4909b2cd159f9",
        "name": "IsOK?",
        "property": "payload.result",
        "propertyType": "msg",
        "rules": [
            {
                "t": "nnull"
            },
            {
                "t": "else"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 390,
        "y": 620,
        "wires": [
            [
                "3933f3579ce2aad0"
            ],
            [
                "17d5b20904010c39"
            ]
        ]
    },
    {
        "id": "3933f3579ce2aad0",
        "type": "function",
        "z": "edf9f455029eeb7f",
        "g": "53c4909b2cd159f9",
        "name": "Parse Today",
        "func": "let result = msg.payload.result;\n\nconst d = new Date();\nlet actDay = d.getDate();\n\n//create default array with 0 forcast\nlet aForecast = new Array(24).fill(0);\n\nfor (const [key, value] of Object.entries(result)) {\n    let szDate = key.substring(0,10);\n    let szHour = key.substring(11, 14) + \"00\";\n\n    let day = parseInt(szDate.substring(8,10));\n    let hour = parseInt(key.substring(11, 13));\n\n    if (msg.today) {\n        if (day != actDay) {\n            //not interesting in tomorrow\n            continue;\n        }\n    } else {\n        if (day == actDay) {\n            //not interesting in today\n            continue;\n        }     \n    }\n\n    aForecast[hour] = parseInt(value);\n}\n\nmsg.topic = \"forecast\";\nmsg.payload = aForecast;\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 570,
        "y": 620,
        "wires": [
            [
                "3e91a56b38ec890b",
                "6594f371550728ae"
            ]
        ]
    },
    {
        "id": "3dc11edd9ba338dc",
        "type": "function",
        "z": "edf9f455029eeb7f",
        "g": "53c4909b2cd159f9",
        "name": "Test Data",
        "func": "msg.payload = JSON.parse('[{\"total\":0.2318,\"energy\":0.0695,\"tax\":0.1623,\"startsAt\":\"2025-11-28T00:00:00.000+01:00\",\"currency\":\"EUR\",\"level\":\"CHEAP\"},{\"total\":0.2251,\"energy\":0.064,\"tax\":0.1611,\"startsAt\":\"2025-11-28T00:15:00.000+01:00\",\"currency\":\"EUR\",\"level\":\"CHEAP\"},{\"total\":0.2127,\"energy\":0.0537,\"tax\":0.159,\"startsAt\":\"2025-11-28T00:30:00.000+01:00\",\"currency\":\"EUR\",\"level\":\"CHEAP\"},{\"total\":0.2072,\"energy\":0.0492,\"tax\":0.158,\"startsAt\":\"2025-11-28T00:45:00.000+01:00\",\"currency\":\"EUR\",\"level\":\"CHEAP\"},{\"total\":0.2273,\"energy\":0.0658,\"tax\":0.1615,\"startsAt\":\"2025-11-28T01:00:00.000+01:00\",\"currency\":\"EUR\",\"level\":\"CHEAP\"},{\"total\":0.2124,\"energy\":0.0535,\"tax\":0.1589,\"startsAt\":\"2025-11-28T01:15:00.000+01:00\",\"currency\":\"EUR\",\"level\":\"CHEAP\"},{\"total\":0.2098,\"energy\":0.0513,\"tax\":0.1585,\"startsAt\":\"2025-11-28T01:30:00.000+01:00\",\"currency\":\"EUR\",\"level\":\"CHEAP\"},{\"total\":0.2065,\"energy\":0.0486,\"tax\":0.1579,\"startsAt\":\"2025-11-28T01:45:00.000+01:00\",\"currency\":\"EUR\",\"level\":\"CHEAP\"},{\"total\":0.2126,\"energy\":0.0536,\"tax\":0.159,\"startsAt\":\"2025-11-28T02:00:00.000+01:00\",\"currency\":\"EUR\",\"level\":\"CHEAP\"},{\"total\":0.2115,\"energy\":0.0527,\"tax\":0.1588,\"startsAt\":\"2025-11-28T02:15:00.000+01:00\",\"currency\":\"EUR\",\"level\":\"CHEAP\"},{\"total\":0.21,\"energy\":0.0516,\"tax\":0.1584,\"startsAt\":\"2025-11-28T02:30:00.000+01:00\",\"currency\":\"EUR\",\"level\":\"CHEAP\"},{\"total\":0.2082,\"energy\":0.05,\"tax\":0.1582,\"startsAt\":\"2025-11-28T02:45:00.000+01:00\",\"currency\":\"EUR\",\"level\":\"CHEAP\"},{\"total\":0.2033,\"energy\":0.046,\"tax\":0.1573,\"startsAt\":\"2025-11-28T03:00:00.000+01:00\",\"currency\":\"EUR\",\"level\":\"CHEAP\"},{\"total\":0.2036,\"energy\":0.0462,\"tax\":0.1574,\"startsAt\":\"2025-11-28T03:15:00.000+01:00\",\"currency\":\"EUR\",\"level\":\"CHEAP\"},{\"total\":0.2022,\"energy\":0.045,\"tax\":0.1572,\"startsAt\":\"2025-11-28T03:30:00.000+01:00\",\"currency\":\"EUR\",\"level\":\"CHEAP\"},{\"total\":0.2033,\"energy\":0.046,\"tax\":0.1573,\"startsAt\":\"2025-11-28T03:45:00.000+01:00\",\"currency\":\"EUR\",\"level\":\"CHEAP\"},{\"total\":0.2092,\"energy\":0.0508,\"tax\":0.1584,\"startsAt\":\"2025-11-28T04:00:00.000+01:00\",\"currency\":\"EUR\",\"level\":\"CHEAP\"},{\"total\":0.2095,\"energy\":0.0511,\"tax\":0.1584,\"startsAt\":\"2025-11-28T04:15:00.000+01:00\",\"currency\":\"EUR\",\"level\":\"CHEAP\"},{\"total\":0.2112,\"energy\":0.0525,\"tax\":0.1587,\"startsAt\":\"2025-11-28T04:30:00.000+01:00\",\"currency\":\"EUR\",\"level\":\"CHEAP\"},{\"total\":0.2188,\"energy\":0.0588,\"tax\":0.16,\"startsAt\":\"2025-11-28T04:45:00.000+01:00\",\"currency\":\"EUR\",\"level\":\"CHEAP\"},{\"total\":0.2062,\"energy\":0.0484,\"tax\":0.1578,\"startsAt\":\"2025-11-28T05:00:00.000+01:00\",\"currency\":\"EUR\",\"level\":\"CHEAP\"},{\"total\":0.2122,\"energy\":0.0533,\"tax\":0.1589,\"startsAt\":\"2025-11-28T05:15:00.000+01:00\",\"currency\":\"EUR\",\"level\":\"CHEAP\"},{\"total\":0.2157,\"energy\":0.0562,\"tax\":0.1595,\"startsAt\":\"2025-11-28T05:30:00.000+01:00\",\"currency\":\"EUR\",\"level\":\"CHEAP\"},{\"total\":0.2378,\"energy\":0.0745,\"tax\":0.1633,\"startsAt\":\"2025-11-28T05:45:00.000+01:00\",\"currency\":\"EUR\",\"level\":\"CHEAP\"},{\"total\":0.2216,\"energy\":0.0611,\"tax\":0.1605,\"startsAt\":\"2025-11-28T06:00:00.000+01:00\",\"currency\":\"EUR\",\"level\":\"CHEAP\"},{\"total\":0.2383,\"energy\":0.0749,\"tax\":0.1634,\"startsAt\":\"2025-11-28T06:15:00.000+01:00\",\"currency\":\"EUR\",\"level\":\"CHEAP\"},{\"total\":0.2481,\"energy\":0.083,\"tax\":0.1651,\"startsAt\":\"2025-11-28T06:30:00.000+01:00\",\"currency\":\"EUR\",\"level\":\"CHEAP\"},{\"total\":0.2635,\"energy\":0.0958,\"tax\":0.1677,\"startsAt\":\"2025-11-28T06:45:00.000+01:00\",\"currency\":\"EUR\",\"level\":\"CHEAP\"},{\"total\":0.237,\"energy\":0.0738,\"tax\":0.1632,\"startsAt\":\"2025-11-28T07:00:00.000+01:00\",\"currency\":\"EUR\",\"level\":\"CHEAP\"},{\"total\":0.2476,\"energy\":0.0826,\"tax\":0.165,\"startsAt\":\"2025-11-28T07:15:00.000+01:00\",\"currency\":\"EUR\",\"level\":\"CHEAP\"},{\"total\":0.256,\"energy\":0.0895,\"tax\":0.1665,\"startsAt\":\"2025-11-28T07:30:00.000+01:00\",\"currency\":\"EUR\",\"level\":\"CHEAP\"},{\"total\":0.2452,\"energy\":0.0806,\"tax\":0.1646,\"startsAt\":\"2025-11-28T07:45:00.000+01:00\",\"currency\":\"EUR\",\"level\":\"CHEAP\"},{\"total\":0.2674,\"energy\":0.099,\"tax\":0.1684,\"startsAt\":\"2025-11-28T08:00:00.000+01:00\",\"currency\":\"EUR\",\"level\":\"NORMAL\"},{\"total\":0.2624,\"energy\":0.0948,\"tax\":0.1676,\"startsAt\":\"2025-11-28T08:15:00.000+01:00\",\"currency\":\"EUR\",\"level\":\"CHEAP\"},{\"total\":0.2653,\"energy\":0.0972,\"tax\":0.1681,\"startsAt\":\"2025-11-28T08:30:00.000+01:00\",\"currency\":\"EUR\",\"level\":\"CHEAP\"},{\"total\":0.2672,\"energy\":0.0988,\"tax\":0.1684,\"startsAt\":\"2025-11-28T08:45:00.000+01:00\",\"currency\":\"EUR\",\"level\":\"NORMAL\"},{\"total\":0.2878,\"energy\":0.1158,\"tax\":0.172,\"startsAt\":\"2025-11-28T09:00:00.000+01:00\",\"currency\":\"EUR\",\"level\":\"NORMAL\"},{\"total\":0.2727,\"energy\":0.1033,\"tax\":0.1694,\"startsAt\":\"2025-11-28T09:15:00.000+01:00\",\"currency\":\"EUR\",\"level\":\"NORMAL\"},{\"total\":0.2692,\"energy\":0.1005,\"tax\":0.1687,\"startsAt\":\"2025-11-28T09:30:00.000+01:00\",\"currency\":\"EUR\",\"level\":\"NORMAL\"},{\"total\":0.2633,\"energy\":0.0956,\"tax\":0.1677,\"startsAt\":\"2025-11-28T09:45:00.000+01:00\",\"currency\":\"EUR\",\"level\":\"NORMAL\"},{\"total\":0.2717,\"energy\":0.1025,\"tax\":0.1692,\"startsAt\":\"2025-11-28T10:00:00.000+01:00\",\"currency\":\"EUR\",\"level\":\"NORMAL\"},{\"total\":0.2632,\"energy\":0.0955,\"tax\":0.1677,\"startsAt\":\"2025-11-28T10:15:00.000+01:00\",\"currency\":\"EUR\",\"level\":\"NORMAL\"},{\"total\":0.2635,\"energy\":0.0957,\"tax\":0.1678,\"startsAt\":\"2025-11-28T10:30:00.000+01:00\",\"currency\":\"EUR\",\"level\":\"NORMAL\"},{\"total\":0.2614,\"energy\":0.094,\"tax\":0.1674,\"startsAt\":\"2025-11-28T10:45:00.000+01:00\",\"currency\":\"EUR\",\"level\":\"CHEAP\"},{\"total\":0.2693,\"energy\":0.1005,\"tax\":0.1688,\"startsAt\":\"2025-11-28T11:00:00.000+01:00\",\"currency\":\"EUR\",\"level\":\"NORMAL\"},{\"total\":0.2638,\"energy\":0.096,\"tax\":0.1678,\"startsAt\":\"2025-11-28T11:15:00.000+01:00\",\"currency\":\"EUR\",\"level\":\"NORMAL\"},{\"total\":0.259,\"energy\":0.092,\"tax\":0.167,\"startsAt\":\"2025-11-28T11:30:00.000+01:00\",\"currency\":\"EUR\",\"level\":\"CHEAP\"},{\"total\":0.2571,\"energy\":0.0904,\"tax\":0.1667,\"startsAt\":\"2025-11-28T11:45:00.000+01:00\",\"currency\":\"EUR\",\"level\":\"CHEAP\"},{\"total\":0.2603,\"energy\":0.0931,\"tax\":0.1672,\"startsAt\":\"2025-11-28T12:00:00.000+01:00\",\"currency\":\"EUR\",\"level\":\"CHEAP\"},{\"total\":0.2595,\"energy\":0.0924,\"tax\":0.1671,\"startsAt\":\"2025-11-28T12:15:00.000+01:00\",\"currency\":\"EUR\",\"level\":\"CHEAP\"},{\"total\":0.2684,\"energy\":0.0998,\"tax\":0.1686,\"startsAt\":\"2025-11-28T12:30:00.000+01:00\",\"currency\":\"EUR\",\"level\":\"NORMAL\"},{\"total\":0.2685,\"energy\":0.0998,\"tax\":0.1687,\"startsAt\":\"2025-11-28T12:45:00.000+01:00\",\"currency\":\"EUR\",\"level\":\"NORMAL\"},{\"total\":0.2627,\"energy\":0.0951,\"tax\":0.1676,\"startsAt\":\"2025-11-28T13:00:00.000+01:00\",\"currency\":\"EUR\",\"level\":\"NORMAL\"},{\"total\":0.2649,\"energy\":0.0968,\"tax\":0.1681,\"startsAt\":\"2025-11-28T13:15:00.000+01:00\",\"currency\":\"EUR\",\"level\":\"NORMAL\"},{\"total\":0.2655,\"energy\":0.0974,\"tax\":0.1681,\"startsAt\":\"2025-11-28T13:30:00.000+01:00\",\"currency\":\"EUR\",\"level\":\"NORMAL\"},{\"total\":0.2637,\"energy\":0.0959,\"tax\":0.1678,\"startsAt\":\"2025-11-28T13:45:00.000+01:00\",\"currency\":\"EUR\",\"level\":\"NORMAL\"},{\"total\":0.2457,\"energy\":0.081,\"tax\":0.1647,\"startsAt\":\"2025-11-28T14:00:00.000+01:00\",\"currency\":\"EUR\",\"level\":\"CHEAP\"},{\"total\":0.2412,\"energy\":0.0773,\"tax\":0.1639,\"startsAt\":\"2025-11-28T14:15:00.000+01:00\",\"currency\":\"EUR\",\"level\":\"CHEAP\"},{\"total\":0.2404,\"energy\":0.0767,\"tax\":0.1637,\"startsAt\":\"2025-11-28T14:30:00.000+01:00\",\"currency\":\"EUR\",\"level\":\"CHEAP\"},{\"total\":0.2408,\"energy\":0.077,\"tax\":0.1638,\"startsAt\":\"2025-11-28T14:45:00.000+01:00\",\"currency\":\"EUR\",\"level\":\"CHEAP\"},{\"total\":0.2564,\"energy\":0.0899,\"tax\":0.1665,\"startsAt\":\"2025-11-28T15:00:00.000+01:00\",\"currency\":\"EUR\",\"level\":\"CHEAP\"},{\"total\":0.2677,\"energy\":0.0992,\"tax\":0.1685,\"startsAt\":\"2025-11-28T15:15:00.000+01:00\",\"currency\":\"EUR\",\"level\":\"NORMAL\"},{\"total\":0.2829,\"energy\":0.1118,\"tax\":0.1711,\"startsAt\":\"2025-11-28T15:30:00.000+01:00\",\"currency\":\"EUR\",\"level\":\"NORMAL\"},{\"total\":0.2697,\"energy\":0.1008,\"tax\":0.1689,\"startsAt\":\"2025-11-28T15:45:00.000+01:00\",\"currency\":\"EUR\",\"level\":\"NORMAL\"},{\"total\":0.2525,\"energy\":0.0866,\"tax\":0.1659,\"startsAt\":\"2025-11-28T16:00:00.000+01:00\",\"currency\":\"EUR\",\"level\":\"CHEAP\"},{\"total\":0.2601,\"energy\":0.0929,\"tax\":0.1672,\"startsAt\":\"2025-11-28T16:15:00.000+01:00\",\"currency\":\"EUR\",\"level\":\"NORMAL\"},{\"total\":0.2634,\"energy\":0.0956,\"tax\":0.1678,\"startsAt\":\"2025-11-28T16:30:00.000+01:00\",\"currency\":\"EUR\",\"level\":\"NORMAL\"},{\"total\":0.2703,\"energy\":0.1014,\"tax\":0.1689,\"startsAt\":\"2025-11-28T16:45:00.000+01:00\",\"currency\":\"EUR\",\"level\":\"NORMAL\"},{\"total\":0.2585,\"energy\":0.0916,\"tax\":0.1669,\"startsAt\":\"2025-11-28T17:00:00.000+01:00\",\"currency\":\"EUR\",\"level\":\"NORMAL\"},{\"total\":0.2641,\"energy\":0.0962,\"tax\":0.1679,\"startsAt\":\"2025-11-28T17:15:00.000+01:00\",\"currency\":\"EUR\",\"level\":\"NORMAL\"},{\"total\":0.2636,\"energy\":0.0958,\"tax\":0.1678,\"startsAt\":\"2025-11-28T17:30:00.000+01:00\",\"currency\":\"EUR\",\"level\":\"NORMAL\"},{\"total\":0.2638,\"energy\":0.096,\"tax\":0.1678,\"startsAt\":\"2025-11-28T17:45:00.000+01:00\",\"currency\":\"EUR\",\"level\":\"NORMAL\"},{\"total\":0.2689,\"energy\":0.1002,\"tax\":0.1687,\"startsAt\":\"2025-11-28T18:00:00.000+01:00\",\"currency\":\"EUR\",\"level\":\"NORMAL\"},{\"total\":0.262,\"energy\":0.0945,\"tax\":0.1675,\"startsAt\":\"2025-11-28T18:15:00.000+01:00\",\"currency\":\"EUR\",\"level\":\"NORMAL\"},{\"total\":0.262,\"energy\":0.0945,\"tax\":0.1675,\"startsAt\":\"2025-11-28T18:30:00.000+01:00\",\"currency\":\"EUR\",\"level\":\"NORMAL\"},{\"total\":0.2408,\"energy\":0.077,\"tax\":0.1638,\"startsAt\":\"2025-11-28T18:45:00.000+01:00\",\"currency\":\"EUR\",\"level\":\"CHEAP\"},{\"total\":0.2714,\"energy\":0.1022,\"tax\":0.1692,\"startsAt\":\"2025-11-28T19:00:00.000+01:00\",\"currency\":\"EUR\",\"level\":\"NORMAL\"},{\"total\":0.2623,\"energy\":0.0947,\"tax\":0.1676,\"startsAt\":\"2025-11-28T19:15:00.000+01:00\",\"currency\":\"EUR\",\"level\":\"NORMAL\"},{\"total\":0.2568,\"energy\":0.0902,\"tax\":0.1666,\"startsAt\":\"2025-11-28T19:30:00.000+01:00\",\"currency\":\"EUR\",\"level\":\"NORMAL\"},{\"total\":0.2453,\"energy\":0.0807,\"tax\":0.1646,\"startsAt\":\"2025-11-28T19:45:00.000+01:00\",\"currency\":\"EUR\",\"level\":\"CHEAP\"},{\"total\":0.2698,\"energy\":0.101,\"tax\":0.1688,\"startsAt\":\"2025-11-28T20:00:00.000+01:00\",\"currency\":\"EUR\",\"level\":\"NORMAL\"},{\"total\":0.2515,\"energy\":0.0858,\"tax\":0.1657,\"startsAt\":\"2025-11-28T20:15:00.000+01:00\",\"currency\":\"EUR\",\"level\":\"NORMAL\"},{\"total\":0.248,\"energy\":0.0829,\"tax\":0.1651,\"startsAt\":\"2025-11-28T20:30:00.000+01:00\",\"currency\":\"EUR\",\"level\":\"CHEAP\"},{\"total\":0.2374,\"energy\":0.0742,\"tax\":0.1632,\"startsAt\":\"2025-11-28T20:45:00.000+01:00\",\"currency\":\"EUR\",\"level\":\"CHEAP\"},{\"total\":0.2557,\"energy\":0.0893,\"tax\":0.1664,\"startsAt\":\"2025-11-28T21:00:00.000+01:00\",\"currency\":\"EUR\",\"level\":\"NORMAL\"},{\"total\":0.2532,\"energy\":0.0872,\"tax\":0.166,\"startsAt\":\"2025-11-28T21:15:00.000+01:00\",\"currency\":\"EUR\",\"level\":\"NORMAL\"},{\"total\":0.2492,\"energy\":0.0839,\"tax\":0.1653,\"startsAt\":\"2025-11-28T21:30:00.000+01:00\",\"currency\":\"EUR\",\"level\":\"NORMAL\"},{\"total\":0.236,\"energy\":0.073,\"tax\":0.163,\"startsAt\":\"2025-11-28T21:45:00.000+01:00\",\"currency\":\"EUR\",\"level\":\"CHEAP\"},{\"total\":0.256,\"energy\":0.0895,\"tax\":0.1665,\"startsAt\":\"2025-11-28T22:00:00.000+01:00\",\"currency\":\"EUR\",\"level\":\"NORMAL\"},{\"total\":0.2488,\"energy\":0.0836,\"tax\":0.1652,\"startsAt\":\"2025-11-28T22:15:00.000+01:00\",\"currency\":\"EUR\",\"level\":\"NORMAL\"},{\"total\":0.2529,\"energy\":0.087,\"tax\":0.1659,\"startsAt\":\"2025-11-28T22:30:00.000+01:00\",\"currency\":\"EUR\",\"level\":\"NORMAL\"},{\"total\":0.2394,\"energy\":0.0758,\"tax\":0.1636,\"startsAt\":\"2025-11-28T22:45:00.000+01:00\",\"currency\":\"EUR\",\"level\":\"CHEAP\"},{\"total\":0.2495,\"energy\":0.0842,\"tax\":0.1653,\"startsAt\":\"2025-11-28T23:00:00.000+01:00\",\"currency\":\"EUR\",\"level\":\"NORMAL\"},{\"total\":0.2399,\"energy\":0.0762,\"tax\":0.1637,\"startsAt\":\"2025-11-28T23:15:00.000+01:00\",\"currency\":\"EUR\",\"level\":\"CHEAP\"},{\"total\":0.2385,\"energy\":0.0751,\"tax\":0.1634,\"startsAt\":\"2025-11-28T23:30:00.000+01:00\",\"currency\":\"EUR\",\"level\":\"CHEAP\"},{\"total\":0.2339,\"energy\":0.0712,\"tax\":0.1627,\"startsAt\":\"2025-11-28T23:45:00.000+01:00\",\"currency\":\"EUR\",\"level\":\"CHEAP\"}]');\nmsg.topic = \"tibber\";\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 260,
        "y": 580,
        "wires": [
            [
                "6c6c80a15e1cb4be"
            ]
        ]
    },
    {
        "id": "098ed9195ff7a18f",
        "type": "function",
        "z": "edf9f455029eeb7f",
        "g": "53c4909b2cd159f9",
        "name": "Test data",
        "func": "msg.payload = JSON.parse('{\"result\":{\"2025-11-28 08:20:27\":0,\"2025-11-28 09:00:00\":471,\"2025-11-28 10:00:00\":888,\"2025-11-28 11:00:00\":1177,\"2025-11-28 12:00:00\":1302,\"2025-11-28 13:00:00\":1248,\"2025-11-28 14:00:00\":1026,\"2025-11-28 15:00:00\":644,\"2025-11-28 16:00:00\":240,\"2025-11-28 16:32:06\":0,\"2025-11-29 08:21:56\":0,\"2025-11-29 09:00:00\":465,\"2025-11-29 10:00:00\":885,\"2025-11-29 11:00:00\":1177,\"2025-11-29 12:00:00\":1300,\"2025-11-29 13:00:00\":1246,\"2025-11-29 14:00:00\":1023,\"2025-11-29 15:00:00\":640,\"2025-11-29 16:00:00\":324,\"2025-11-29 16:31:18\":0},\"message\":{\"code\":0,\"type\":\"success\",\"text\":\"\",\"pid\":\"55j2E2z6\",\"info\":{\"latitude\":52.1405,\"longitude\":5.4363,\"distance\":0,\"place\":\"Ruige Velddreef 34, 3831 PG Leusden, Netherlands\",\"timezone\":\"Europe/Amsterdam\",\"time\":\"2025-11-28T15:08:49+01:00\",\"time_utc\":\"2025-11-28T14:08:49+00:00\"},\"ratelimit\":{\"zone\":\"IP 45.142.18.18\",\"period\":3600,\"limit\":12,\"remaining\":10}}}');\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 200,
        "y": 660,
        "wires": [
            [
                "c23bdedb46992b45"
            ]
        ]
    },
    {
        "id": "9e4cb9245413a0c8",
        "type": "link out",
        "z": "edf9f455029eeb7f",
        "g": "09a080a963e69d6f",
        "name": "Data Ready",
        "mode": "link",
        "links": [
            "1b6c2789468c41cc"
        ],
        "x": 1165,
        "y": 760,
        "wires": []
    },
    {
        "id": "2267757ef11d51f0",
        "type": "join",
        "z": "edf9f455029eeb7f",
        "g": "09a080a963e69d6f",
        "name": "Join",
        "mode": "custom",
        "build": "object",
        "property": "payload",
        "propertyType": "msg",
        "key": "topic",
        "joiner": "\\n",
        "joinerType": "str",
        "accumulate": false,
        "timeout": "",
        "count": "2",
        "reduceRight": false,
        "reduceExp": "",
        "reduceInit": "",
        "reduceInitType": "num",
        "reduceFixup": "",
        "x": 790,
        "y": 760,
        "wires": [
            [
                "a73a59c7a15f6a8f",
                "b1959991955e2764"
            ]
        ]
    },
    {
        "id": "c99527de89c75e32",
        "type": "change",
        "z": "edf9f455029eeb7f",
        "g": "09a080a963e69d6f",
        "name": "T=tibber",
        "rules": [
            {
                "t": "set",
                "p": "topic",
                "pt": "msg",
                "to": "tibber",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 640,
        "y": 760,
        "wires": [
            [
                "2267757ef11d51f0"
            ]
        ]
    },
    {
        "id": "57db08c51ea509f2",
        "type": "switch",
        "z": "edf9f455029eeb7f",
        "g": "09a080a963e69d6f",
        "name": "IsOK?",
        "property": "payload",
        "propertyType": "msg",
        "rules": [
            {
                "t": "jsonata_exp",
                "v": "($count(payload))=24 or ($count(payload))=96",
                "vt": "jsonata"
            },
            {
                "t": "else"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 510,
        "y": 760,
        "wires": [
            [
                "c99527de89c75e32"
            ],
            [
                "159fe759525d9223"
            ]
        ]
    },
    {
        "id": "159fe759525d9223",
        "type": "link out",
        "z": "edf9f455029eeb7f",
        "g": "09a080a963e69d6f",
        "name": "Do Retry",
        "mode": "link",
        "links": [
            "f79ebd4ef82b18e4"
        ],
        "x": 625,
        "y": 800,
        "wires": []
    },
    {
        "id": "2fa2476e9ee7e277",
        "type": "subflow:481b42546729112e",
        "z": "edf9f455029eeb7f",
        "g": "09a080a963e69d6f",
        "name": "",
        "env": [
            {
                "name": "latitude",
                "value": "52.140480",
                "type": "num"
            },
            {
                "name": "longitude",
                "value": "5.436300",
                "type": "num"
            },
            {
                "name": "azimuth",
                "value": "180",
                "type": "num"
            },
            {
                "name": "modules power",
                "value": "13",
                "type": "num"
            },
            {
                "name": "apikey",
                "type": "cred"
            }
        ],
        "x": 210,
        "y": 840,
        "wires": [
            [
                "ca4017109521366e",
                "e5d4cef80c1ff7da"
            ]
        ]
    },
    {
        "id": "ca4017109521366e",
        "type": "switch",
        "z": "edf9f455029eeb7f",
        "g": "09a080a963e69d6f",
        "name": "IsOK?",
        "property": "payload.result",
        "propertyType": "msg",
        "rules": [
            {
                "t": "nnull"
            },
            {
                "t": "else"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 380,
        "y": 840,
        "wires": [
            [
                "3ebb033deb357c05"
            ],
            [
                "159fe759525d9223"
            ]
        ]
    },
    {
        "id": "3ebb033deb357c05",
        "type": "function",
        "z": "edf9f455029eeb7f",
        "g": "09a080a963e69d6f",
        "name": "Parse Payload",
        "func": "let result = msg.payload.result;\n\nconst d = new Date();\nlet actDay = d.getDate();\n\n//create default array with 0 forcast\nlet aForecast = new Array(24).fill(0);\n\nfor (const [key, value] of Object.entries(result)) {\n    let szDate = key.substring(0,10);\n    let szHour = key.substring(11, 14) + \"00\";\n\n    let day = parseInt(szDate.substring(8,10));\n    let hour = parseInt(key.substring(11, 13));\n\n    if (msg.today) {\n        if (day != actDay) {\n            //not interesting in tomorrow\n            continue;\n        }\n    } else {\n        if (day == actDay) {\n            //not interesting in today\n            continue;\n        }     \n    }\n\n    aForecast[hour] = parseInt(value);\n}\n\nmsg.topic = \"forecast\";\nmsg.payload = aForecast;\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 570,
        "y": 840,
        "wires": [
            [
                "2267757ef11d51f0",
                "de9ac7915d363f46"
            ]
        ]
    },
    {
        "id": "febaf0d9ca8c4d2b",
        "type": "function",
        "z": "edf9f455029eeb7f",
        "g": "09a080a963e69d6f",
        "name": "Test Data",
        "func": "msg.payload = JSON.parse('[{\"total\":0.2452,\"energy\":0.0763,\"tax\":0.1689,\"startsAt\":\"2024-07-30T00:00:00.000+02:00\",\"currency\":\"EUR\",\"level\":\"NORMAL\"},{\"total\":0.2426,\"energy\":0.0742,\"tax\":0.1684,\"startsAt\":\"2024-07-30T01:00:00.000+02:00\",\"currency\":\"EUR\",\"level\":\"NORMAL\"},{\"total\":0.245,\"energy\":0.0762,\"tax\":0.1688,\"startsAt\":\"2024-07-30T02:00:00.000+02:00\",\"currency\":\"EUR\",\"level\":\"NORMAL\"},{\"total\":0.2506,\"energy\":0.0808,\"tax\":0.1698,\"startsAt\":\"2024-07-30T03:00:00.000+02:00\",\"currency\":\"EUR\",\"level\":\"NORMAL\"},{\"total\":0.2561,\"energy\":0.0854,\"tax\":0.1707,\"startsAt\":\"2024-07-30T04:00:00.000+02:00\",\"currency\":\"EUR\",\"level\":\"NORMAL\"},{\"total\":0.2741,\"energy\":0.1002,\"tax\":0.1739,\"startsAt\":\"2024-07-30T05:00:00.000+02:00\",\"currency\":\"EUR\",\"level\":\"EXPENSIVE\"},{\"total\":0.287,\"energy\":0.1109,\"tax\":0.1761,\"startsAt\":\"2024-07-30T06:00:00.000+02:00\",\"currency\":\"EUR\",\"level\":\"EXPENSIVE\"},{\"total\":0.2847,\"energy\":0.109,\"tax\":0.1757,\"startsAt\":\"2024-07-30T07:00:00.000+02:00\",\"currency\":\"EUR\",\"level\":\"EXPENSIVE\"},{\"total\":0.2719,\"energy\":0.0984,\"tax\":0.1735,\"startsAt\":\"2024-07-30T08:00:00.000+02:00\",\"currency\":\"EUR\",\"level\":\"EXPENSIVE\"},{\"total\":0.234,\"energy\":0.0671,\"tax\":0.1669,\"startsAt\":\"2024-07-30T09:00:00.000+02:00\",\"currency\":\"EUR\",\"level\":\"NORMAL\"},{\"total\":0.1982,\"energy\":0.0375,\"tax\":0.1607,\"startsAt\":\"2024-07-30T10:00:00.000+02:00\",\"currency\":\"EUR\",\"level\":\"CHEAP\"},{\"total\":0.1623,\"energy\":0.0078,\"tax\":0.1545,\"startsAt\":\"2024-07-30T11:00:00.000+02:00\",\"currency\":\"EUR\",\"level\":\"CHEAP\"},{\"total\":0.154,\"energy\":0.001,\"tax\":0.153,\"startsAt\":\"2024-07-30T12:00:00.000+02:00\",\"currency\":\"EUR\",\"level\":\"CHEAP\"},{\"total\":0.1528,\"energy\":-0.0001,\"tax\":0.1529,\"startsAt\":\"2024-07-30T13:00:00.000+02:00\",\"currency\":\"EUR\",\"level\":\"CHEAP\"},{\"total\":0.1528,\"energy\":-0.0001,\"tax\":0.1529,\"startsAt\":\"2024-07-30T14:00:00.000+02:00\",\"currency\":\"EUR\",\"level\":\"CHEAP\"},{\"total\":0.1687,\"energy\":0.0131,\"tax\":0.1556,\"startsAt\":\"2024-07-30T15:00:00.000+02:00\",\"currency\":\"EUR\",\"level\":\"CHEAP\"},{\"total\":0.2021,\"energy\":0.0407,\"tax\":0.1614,\"startsAt\":\"2024-07-30T16:00:00.000+02:00\",\"currency\":\"EUR\",\"level\":\"CHEAP\"},{\"total\":0.2464,\"energy\":0.0773,\"tax\":0.1691,\"startsAt\":\"2024-07-30T17:00:00.000+02:00\",\"currency\":\"EUR\",\"level\":\"NORMAL\"},{\"total\":0.2765,\"energy\":0.1022,\"tax\":0.1743,\"startsAt\":\"2024-07-30T18:00:00.000+02:00\",\"currency\":\"EUR\",\"level\":\"EXPENSIVE\"},{\"total\":0.3062,\"energy\":0.1268,\"tax\":0.1794,\"startsAt\":\"2024-07-30T19:00:00.000+02:00\",\"currency\":\"EUR\",\"level\":\"EXPENSIVE\"},{\"total\":0.3521,\"energy\":0.1647,\"tax\":0.1874,\"startsAt\":\"2024-07-30T20:00:00.000+02:00\",\"currency\":\"EUR\",\"level\":\"VERY_EXPENSIVE\"},{\"total\":0.3278,\"energy\":0.1446,\"tax\":0.1832,\"startsAt\":\"2024-07-30T21:00:00.000+02:00\",\"currency\":\"EUR\",\"level\":\"VERY_EXPENSIVE\"},{\"total\":0.2915,\"energy\":0.1146,\"tax\":0.1769,\"startsAt\":\"2024-07-30T22:00:00.000+02:00\",\"currency\":\"EUR\",\"level\":\"EXPENSIVE\"},{\"total\":0.2727,\"energy\":0.099,\"tax\":0.1737,\"startsAt\":\"2024-07-30T23:00:00.000+02:00\",\"currency\":\"EUR\",\"level\":\"EXPENSIVE\"}]');\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 310,
        "y": 800,
        "wires": [
            []
        ]
    },
    {
        "id": "6535373b1607bd1e",
        "type": "function",
        "z": "edf9f455029eeb7f",
        "g": "09a080a963e69d6f",
        "name": "Test data",
        "func": "msg.payload = JSON.parse('{\"result\":{\"2024-07-30 05:57:25\":0,\"2024-07-30 06:15:00\":376,\"2024-07-30 07:00:00\":938,\"2024-07-30 08:00:00\":1691,\"2024-07-30 09:00:00\":2240,\"2024-07-30 10:00:00\":2612,\"2024-07-30 11:00:00\":2661,\"2024-07-30 12:00:00\":2847,\"2024-07-30 13:00:00\":3038,\"2024-07-30 14:00:00\":3053,\"2024-07-30 15:00:00\":2924,\"2024-07-30 16:00:00\":2722,\"2024-07-30 17:00:00\":2446,\"2024-07-30 18:00:00\":2029,\"2024-07-30 19:00:00\":1541,\"2024-07-30 20:00:00\":983,\"2024-07-30 21:31:58\":0,\"2024-07-31 05:58:57\":0,\"2024-07-31 06:15:00\":318,\"2024-07-31 07:00:00\":789,\"2024-07-31 08:00:00\":1381,\"2024-07-31 09:00:00\":1914,\"2024-07-31 10:00:00\":2364,\"2024-07-31 11:00:00\":2699,\"2024-07-31 12:00:00\":2939,\"2024-07-31 13:00:00\":3141,\"2024-07-31 14:00:00\":3136,\"2024-07-31 15:00:00\":2961,\"2024-07-31 16:00:00\":2684,\"2024-07-31 17:00:00\":2320,\"2024-07-31 18:00:00\":1820,\"2024-07-31 19:00:00\":1278,\"2024-07-31 20:00:00\":791,\"2024-07-31 21:30:19\":0},\"message\":{\"code\":0,\"type\":\"success\",\"text\":\"\",\"pid\":\"19fhEATJ\",\"info\":{\"latitude\":52.1405,\"longitude\":5.4363,\"distance\":0,\"place\":\"Ruige Velddreef 34, 3831 PG Leusden, Netherlands\",\"timezone\":\"Europe/Amsterdam\",\"time\":\"2024-07-30T14:36:15+02:00\",\"time_utc\":\"2024-07-30T12:36:15+00:00\"},\"ratelimit\":{\"zone\":\"IP 77.164.175.181\",\"period\":3600,\"limit\":12,\"remaining\":11}}}');\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 190,
        "y": 880,
        "wires": [
            [
                "ca4017109521366e"
            ]
        ]
    },
    {
        "id": "a73a59c7a15f6a8f",
        "type": "change",
        "z": "edf9f455029eeb7f",
        "g": "09a080a963e69d6f",
        "name": "T=Tomorrow Prices",
        "rules": [
            {
                "t": "set",
                "p": "topic",
                "pt": "msg",
                "to": "tibber_data/tomorrow/state",
                "tot": "str"
            },
            {
                "t": "set",
                "p": "sendnow",
                "pt": "msg",
                "to": "true",
                "tot": "bool"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 1020,
        "y": 760,
        "wires": [
            [
                "9e4cb9245413a0c8",
                "7ad94d67cc981181"
            ]
        ]
    },
    {
        "id": "7ed67c1510d458c5",
        "type": "switch",
        "z": "edf9f455029eeb7f",
        "g": "9fc897c32bfacc77",
        "name": "",
        "property": "today",
        "propertyType": "msg",
        "rules": [
            {
                "t": "true"
            },
            {
                "t": "false"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 650,
        "y": 200,
        "wires": [
            [
                "95ef6a6364e11d89"
            ],
            [
                "cef1e6499e62a43b"
            ]
        ]
    },
    {
        "id": "9d508e53fd26ec14",
        "type": "link in",
        "z": "edf9f455029eeb7f",
        "g": "09a080a963e69d6f",
        "name": "Perform Tomorrow",
        "links": [
            "cef1e6499e62a43b"
        ],
        "x": 55,
        "y": 760,
        "wires": [
            [
                "5333b48ce6123b27",
                "2fa2476e9ee7e277"
            ]
        ]
    },
    {
        "id": "cef1e6499e62a43b",
        "type": "link out",
        "z": "edf9f455029eeb7f",
        "g": "9fc897c32bfacc77",
        "name": "Perform Tomorrow",
        "mode": "link",
        "links": [
            "9d508e53fd26ec14"
        ],
        "x": 785,
        "y": 240,
        "wires": []
    },
    {
        "id": "58fe7bca50cdfaef",
        "type": "debug",
        "z": "edf9f455029eeb7f",
        "g": "53c4909b2cd159f9",
        "name": "debug 62",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "false",
        "statusVal": "",
        "statusType": "auto",
        "x": 400,
        "y": 660,
        "wires": []
    },
    {
        "id": "e5d4cef80c1ff7da",
        "type": "debug",
        "z": "edf9f455029eeb7f",
        "g": "09a080a963e69d6f",
        "name": "debug 63",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "false",
        "statusVal": "",
        "statusType": "auto",
        "x": 400,
        "y": 880,
        "wires": []
    },
    {
        "id": "217231edf82187b4",
        "type": "debug",
        "z": "edf9f455029eeb7f",
        "g": "09a080a963e69d6f",
        "name": "debug 4",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "false",
        "statusVal": "",
        "statusType": "auto",
        "x": 460,
        "y": 800,
        "wires": []
    },
    {
        "id": "163435e0cf50467f",
        "type": "inject",
        "z": "edf9f455029eeb7f",
        "name": "Force Tomorrow",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 1060,
        "y": 240,
        "wires": [
            [
                "cef1e6499e62a43b"
            ]
        ]
    },
    {
        "id": "b1959991955e2764",
        "type": "debug",
        "z": "edf9f455029eeb7f",
        "g": "09a080a963e69d6f",
        "name": "debug 5",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "false",
        "statusVal": "",
        "statusType": "auto",
        "x": 890,
        "y": 800,
        "wires": []
    },
    {
        "id": "7ad94d67cc981181",
        "type": "debug",
        "z": "edf9f455029eeb7f",
        "g": "09a080a963e69d6f",
        "name": "debug 6",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "false",
        "statusVal": "",
        "statusType": "auto",
        "x": 1110,
        "y": 800,
        "wires": []
    },
    {
        "id": "11d9d6c1a87bf0a3",
        "type": "debug",
        "z": "edf9f455029eeb7f",
        "g": "53c4909b2cd159f9",
        "name": "debug 2",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "false",
        "statusVal": "",
        "statusType": "auto",
        "x": 470,
        "y": 580,
        "wires": []
    },
    {
        "id": "bdf2bb0f2b1c2b9d",
        "type": "debug",
        "z": "edf9f455029eeb7f",
        "g": "53c4909b2cd159f9",
        "name": "debug 8",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "false",
        "statusVal": "",
        "statusType": "auto",
        "x": 770,
        "y": 600,
        "wires": []
    },
    {
        "id": "04465b10565c458c",
        "type": "debug",
        "z": "edf9f455029eeb7f",
        "g": "53c4909b2cd159f9",
        "name": "debug 9",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "false",
        "statusVal": "",
        "statusType": "auto",
        "x": 930,
        "y": 580,
        "wires": []
    },
    {
        "id": "82633b4d062d1a13",
        "type": "tibber-data",
        "z": "edf9f455029eeb7f",
        "g": "53c4909b2cd159f9",
        "name": "Get Today Prices",
        "active": true,
        "apiEndpointRef": "09c638b767297aba",
        "queryName": "getTodaysEnergyPrices",
        "homeId": "49bf2e0e-83cf-4388-b0d5-a03a407a3cc0",
        "energyResolution": "QUARTER_HOURLY",
        "lastCount": 10,
        "x": 290,
        "y": 540,
        "wires": [
            [
                "6c6c80a15e1cb4be",
                "11d9d6c1a87bf0a3"
            ]
        ]
    },
    {
        "id": "5333b48ce6123b27",
        "type": "tibber-data",
        "z": "edf9f455029eeb7f",
        "g": "09a080a963e69d6f",
        "name": "Get Tomorrow Prices",
        "active": true,
        "apiEndpointRef": "09c638b767297aba",
        "queryName": "getTomorrowsEnergyPrices",
        "homeId": "49bf2e0e-83cf-4388-b0d5-a03a407a3cc0",
        "energyResolution": "QUARTER_HOURLY",
        "lastCount": 10,
        "x": 330,
        "y": 760,
        "wires": [
            [
                "57db08c51ea509f2",
                "217231edf82187b4"
            ]
        ]
    },
    {
        "id": "8ad9d82b77e213a6",
        "type": "inject",
        "z": "edf9f455029eeb7f",
        "g": "9fc897c32bfacc77",
        "name": "@15:01",
        "props": [
            {
                "p": "payload"
            }
        ],
        "repeat": "",
        "crontab": "01 15 * * *",
        "once": false,
        "onceDelay": "2",
        "topic": "",
        "payload": "1",
        "payloadType": "str",
        "x": 120,
        "y": 280,
        "wires": [
            [
                "b8e7d236d12fcbe8"
            ]
        ]
    },
    {
        "id": "6594f371550728ae",
        "type": "debug",
        "z": "edf9f455029eeb7f",
        "g": "53c4909b2cd159f9",
        "name": "debug 65",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "false",
        "statusVal": "",
        "statusType": "auto",
        "x": 720,
        "y": 660,
        "wires": []
    },
    {
        "id": "de9ac7915d363f46",
        "type": "debug",
        "z": "edf9f455029eeb7f",
        "g": "09a080a963e69d6f",
        "name": "debug 66",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "false",
        "statusVal": "",
        "statusType": "auto",
        "x": 750,
        "y": 860,
        "wires": []
    },
    {
        "id": "4943b9a1398b4d9d",
        "type": "function",
        "z": "13fd8d3e42908a31",
        "name": "log_domo",
        "func": "let str = msg.payload;\nlet alert = encodeURIComponent(str);\nlet level=msg.topic\nmsg.url = \"http://192.168.0.90:8080/json.htm?type=command&param=addlogmessage&message=\"+alert+\"&level=\"+level;\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 220,
        "y": 100,
        "wires": [
            [
                "54ff11746108429f"
            ]
        ]
    },
    {
        "id": "54ff11746108429f",
        "type": "http request",
        "z": "13fd8d3e42908a31",
        "name": "",
        "method": "GET",
        "ret": "txt",
        "paytoqs": false,
        "url": "",
        "persist": false,
        "insecureHTTPParser": false,
        "authType": "",
        "senderr": false,
        "headers": [],
        "x": 430,
        "y": 120,
        "wires": [
            [
                "dae890e2161d6a61"
            ]
        ]
    },
    {
        "id": "44d07b9e813b1e68",
        "type": "link in",
        "z": "13fd8d3e42908a31",
        "name": "log_domo",
        "links": [
            "47ac3bb0d650e7cd",
            "50726057d964075f",
            "d72e4c9c76c0a54b",
            "198705d9b12167f3",
            "99ad6f3fc2443ad9"
        ],
        "x": 65,
        "y": 100,
        "wires": [
            [
                "4943b9a1398b4d9d"
            ]
        ]
    },
    {
        "id": "dae890e2161d6a61",
        "type": "debug",
        "z": "13fd8d3e42908a31",
        "name": "Domo result",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "payload",
        "targetType": "msg",
        "statusVal": "",
        "statusType": "auto",
        "x": 610,
        "y": 120,
        "wires": []
    },
    {
        "id": "6744f5332974af3d",
        "type": "inject",
        "z": "13fd8d3e42908a31",
        "name": "Node Red Log",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": true,
        "onceDelay": 0.1,
        "topic": "2",
        "payload": "Node Red restarted",
        "payloadType": "str",
        "x": 140,
        "y": 220,
        "wires": [
            [
                "47ac3bb0d650e7cd"
            ]
        ]
    },
    {
        "id": "47ac3bb0d650e7cd",
        "type": "link out",
        "z": "13fd8d3e42908a31",
        "name": "link out 1",
        "mode": "link",
        "links": [
            "44d07b9e813b1e68"
        ],
        "x": 295,
        "y": 220,
        "wires": []
    },
    {
        "id": "05d89bda971debf5",
        "type": "function",
        "z": "13fd8d3e42908a31",
        "name": "alert_domo",
        "func": "let str = msg.payload;\nlet alert = encodeURIComponent(str);\nlet subject=msg.topic\nmsg.url = \"http://192.168.0.90:8080/json.htm?type=command&param=sendnotification&subject=\"+subject+\"&body=\"+alert;\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 210,
        "y": 160,
        "wires": [
            [
                "54ff11746108429f"
            ]
        ]
    },
    {
        "id": "1ade85b91dd1ef10",
        "type": "link in",
        "z": "13fd8d3e42908a31",
        "name": "alert_domo",
        "links": [
            "cb675392ac82f529",
            "99ad6f3fc2443ad9",
            "c98ba4a4240e9149",
            "34d0e700c095c17d"
        ],
        "x": 65,
        "y": 160,
        "wires": [
            [
                "05d89bda971debf5"
            ]
        ]
    },
    {
        "id": "1286c1e855b91cf4",
        "type": "inject",
        "z": "13fd8d3e42908a31",
        "name": "Node Red Alert",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": true,
        "onceDelay": 0.1,
        "topic": "ALERT",
        "payload": "Node Red restarted",
        "payloadType": "str",
        "x": 140,
        "y": 280,
        "wires": [
            [
                "cb675392ac82f529"
            ]
        ]
    },
    {
        "id": "cb675392ac82f529",
        "type": "link out",
        "z": "13fd8d3e42908a31",
        "name": "link out 2",
        "mode": "link",
        "links": [
            "1ade85b91dd1ef10"
        ],
        "x": 295,
        "y": 280,
        "wires": []
    },
    {
        "id": "b11e04c4ad52cd6b",
        "type": "debug",
        "z": "6132d4bf54f21e8d",
        "name": "debug 64",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "false",
        "statusVal": "",
        "statusType": "auto",
        "x": 840,
        "y": 240,
        "wires": []
    },
    {
        "id": "8d78433004fb8024",
        "type": "inject",
        "z": "6132d4bf54f21e8d",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": true,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 150,
        "y": 200,
        "wires": [
            [
                "ebdc63520fb6c1a0"
            ]
        ]
    },
    {
        "id": "d0a4d9428d03e41d",
        "type": "function",
        "z": "6132d4bf54f21e8d",
        "name": "Test Tibber Data",
        "func": "msg.payload = JSON.parse('[{\"total\":0.2318,\"energy\":0.0695,\"tax\":0.1623,\"startsAt\":\"2025-11-28T00:00:00.000+01:00\",\"currency\":\"EUR\",\"level\":\"CHEAP\"},{\"total\":0.2251,\"energy\":0.064,\"tax\":0.1611,\"startsAt\":\"2025-11-28T00:15:00.000+01:00\",\"currency\":\"EUR\",\"level\":\"CHEAP\"},{\"total\":0.2127,\"energy\":0.0537,\"tax\":0.159,\"startsAt\":\"2025-11-28T00:30:00.000+01:00\",\"currency\":\"EUR\",\"level\":\"CHEAP\"},{\"total\":0.2072,\"energy\":0.0492,\"tax\":0.158,\"startsAt\":\"2025-11-28T00:45:00.000+01:00\",\"currency\":\"EUR\",\"level\":\"CHEAP\"},{\"total\":0.2273,\"energy\":0.0658,\"tax\":0.1615,\"startsAt\":\"2025-11-28T01:00:00.000+01:00\",\"currency\":\"EUR\",\"level\":\"CHEAP\"},{\"total\":0.2124,\"energy\":0.0535,\"tax\":0.1589,\"startsAt\":\"2025-11-28T01:15:00.000+01:00\",\"currency\":\"EUR\",\"level\":\"CHEAP\"},{\"total\":0.2098,\"energy\":0.0513,\"tax\":0.1585,\"startsAt\":\"2025-11-28T01:30:00.000+01:00\",\"currency\":\"EUR\",\"level\":\"CHEAP\"},{\"total\":0.2065,\"energy\":0.0486,\"tax\":0.1579,\"startsAt\":\"2025-11-28T01:45:00.000+01:00\",\"currency\":\"EUR\",\"level\":\"CHEAP\"},{\"total\":0.2126,\"energy\":0.0536,\"tax\":0.159,\"startsAt\":\"2025-11-28T02:00:00.000+01:00\",\"currency\":\"EUR\",\"level\":\"CHEAP\"},{\"total\":0.2115,\"energy\":0.0527,\"tax\":0.1588,\"startsAt\":\"2025-11-28T02:15:00.000+01:00\",\"currency\":\"EUR\",\"level\":\"CHEAP\"},{\"total\":0.21,\"energy\":0.0516,\"tax\":0.1584,\"startsAt\":\"2025-11-28T02:30:00.000+01:00\",\"currency\":\"EUR\",\"level\":\"CHEAP\"},{\"total\":0.2082,\"energy\":0.05,\"tax\":0.1582,\"startsAt\":\"2025-11-28T02:45:00.000+01:00\",\"currency\":\"EUR\",\"level\":\"CHEAP\"},{\"total\":0.2033,\"energy\":0.046,\"tax\":0.1573,\"startsAt\":\"2025-11-28T03:00:00.000+01:00\",\"currency\":\"EUR\",\"level\":\"CHEAP\"},{\"total\":0.2036,\"energy\":0.0462,\"tax\":0.1574,\"startsAt\":\"2025-11-28T03:15:00.000+01:00\",\"currency\":\"EUR\",\"level\":\"CHEAP\"},{\"total\":0.2022,\"energy\":0.045,\"tax\":0.1572,\"startsAt\":\"2025-11-28T03:30:00.000+01:00\",\"currency\":\"EUR\",\"level\":\"CHEAP\"},{\"total\":0.2033,\"energy\":0.046,\"tax\":0.1573,\"startsAt\":\"2025-11-28T03:45:00.000+01:00\",\"currency\":\"EUR\",\"level\":\"CHEAP\"},{\"total\":0.2092,\"energy\":0.0508,\"tax\":0.1584,\"startsAt\":\"2025-11-28T04:00:00.000+01:00\",\"currency\":\"EUR\",\"level\":\"CHEAP\"},{\"total\":0.2095,\"energy\":0.0511,\"tax\":0.1584,\"startsAt\":\"2025-11-28T04:15:00.000+01:00\",\"currency\":\"EUR\",\"level\":\"CHEAP\"},{\"total\":0.2112,\"energy\":0.0525,\"tax\":0.1587,\"startsAt\":\"2025-11-28T04:30:00.000+01:00\",\"currency\":\"EUR\",\"level\":\"CHEAP\"},{\"total\":0.2188,\"energy\":0.0588,\"tax\":0.16,\"startsAt\":\"2025-11-28T04:45:00.000+01:00\",\"currency\":\"EUR\",\"level\":\"CHEAP\"},{\"total\":0.2062,\"energy\":0.0484,\"tax\":0.1578,\"startsAt\":\"2025-11-28T05:00:00.000+01:00\",\"currency\":\"EUR\",\"level\":\"CHEAP\"},{\"total\":0.2122,\"energy\":0.0533,\"tax\":0.1589,\"startsAt\":\"2025-11-28T05:15:00.000+01:00\",\"currency\":\"EUR\",\"level\":\"CHEAP\"},{\"total\":0.2157,\"energy\":0.0562,\"tax\":0.1595,\"startsAt\":\"2025-11-28T05:30:00.000+01:00\",\"currency\":\"EUR\",\"level\":\"CHEAP\"},{\"total\":0.2378,\"energy\":0.0745,\"tax\":0.1633,\"startsAt\":\"2025-11-28T05:45:00.000+01:00\",\"currency\":\"EUR\",\"level\":\"CHEAP\"},{\"total\":0.2216,\"energy\":0.0611,\"tax\":0.1605,\"startsAt\":\"2025-11-28T06:00:00.000+01:00\",\"currency\":\"EUR\",\"level\":\"CHEAP\"},{\"total\":0.2383,\"energy\":0.0749,\"tax\":0.1634,\"startsAt\":\"2025-11-28T06:15:00.000+01:00\",\"currency\":\"EUR\",\"level\":\"CHEAP\"},{\"total\":0.2481,\"energy\":0.083,\"tax\":0.1651,\"startsAt\":\"2025-11-28T06:30:00.000+01:00\",\"currency\":\"EUR\",\"level\":\"CHEAP\"},{\"total\":0.2635,\"energy\":0.0958,\"tax\":0.1677,\"startsAt\":\"2025-11-28T06:45:00.000+01:00\",\"currency\":\"EUR\",\"level\":\"CHEAP\"},{\"total\":0.237,\"energy\":0.0738,\"tax\":0.1632,\"startsAt\":\"2025-11-28T07:00:00.000+01:00\",\"currency\":\"EUR\",\"level\":\"CHEAP\"},{\"total\":0.2476,\"energy\":0.0826,\"tax\":0.165,\"startsAt\":\"2025-11-28T07:15:00.000+01:00\",\"currency\":\"EUR\",\"level\":\"CHEAP\"},{\"total\":0.256,\"energy\":0.0895,\"tax\":0.1665,\"startsAt\":\"2025-11-28T07:30:00.000+01:00\",\"currency\":\"EUR\",\"level\":\"CHEAP\"},{\"total\":0.2452,\"energy\":0.0806,\"tax\":0.1646,\"startsAt\":\"2025-11-28T07:45:00.000+01:00\",\"currency\":\"EUR\",\"level\":\"CHEAP\"},{\"total\":0.2674,\"energy\":0.099,\"tax\":0.1684,\"startsAt\":\"2025-11-28T08:00:00.000+01:00\",\"currency\":\"EUR\",\"level\":\"NORMAL\"},{\"total\":0.2624,\"energy\":0.0948,\"tax\":0.1676,\"startsAt\":\"2025-11-28T08:15:00.000+01:00\",\"currency\":\"EUR\",\"level\":\"CHEAP\"},{\"total\":0.2653,\"energy\":0.0972,\"tax\":0.1681,\"startsAt\":\"2025-11-28T08:30:00.000+01:00\",\"currency\":\"EUR\",\"level\":\"CHEAP\"},{\"total\":0.2672,\"energy\":0.0988,\"tax\":0.1684,\"startsAt\":\"2025-11-28T08:45:00.000+01:00\",\"currency\":\"EUR\",\"level\":\"NORMAL\"},{\"total\":0.2878,\"energy\":0.1158,\"tax\":0.172,\"startsAt\":\"2025-11-28T09:00:00.000+01:00\",\"currency\":\"EUR\",\"level\":\"NORMAL\"},{\"total\":0.2727,\"energy\":0.1033,\"tax\":0.1694,\"startsAt\":\"2025-11-28T09:15:00.000+01:00\",\"currency\":\"EUR\",\"level\":\"NORMAL\"},{\"total\":0.2692,\"energy\":0.1005,\"tax\":0.1687,\"startsAt\":\"2025-11-28T09:30:00.000+01:00\",\"currency\":\"EUR\",\"level\":\"NORMAL\"},{\"total\":0.2633,\"energy\":0.0956,\"tax\":0.1677,\"startsAt\":\"2025-11-28T09:45:00.000+01:00\",\"currency\":\"EUR\",\"level\":\"NORMAL\"},{\"total\":0.2717,\"energy\":0.1025,\"tax\":0.1692,\"startsAt\":\"2025-11-28T10:00:00.000+01:00\",\"currency\":\"EUR\",\"level\":\"NORMAL\"},{\"total\":0.2632,\"energy\":0.0955,\"tax\":0.1677,\"startsAt\":\"2025-11-28T10:15:00.000+01:00\",\"currency\":\"EUR\",\"level\":\"NORMAL\"},{\"total\":0.2635,\"energy\":0.0957,\"tax\":0.1678,\"startsAt\":\"2025-11-28T10:30:00.000+01:00\",\"currency\":\"EUR\",\"level\":\"NORMAL\"},{\"total\":0.2614,\"energy\":0.094,\"tax\":0.1674,\"startsAt\":\"2025-11-28T10:45:00.000+01:00\",\"currency\":\"EUR\",\"level\":\"CHEAP\"},{\"total\":0.2693,\"energy\":0.1005,\"tax\":0.1688,\"startsAt\":\"2025-11-28T11:00:00.000+01:00\",\"currency\":\"EUR\",\"level\":\"NORMAL\"},{\"total\":0.2638,\"energy\":0.096,\"tax\":0.1678,\"startsAt\":\"2025-11-28T11:15:00.000+01:00\",\"currency\":\"EUR\",\"level\":\"NORMAL\"},{\"total\":0.259,\"energy\":0.092,\"tax\":0.167,\"startsAt\":\"2025-11-28T11:30:00.000+01:00\",\"currency\":\"EUR\",\"level\":\"CHEAP\"},{\"total\":0.2571,\"energy\":0.0904,\"tax\":0.1667,\"startsAt\":\"2025-11-28T11:45:00.000+01:00\",\"currency\":\"EUR\",\"level\":\"CHEAP\"},{\"total\":0.2603,\"energy\":0.0931,\"tax\":0.1672,\"startsAt\":\"2025-11-28T12:00:00.000+01:00\",\"currency\":\"EUR\",\"level\":\"CHEAP\"},{\"total\":0.2595,\"energy\":0.0924,\"tax\":0.1671,\"startsAt\":\"2025-11-28T12:15:00.000+01:00\",\"currency\":\"EUR\",\"level\":\"CHEAP\"},{\"total\":0.2684,\"energy\":0.0998,\"tax\":0.1686,\"startsAt\":\"2025-11-28T12:30:00.000+01:00\",\"currency\":\"EUR\",\"level\":\"NORMAL\"},{\"total\":0.2685,\"energy\":0.0998,\"tax\":0.1687,\"startsAt\":\"2025-11-28T12:45:00.000+01:00\",\"currency\":\"EUR\",\"level\":\"NORMAL\"},{\"total\":0.2627,\"energy\":0.0951,\"tax\":0.1676,\"startsAt\":\"2025-11-28T13:00:00.000+01:00\",\"currency\":\"EUR\",\"level\":\"NORMAL\"},{\"total\":0.2649,\"energy\":0.0968,\"tax\":0.1681,\"startsAt\":\"2025-11-28T13:15:00.000+01:00\",\"currency\":\"EUR\",\"level\":\"NORMAL\"},{\"total\":0.2655,\"energy\":0.0974,\"tax\":0.1681,\"startsAt\":\"2025-11-28T13:30:00.000+01:00\",\"currency\":\"EUR\",\"level\":\"NORMAL\"},{\"total\":0.2637,\"energy\":0.0959,\"tax\":0.1678,\"startsAt\":\"2025-11-28T13:45:00.000+01:00\",\"currency\":\"EUR\",\"level\":\"NORMAL\"},{\"total\":0.2457,\"energy\":0.081,\"tax\":0.1647,\"startsAt\":\"2025-11-28T14:00:00.000+01:00\",\"currency\":\"EUR\",\"level\":\"CHEAP\"},{\"total\":0.2412,\"energy\":0.0773,\"tax\":0.1639,\"startsAt\":\"2025-11-28T14:15:00.000+01:00\",\"currency\":\"EUR\",\"level\":\"CHEAP\"},{\"total\":0.2404,\"energy\":0.0767,\"tax\":0.1637,\"startsAt\":\"2025-11-28T14:30:00.000+01:00\",\"currency\":\"EUR\",\"level\":\"CHEAP\"},{\"total\":0.2408,\"energy\":0.077,\"tax\":0.1638,\"startsAt\":\"2025-11-28T14:45:00.000+01:00\",\"currency\":\"EUR\",\"level\":\"CHEAP\"},{\"total\":0.2564,\"energy\":0.0899,\"tax\":0.1665,\"startsAt\":\"2025-11-28T15:00:00.000+01:00\",\"currency\":\"EUR\",\"level\":\"CHEAP\"},{\"total\":0.2677,\"energy\":0.0992,\"tax\":0.1685,\"startsAt\":\"2025-11-28T15:15:00.000+01:00\",\"currency\":\"EUR\",\"level\":\"NORMAL\"},{\"total\":0.2829,\"energy\":0.1118,\"tax\":0.1711,\"startsAt\":\"2025-11-28T15:30:00.000+01:00\",\"currency\":\"EUR\",\"level\":\"NORMAL\"},{\"total\":0.2697,\"energy\":0.1008,\"tax\":0.1689,\"startsAt\":\"2025-11-28T15:45:00.000+01:00\",\"currency\":\"EUR\",\"level\":\"NORMAL\"},{\"total\":0.2525,\"energy\":0.0866,\"tax\":0.1659,\"startsAt\":\"2025-11-28T16:00:00.000+01:00\",\"currency\":\"EUR\",\"level\":\"CHEAP\"},{\"total\":0.2601,\"energy\":0.0929,\"tax\":0.1672,\"startsAt\":\"2025-11-28T16:15:00.000+01:00\",\"currency\":\"EUR\",\"level\":\"NORMAL\"},{\"total\":0.2634,\"energy\":0.0956,\"tax\":0.1678,\"startsAt\":\"2025-11-28T16:30:00.000+01:00\",\"currency\":\"EUR\",\"level\":\"NORMAL\"},{\"total\":0.2703,\"energy\":0.1014,\"tax\":0.1689,\"startsAt\":\"2025-11-28T16:45:00.000+01:00\",\"currency\":\"EUR\",\"level\":\"NORMAL\"},{\"total\":0.2585,\"energy\":0.0916,\"tax\":0.1669,\"startsAt\":\"2025-11-28T17:00:00.000+01:00\",\"currency\":\"EUR\",\"level\":\"NORMAL\"},{\"total\":0.2641,\"energy\":0.0962,\"tax\":0.1679,\"startsAt\":\"2025-11-28T17:15:00.000+01:00\",\"currency\":\"EUR\",\"level\":\"NORMAL\"},{\"total\":0.2636,\"energy\":0.0958,\"tax\":0.1678,\"startsAt\":\"2025-11-28T17:30:00.000+01:00\",\"currency\":\"EUR\",\"level\":\"NORMAL\"},{\"total\":0.2638,\"energy\":0.096,\"tax\":0.1678,\"startsAt\":\"2025-11-28T17:45:00.000+01:00\",\"currency\":\"EUR\",\"level\":\"NORMAL\"},{\"total\":0.2689,\"energy\":0.1002,\"tax\":0.1687,\"startsAt\":\"2025-11-28T18:00:00.000+01:00\",\"currency\":\"EUR\",\"level\":\"NORMAL\"},{\"total\":0.262,\"energy\":0.0945,\"tax\":0.1675,\"startsAt\":\"2025-11-28T18:15:00.000+01:00\",\"currency\":\"EUR\",\"level\":\"NORMAL\"},{\"total\":0.262,\"energy\":0.0945,\"tax\":0.1675,\"startsAt\":\"2025-11-28T18:30:00.000+01:00\",\"currency\":\"EUR\",\"level\":\"NORMAL\"},{\"total\":0.2408,\"energy\":0.077,\"tax\":0.1638,\"startsAt\":\"2025-11-28T18:45:00.000+01:00\",\"currency\":\"EUR\",\"level\":\"CHEAP\"},{\"total\":0.2714,\"energy\":0.1022,\"tax\":0.1692,\"startsAt\":\"2025-11-28T19:00:00.000+01:00\",\"currency\":\"EUR\",\"level\":\"NORMAL\"},{\"total\":0.2623,\"energy\":0.0947,\"tax\":0.1676,\"startsAt\":\"2025-11-28T19:15:00.000+01:00\",\"currency\":\"EUR\",\"level\":\"NORMAL\"},{\"total\":0.2568,\"energy\":0.0902,\"tax\":0.1666,\"startsAt\":\"2025-11-28T19:30:00.000+01:00\",\"currency\":\"EUR\",\"level\":\"NORMAL\"},{\"total\":0.2453,\"energy\":0.0807,\"tax\":0.1646,\"startsAt\":\"2025-11-28T19:45:00.000+01:00\",\"currency\":\"EUR\",\"level\":\"CHEAP\"},{\"total\":0.2698,\"energy\":0.101,\"tax\":0.1688,\"startsAt\":\"2025-11-28T20:00:00.000+01:00\",\"currency\":\"EUR\",\"level\":\"NORMAL\"},{\"total\":0.2515,\"energy\":0.0858,\"tax\":0.1657,\"startsAt\":\"2025-11-28T20:15:00.000+01:00\",\"currency\":\"EUR\",\"level\":\"NORMAL\"},{\"total\":0.248,\"energy\":0.0829,\"tax\":0.1651,\"startsAt\":\"2025-11-28T20:30:00.000+01:00\",\"currency\":\"EUR\",\"level\":\"CHEAP\"},{\"total\":0.2374,\"energy\":0.0742,\"tax\":0.1632,\"startsAt\":\"2025-11-28T20:45:00.000+01:00\",\"currency\":\"EUR\",\"level\":\"CHEAP\"},{\"total\":0.2557,\"energy\":0.0893,\"tax\":0.1664,\"startsAt\":\"2025-11-28T21:00:00.000+01:00\",\"currency\":\"EUR\",\"level\":\"NORMAL\"},{\"total\":0.2532,\"energy\":0.0872,\"tax\":0.166,\"startsAt\":\"2025-11-28T21:15:00.000+01:00\",\"currency\":\"EUR\",\"level\":\"NORMAL\"},{\"total\":0.2492,\"energy\":0.0839,\"tax\":0.1653,\"startsAt\":\"2025-11-28T21:30:00.000+01:00\",\"currency\":\"EUR\",\"level\":\"NORMAL\"},{\"total\":0.236,\"energy\":0.073,\"tax\":0.163,\"startsAt\":\"2025-11-28T21:45:00.000+01:00\",\"currency\":\"EUR\",\"level\":\"CHEAP\"},{\"total\":0.256,\"energy\":0.0895,\"tax\":0.1665,\"startsAt\":\"2025-11-28T22:00:00.000+01:00\",\"currency\":\"EUR\",\"level\":\"NORMAL\"},{\"total\":0.2488,\"energy\":0.0836,\"tax\":0.1652,\"startsAt\":\"2025-11-28T22:15:00.000+01:00\",\"currency\":\"EUR\",\"level\":\"NORMAL\"},{\"total\":0.2529,\"energy\":0.087,\"tax\":0.1659,\"startsAt\":\"2025-11-28T22:30:00.000+01:00\",\"currency\":\"EUR\",\"level\":\"NORMAL\"},{\"total\":0.2394,\"energy\":0.0758,\"tax\":0.1636,\"startsAt\":\"2025-11-28T22:45:00.000+01:00\",\"currency\":\"EUR\",\"level\":\"CHEAP\"},{\"total\":0.2495,\"energy\":0.0842,\"tax\":0.1653,\"startsAt\":\"2025-11-28T23:00:00.000+01:00\",\"currency\":\"EUR\",\"level\":\"NORMAL\"},{\"total\":0.2399,\"energy\":0.0762,\"tax\":0.1637,\"startsAt\":\"2025-11-28T23:15:00.000+01:00\",\"currency\":\"EUR\",\"level\":\"CHEAP\"},{\"total\":0.2385,\"energy\":0.0751,\"tax\":0.1634,\"startsAt\":\"2025-11-28T23:30:00.000+01:00\",\"currency\":\"EUR\",\"level\":\"CHEAP\"},{\"total\":0.2339,\"energy\":0.0712,\"tax\":0.1627,\"startsAt\":\"2025-11-28T23:45:00.000+01:00\",\"currency\":\"EUR\",\"level\":\"CHEAP\"}]');\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 320,
        "y": 200,
        "wires": [
            []
        ]
    },
    {
        "id": "b218ecafa5e790e0",
        "type": "function",
        "z": "6132d4bf54f21e8d",
        "name": "Combine/Simplify",
        "func": "var ret = {};\nvar json = msg.payload.tibber;\nvar varray = msg.payload.forecast;\nvar bHaveForecast = false;\nif (varray !== undefined) {\n    if (varray.length == 24) {\n        bHaveForecast = true;\n    }\n}\nif (json.length == 24)\n{\n    ret.status = true;\n    ret.datum = json[0].startsAt.substr(0,10);\n\n    var results = [];\n    for (var i = 0; i < json.length; i++)\n    {\n        var obj = json[i];\n        var tmpobj = {\n            datum: ret.datum + \" \" + obj.startsAt.substr(11,8),\n            prijsTI: obj.total,\n            level: obj.level\n        };\n        var iForecast = 0;\n        if (bHaveForecast == true) {\n             iForecast = varray[i];\n        }\n        tmpobj[\"forecast\"] = iForecast;\n        results.push(tmpobj);\n    }\n    ret.data = results;\n}\nelse\n    ret.status = false;\nmsg.payload = ret;\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 650,
        "y": 300,
        "wires": [
            []
        ]
    },
    {
        "id": "b8860f53c33b8608",
        "type": "join",
        "z": "6132d4bf54f21e8d",
        "name": "Join",
        "mode": "custom",
        "build": "object",
        "property": "payload",
        "propertyType": "msg",
        "key": "topic",
        "joiner": "\\n",
        "joinerType": "str",
        "accumulate": false,
        "timeout": "",
        "count": "2",
        "reduceRight": false,
        "reduceExp": "",
        "reduceInit": "",
        "reduceInitType": "num",
        "reduceFixup": "",
        "x": 490,
        "y": 220,
        "wires": [
            []
        ]
    },
    {
        "id": "ebdc63520fb6c1a0",
        "type": "tibber-data",
        "z": "6132d4bf54f21e8d",
        "name": "Get Today Prices",
        "active": true,
        "apiEndpointRef": "09c638b767297aba",
        "queryName": "getTodaysEnergyPrices",
        "homeId": "49bf2e0e-83cf-4388-b0d5-a03a407a3cc0",
        "energyResolution": "HOURLY",
        "lastCount": 10,
        "x": 550,
        "y": 120,
        "wires": [
            [
                "c3d4b77c6f3c5681"
            ]
        ]
    },
    {
        "id": "c3d4b77c6f3c5681",
        "type": "debug",
        "z": "6132d4bf54f21e8d",
        "name": "debug 67",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "false",
        "statusVal": "",
        "statusType": "auto",
        "x": 800,
        "y": 120,
        "wires": []
    }
]